import{_ as Ee}from"./index.vue_vue_type_style_index_0_lang.95d64787.js";import{s as de,P as _e,_ as Re}from"./promql.199ef8fc.js";import{d as j,e as B,r as Ve,aQ as pe,c as I,w as Le,aI as s,D as r,aF as f,aH as e,aJ as o,u as t,H as c,aM as S,aN as k,E as C,k as ye,aL as Q,aK as W,aW as ze,aX as Me,aY as De,aZ as Be,a_ as se,a$ as ae,G as Ie,aG as oe,F as he,b0 as te,o as Ae,b1 as Ue,b as He,b2 as me,b3 as Oe,b4 as Pe}from"./arco.643eb8a8.js";import{o as Y,k as Z,a as Fe,T as fe}from"./index.89c26ee4.js";import{u as Ne,q as Ge,d as Qe,a as We,t as je,_ as K,b as A,c as Ke,e as Je,f as Xe,l as Ye,r as ve,g as Ze}from"./index.6953f38d.js";import{g as be,s as ee,h as et}from"./vue.44e4333e.js";import{u as ne}from"./query-code.7a11c6c0.js";import"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import"./chart.4225530a.js";const tt=n=>(se("data-v-87ab0675"),n=n(),ae(),n),ot={class:"mr-4"},nt={class:"mr-4"},st={key:0},at={key:1},lt={class:"query-select"},rt=tt(()=>c("svg",{class:"icon"},[c("use",{href:"#question"})],-1)),it={class:"ml-4"},ut={class:"ml-2"},ct=j({__name:"editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(n){be();const{codes:a,queryType:l,cursorAt:v,queryOptions:w,primaryCodeRunning:h,secondaryCodeRunning:y,sqlView:q,promqlView:T}=ne(),i=B(),b=B(),m=B();B(!1),B(!1);const p=Ve({time:5,step:"30s",range:[pe().subtract(5,"minute").unix().toString(),pe().unix().toString()]}),{runQuery:L}=ne(),{originTablesTree:x}=ee(Ne()),E=I(()=>{if(a.value[l.value].trim().length===0)return!0;if(l.value==="promql"){const _=p.range?p.range.length>0:!1;if(p.step.trim().length===0||!p.time&&!_)return!0}return!!(h.value||y.value)}),U=_=>{q.value=_.view},F=_=>{T.value=_.view},z={height:"250px"},H=_=>{const u=_==="sql"?q.value:T.value;if(u&&_===l.value){const{state:$}=u,{ranges:R}=$.selection;if(v.value=[R[0].from,R[0].to],i.value=$.doc.lineAt(R[0].from).number,b.value=$.doc.lineAt(R[0].to).number,$.doc.text)m.value=$.doc.text.slice(i.value-1,b.value).join(" ");else{let V=[];$.doc.children.forEach(G=>{V=V.concat(G.text)}),m.value=V.slice(i.value-1,b.value).join(" ")}}},O=async()=>{h.value=!0,await L(a.value[l.value].trim(),l.value,!1,p),h.value=!1},N=I(()=>!m.value||m.value.trim().length===0?!0:E.value),P=async()=>{y.value=!0,await L(m.value.trim(),l.value,!1,p),y.value=!1},g=je.map(_=>({value:_,label:`Last ${_} minutes`})),M=[{key:"alt-Enter",run:()=>{O()}},{key:"ctrl-Enter",run:()=>{P()}}],D=I(()=>{const _={},u=new Set;return x.value.forEach($=>{const R=$.columns.map(V=>(u.add(V.title),V.title));_[$.title]=R,u.add($.title)}),{sql:{schema:_},promql:u}}),X={sql:[de(D.value.sql),Y,Z.of(M),Fe({closeOnBlur:!1})],promql:[new _e().asExtension(),Y,Z.of(M)]};return Le(D,()=>{X.sql=[de(D.value.sql),Y,Z.of(M)];const _=new _e().setComplete({remote:{fetchFn:()=>Promise.reject(),cache:{initialMetricList:[...D.value.promql]}}});X.promql=[_.asExtension(),Y,Z.of(M)]}),(_,u)=>{const $=s("icon-loading"),R=s("icon-play-arrow"),V=s("a-button"),G=s("a-space"),ge=s("a-option"),ke=s("a-select"),we=Re,re=s("a-form-item"),ie=s("a-typography-text"),ue=s("a-list-item"),qe=s("a-list"),$e=s("a-popover"),xe=s("a-input"),Se=s("a-form"),ce=s("a-tab-pane"),Ce=s("a-tabs"),Te=s("a-card");return r(),f(Te,{class:"editor-card",bordered:!1},{default:e(()=>[o(G,{class:"space-between pb-15"},{default:e(()=>[o(G,{size:"medium"},{default:e(()=>[o(V,{type:"primary",disabled:t(E),onClick:u[0]||(u[0]=d=>O())},{default:e(()=>[c("div",ot,[t(h)?(r(),f($,{key:0,spin:""})):(r(),f(R,{key:1}))]),S(k(_.$t("dashboard.runAll")),1)]),_:1},8,["disabled"]),o(V,{disabled:t(N),onClick:u[1]||(u[1]=d=>P())},{default:e(()=>[c("div",nt,[t(y)?(r(),f($,{key:0,spin:""})):(r(),f(R,{key:1}))]),t(i)===t(b)?(r(),C("div",st,k(_.$t("dashboard.runLine"))+" "+k(t(i)),1)):(r(),C("div",at,k(_.$t("dashboard.runLines"))+" "+k(t(i))+" - "+k(t(b)),1))]),_:1},8,["disabled"])]),_:1}),c("div",lt,[o(ke,{modelValue:t(l),"onUpdate:modelValue":u[2]||(u[2]=d=>ye(l)?l.value=d:null),"trigger-props":{"content-class":"query-select"}},{default:e(()=>[(r(!0),C(Q,null,W(t(w),d=>(r(),f(ge,ze(Me(d)),null,16))),256))]),_:1},8,["modelValue"])])]),_:1}),De(o(Se,{class:"space-between prom-form mb-15",layout:"inline",model:t(p)},{default:e(()=>[o(G,{size:10},{default:e(()=>[o(re,{"hide-label":!0},{default:e(()=>[o(we,{"time-length":t(p).time,"onUpdate:timeLength":u[3]||(u[3]=d=>t(p).time=d),"time-range":t(p).range,"onUpdate:timeRange":u[4]||(u[4]=d=>t(p).range=d),"flex-direction":"row-reverse","button-class":"query-time-button","relative-time-map":t(Ge),"relative-time-options":t(g)},null,8,["time-length","time-range","relative-time-map","relative-time-options"])]),_:1}),o(re,{"hide-label":!0},{default:e(()=>[o(xe,{modelValue:t(p).step,"onUpdate:modelValue":u[5]||(u[5]=d=>t(p).step=d),"hide-button":"",style:{width:"180px"},placeholder:_.$t("dashboard.step")},{prefix:e(()=>[S("Step")]),suffix:e(()=>[o($e,{trigger:"hover"},{content:e(()=>[o(qe,{size:"small",split:!1,bordered:!1},{header:e(()=>[S(k(_.$t("dashboard.supportedDurations")),1)]),default:e(()=>[(r(!0),C(Q,null,W(t(Qe),d=>(r(),f(ue,{key:d},{default:e(()=>[o(ie,{code:""},{default:e(()=>[S(k(d.key),1)]),_:2},1024),c("span",it,k(d.value),1)]),_:2},1024))),128)),o(ue,null,{default:e(()=>[c("span",ut,k(_.$t("dashboard.examples")),1),(r(!0),C(Q,null,W(t(We),d=>(r(),f(ie,{key:d,code:""},{default:e(()=>[S(k(d),1)]),_:2},1024))),128))]),_:1})]),_:1})]),default:e(()=>[rt]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["model"]),[[Be,t(l)==="promql"]]),o(Ce,{class:"query-tabs","default-active-key":"sql","active-key":t(l)},{default:e(()=>[o(ce,{key:"sql"},{default:e(()=>[o(t(fe),{modelValue:t(a).sql,"onUpdate:modelValue":u[6]||(u[6]=d=>t(a).sql=d),style:z,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:X.sql,onReady:U,onUpdate:u[7]||(u[7]=d=>H("sql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1}),o(ce,{key:"promql"},{default:e(()=>[o(t(fe),{modelValue:t(a).promql,"onUpdate:modelValue":u[8]||(u[8]=d=>t(a).promql=d),style:z,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:X.promql,onReady:F,onUpdate:u[9]||(u[9]=d=>H("promql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1})]),_:1},8,["active-key"])]),_:1})}}});const dt=K(ct,[["__scopeId","data-v-87ab0675"]]),le=n=>(se("data-v-c19602fd"),n=n(),ae(),n),_t=le(()=>c("svg",{class:"icon-16"},[c("use",{href:"#clear"})],-1)),pt={key:0,class:"icon-16"},mt=le(()=>c("use",{href:"#zoom-out"},null,-1)),ft=[mt],vt={key:1,class:"icon-16"},yt=le(()=>c("use",{href:"#zoom"},null,-1)),ht=[yt],bt=j({__name:"index",setup(n){const{queryModalVisible:a}=ee(A());A();const{getResultsByType:l,sqlView:v,promqlView:w,queryType:h,clearCode:y}=ne(),q=60,T=16,i=258,b=B(!1);B(!1);const m=["sql","promql"],p=I(()=>l(m)),L=()=>{h.value==="sql"?v.value.focus():w.value.focus()};return(x,E)=>{const U=s("a-button"),F=s("a-tooltip"),z=s("a-space"),H=dt,O=Ee,N=s("a-scrollbar"),P=s("a-modal");return r(),f(P,{class:he(["query-modal",{"full-screen":t(b)}]),visible:t(a),"onUpdate:visible":E[1]||(E[1]=g=>ye(a)?a.value=g:null),"ok-text":x.$t("guide.confirm"),"hide-cancel":!0,width:t(b)?`calc(100vw - ${i}px - 32px)`:636,mask:!1,"align-center":!1,"mask-style":{"pointer-events":"none"},footer:!1,draggable:!0,onOpen:L},{title:e(()=>[S(k(x.$t("menu.dashboard.query")),1),o(z,{fill:"",size:3},{default:e(()=>[o(F,{mini:"",content:x.$t("dashboard.clearCode")},{default:e(()=>[o(U,{class:"screen-button",type:"text",size:"small",onClick:t(y)},{icon:e(()=>[_t]),_:1},8,["onClick"])]),_:1},8,["content"]),o(U,{class:"screen-button",type:"text",size:"small",onClick:E[0]||(E[0]=g=>b.value=!t(b))},{icon:e(()=>[t(b)?(r(),C("svg",pt,ft)):(r(),C("svg",vt,ht))]),_:1})]),_:1})]),default:e(()=>[o(z,{class:"editor-space",align:"start",fill:"",size:0},{default:e(()=>[o(N,{style:Ie({height:`calc(100vh - ${T*2+q}px)`,overflow:"auto"})},{default:e(()=>{var g;return[o(H),(g=t(p))!=null&&g.length?(r(),f(O,{key:0,class:"modal-view",results:t(p),types:m},null,8,["results"])):oe("",!0)]}),_:1},8,["style"])]),_:1})]),_:1},8,["visible","class","ok-text","width"])}}});const gt=K(bt,[["__scopeId","data-v-c19602fd"]]),kt="/assets/logo-text.e99088e0.png",wt=[...Ke,...Je],qt=wt.map(n=>{const{name:a,path:l,meta:v,redirect:w,children:h}=n;return{name:a,path:l,meta:v,redirect:w,children:h}});function $t(){const n=Xe(),a=A(),l=I(()=>a.menuFromServer?a.appAsyncMenus:qt);return{menuTree:I(()=>{const w=JSON.parse(JSON.stringify(l.value));w.sort((y,q)=>(y.meta.order||0)-(q.meta.order||0));function h(y,q){return y?y.map(i=>{var m,p;if(!n.accessRouter(i))return null;if(((m=i.meta)==null?void 0:m.hideChildrenInMenu)||!i.children)return i.children=[],i;i.children=i.children.filter(L=>{var x;return((x=L.meta)==null?void 0:x.hideInMenu)!==!0});const b=h(i.children,q+1);return b.length||q>1?(i.children=b,i):((p=i.meta)==null?void 0:p.hideInMenu)===!1?i:null}).filter(Boolean):null}return h(w,0)})}}const J=n=>(se("data-v-09a92e8a"),n=n(),ae(),n),xt=J(()=>c("div",{class:"logo-space"},[c("img",{class:"logo-text-img",alt:"logo",src:kt})],-1)),St={class:"new-query"},Ct=J(()=>c("span",null,"+",-1)),Tt=J(()=>c("span",null,"New Query",-1)),Et={class:"menu"},Rt={class:"icon-18"},Vt=["href"],Lt={class:"footer"},zt=J(()=>c("svg",{class:"icon-16"},[c("use",{href:"#settings"})],-1)),Mt=J(()=>c("svg",{class:"icon"},[c("use",{href:"#menu"})],-1)),Dt=j({__name:"index",setup(n){const{updateSettings:a}=A(),{menuSelectedKey:l,globalSettings:v}=ee(A()),{menuTree:w}=$t(),h=w.value[0].children,y=[{link:"https://greptime.com/",label:"Home"},{link:"https://docs.greptime.com/",label:"Docs"},{link:"https://github.com/GreptimeTeam/dashboard",label:"GitHub | Dashboard"},{link:"https://github.com/GreptimeTeam/greptimedb",label:"GitHub | GreptimeDB"}],q=()=>{a({globalSettings:!0})},T=m=>{ve.push({name:m})},i=m=>{const p=ve.resolve({name:m});window.open(p.fullPath,"_blank")};Ye(m=>{l.value=m.name},!0);const b=()=>{a({queryModalVisible:!0})};return(m,p)=>{const L=s("a-layout-header"),x=s("a-button"),E=s("a-menu-item"),U=s("a-menu"),F=s("a-layout-content"),z=s("a-link"),H=s("a-doption"),O=s("a-dropdown"),N=s("a-layout-footer"),P=s("a-layout");return r(),f(P,{class:"navbar"},{default:e(()=>[o(L,null,{default:e(()=>[xt]),_:1}),o(F,null,{default:e(()=>[c("div",St,[o(x,{type:"primary",onClick:b},{default:e(()=>[Ct,Tt]),_:1})]),c("div",Et,[o(U,{mode:"vertical","selected-keys":[t(l)]},{default:e(()=>[(r(!0),C(Q,null,W(t(h),(g,M)=>(r(),f(E,{key:g.name,onClick:[te(D=>i(g.name),["meta"]),te(D=>i(g.name),["ctrl"]),te(D=>T(g.name),["exact"])]},{icon:e(()=>[(r(),C("svg",Rt,[c("use",{href:`#${g.meta.icon}`},null,8,Vt)]))]),default:e(()=>[c("span",null,k(m.$t(g.meta.locale)),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["selected-keys"])])]),_:1}),o(N,null,{default:e(()=>[c("ul",Lt,[c("li",null,[o(x,{style:{width:"100%"},type:"text",class:he({hover:t(v)}),onClick:q},{icon:e(()=>[zt]),default:e(()=>[S(k(m.$t("settings.title")),1)]),_:1},8,["class"])]),c("li",null,[o(O,{class:"menu-dropdown",trigger:"hover",position:"right","popup-max-height":!1},{content:e(()=>[(r(),C(Q,null,W(y,({label:g,link:M})=>o(H,null,{default:e(()=>[o(z,{target:"_blank",href:M},{default:e(()=>[S(k(g),1)]),_:2},1032,["href"])]),_:2},1024)),64))]),default:e(()=>[o(x,{style:{width:"100%"},type:"text"},{icon:e(()=>[Mt]),default:e(()=>[S(k(m.$t("navbar.docs")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})}}});const Bt=K(Dt,[["__scopeId","data-v-09a92e8a"]]);const It={};function At(n,a){const l=s("a-layout-footer");return r(),f(l,{class:"footer"},{default:e(()=>[S("\xA9Copyright 2022 Greptime Inc. All Rights Reserved")]),_:1})}const Ut=K(It,[["render",At],["__scopeId","data-v-d90f7d0d"]]);function Ht(n,a,l,v=!1){n.addEventListener&&typeof n.addEventListener=="function"&&n.addEventListener(a,l,v)}function Ot(n,a,l,v=!1){n.removeEventListener&&typeof n.removeEventListener=="function"&&n.removeEventListener(a,l,v)}const Pt=992;function Ft(){return document.body.getBoundingClientRect().width-1<Pt}function Nt(n){const a=A();function l(){if(!document.hidden){const w=Ft();a.toggleDevice(w?"mobile":"desktop"),a.toggleMenu(w)}}const v=et(l,100);Ae(()=>{n&&v()}),Ue(()=>{Ht(window,"resize",v)}),He(()=>{Ot(window,"resize",v)})}const Gt=j({__name:"page-layout",setup(n){const a=be(),l=Ze();return I(()=>l.getCacheList),(v,w)=>{const h=s("router-view");return r(),f(h,null,{default:e(({Component:y})=>[o(Pe,{name:"fade",mode:"out-in",appear:""},{default:e(()=>[t(a).meta.ignoreCache?(r(),f(me(y),{key:t(a).fullPath})):(r(),f(Oe,{key:1},[(r(),f(me(y),{key:t(a).name}))],1024))]),_:2},1024)]),_:1})}}}),Qt=j({__name:"default-layout",setup(n){Nt(!0);const{navbar:a,footer:l}=ee(A());return(v,w)=>{const h=Bt,y=s("a-layout-sider"),q=s("a-layout-content"),T=gt,i=s("a-layout");return r(),f(i,{class:"layout-container"},{default:e(()=>[o(y,{class:"main-sider",width:258},{default:e(()=>[t(a)?(r(),f(h,{key:0})):oe("",!0)]),_:1}),o(q,{class:"layout-content"},{default:e(()=>[o(Gt)]),_:1}),t(l)?(r(),f(Ut,{key:0})):oe("",!0),o(T)]),_:1})}}});const oo=K(Qt,[["__scopeId","data-v-480c2625"]]);export{oo as default};
