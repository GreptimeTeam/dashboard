import{_ as oe}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import{_ as pe}from"./log.43c2451d.js";import{d as Q,b7 as ne,aI as u,D as l,aF as m,aH as t,aJ as s,aM as P,aN as _,aG as q,F as N,b8 as me,E as p,aL as W,aK as F,e as ae,c as G,H as o,u as a,k as j,aY as J,aZ as D,b0 as ee,b4 as ye,a_ as fe,a$ as he,o as ge,w as te,b9 as be}from"./arco.643eb8a8.js";import{g as ce,s as K,j as ve,k as Te}from"./vue.44e4333e.js";import{q as ke,r as xe,d as se,u as le}from"./query-code.3672cfbe.js";import{_ as X,u as ie,b as Ce,s as Ee,i as Ie}from"./index.eb244f62.js";import{_ as Le}from"./text-copyable.3bd9808a.js";import{u as we,_ as Ae}from"./python-code.2ee39f8e.js";import"./chart.4225530a.js";const Me=Q({__name:"logs-layout",props:{logs:null,types:null},setup(h){const E=h;ne(T=>({"0c19c21a":I}));const x=16,y=58,I=`calc(100vh - ${x*3+y}px`;ce();const{clearLogs:L}=ke(),w=()=>{L(E.types)};return(T,z)=>{const $=u("a-space"),C=u("a-button"),H=pe,S=oe,R=u("a-list"),g=u("a-card");return l(),m(g,{class:"logs-card",bordered:!1},{title:t(()=>[s($,null,{default:t(()=>[P("Logs")]),_:1})]),extra:t(()=>[h.logs.length?(l(),m(C,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",size:"small",onClick:w},{default:t(()=>[P(_(T.$t("dashboard.clear")),1)]),_:1})):q("",!0)]),default:t(()=>[s(R,{class:N(["logs-list",{"empty-list":!h.logs.length}]),size:"small",hoverable:!0,bordered:!1},{default:t(()=>[s(me,{name:"list"},{default:t(()=>[(l(!0),p(W,null,F(h.logs,v=>(l(),m(H,{key:v,log:v},null,8,["log"]))),128)),h.logs.length?q("",!0):(l(),m(S,{key:0,class:"empty-log"}))]),_:1})]),_:1},8,["class"])]),_:1})}}});const $e=X(Me,[["__scopeId","data-v-8b7d68ed"]]),b=h=>(fe("data-v-a49f48bf"),h=h(),he(),h),Se=b(()=>o("svg",{class:"icon brand-color"},[o("use",{href:"#refresh"})],-1)),qe=[Se],Ne=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#search"})],-1)),ze={class:"icon-18"},He=["href"],Re={key:0,class:"tree-data"},Be={class:"data-title"},Ke=b(()=>o("use",{href:"#columns"},null,-1)),Pe=[Ke],Ue=b(()=>o("use",{href:"#details"},null,-1)),Oe=[Ue],Ve=b(()=>o("svg",{class:"icon-18 icon-color"},[o("use",{href:"#query"})],-1)),We={key:1,class:"tree-data"},Fe={class:"data-title columns"},Ge={class:"tree-data"},Qe={class:"data-type"},Xe=b(()=>o("svg",{class:"icon-18 icon-color"},[o("use",{href:"#query"})],-1)),Ye={key:2,class:"detail-row"},Ze={key:0,class:"count-and-time"},je=b(()=>o("span",null,_("TTL"),-1)),Je=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#refresh"})],-1)),De={key:1},et={key:1},tt=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#refresh"})],-1)),st={class:"left"},lt={key:0,class:"empty-sql"},ot={key:1,class:"right"},nt={key:0,class:"icon-18"},at=b(()=>o("use",{href:"#tables"},null,-1)),ct=[at],it=Q({__name:"table-manager",setup(h){const E=ce();we();const{tablesSearchKey:x,tablesTreeData:y,tablesTreeRef:I,isRefreshingDetails:L,refreshTables:w,loadMore:T,loadMoreColumns:z}=xe(),{tablesLoading:$,originTablesTree:C}=K(ie()),H=16,S=58,R=H*3+S,g=ae(),v=(c,n,i)=>{var f;n[i].length&&i!==n.childrenType&&((f=g.value)==null?void 0:f.includes(n.key))&&c.stopPropagation(),n.children=n[i],n.childrenType=i};G(()=>y.value.map(c=>({title:c.title,dataIndex:c.title})));const U={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},A={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]},O=(c,n)=>{c.stopPropagation(),n.columns.length||z(n)};return(c,n)=>{const i=u("a-space"),f=u("a-input"),d=u("a-tooltip"),k=u("a-button"),B=Ae,M=u("a-spin"),Y=u("a-doption"),Z=u("a-dropdown"),V=Le,re=u("a-typography-text"),_e=u("a-tree"),ue=oe,de=u("a-card");return l(),m(de,{class:"table-manager",bordered:!1},{title:t(()=>[s(i,null,{default:t(()=>[P("Tables"),o("div",{class:"icon-space pointer",onClick:n[0]||(n[0]=(...e)=>a(w)&&a(w)(...e))},qe)]),_:1}),s(i,null,{default:t(()=>[s(f,{modelValue:a(x),"onUpdate:modelValue":n[1]||(n[1]=e=>j(x)?x.value=e:null),"allow-clear":!0,placeholder:c.$t("dashboard.input")},{prefix:t(()=>[Ne]),_:1},8,["modelValue","placeholder"])]),_:1})]),default:t(()=>[s(M,{style:{width:"100%"},loading:a($)},{default:t(()=>[a(y)&&a(y).length>0?(l(),m(_e,{key:0,class:"table-tree",ref_key:"tablesTreeRef",ref:I,"expanded-keys":a(g),"onUpdate:expandedKeys":n[4]||(n[4]=e=>j(g)?g.value=e:null),size:"small","action-on-node-click":"expand","block-node":!0,data:a(y),"load-more":a(T),animation:!1,"virtual-list-props":{height:`calc(100vh - ${R}px)`}},{icon:t(e=>[e.node.iconType?(l(),m(d,{key:0,content:e.node.iconType},{default:t(()=>[(l(),p("svg",ze,[o("use",{href:U[e.node.iconType]},null,8,He)]))]),_:2},1032,["content"])):q("",!0)]),title:t(e=>[e.isLeaf?e.dataType?(l(),p("div",We,[o("div",Fe,_(e.title),1),o("div",Ge,[s(ye,{name:"slide-fade"},{default:t(()=>[o("div",Qe,_(e.dataType),1)]),_:2},1024),e.dataType?(l(),m(Z,{key:0,class:"quick-select",trigger:"click",position:"right"},{content:t(()=>[(l(!0),p(W,null,F(A[e.iconType||"TABLE"],r=>J((l(),m(Y,null,{default:t(()=>[s(M,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(B,{type:r.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:r.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E).name==="query"]])),256))]),default:t(()=>[s(d,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(k,{type:"text",size:"small"},{icon:t(()=>[Xe]),_:1})]),_:1},8,["content"])]),_:2},1024)):q("",!0),s(V,{class:"title-copy columns",type:"text",data:e.title,"show-data":!1,onClick:n[3]||(n[3]=ee(()=>{},["stop"]))},null,8,["data"])])])):(l(),p("div",Ye,[e.title==="rowAndTime"?(l(),p("div",Ze,[s(i,{size:4},{default:t(()=>[o("span",null,_(c.$t("dashboard.rowCount")),1),o("span",null,_(e.info.rowCount),1)]),_:2},1024),s(i,null,{default:t(()=>[s(i,{size:4},{default:t(()=>[je,o("span",null,_(e.info.ttl),1)]),_:2},1024),s(k,{class:"refresh-details row-middle",type:"text",size:"small",loading:a(L)[e.parentKey],onClick:r=>a(T)(a(C)[e.parentKey])},{icon:t(()=>[Je]),_:2},1032,["loading","onClick"])]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,_(c.$t("dashboard.minTime")),1),e.info.min!=="-"?(l(),m(d,{key:0,content:`${e.info.min}`},{default:t(()=>[o("span",null,_(a(se)(e.info.timestampType,e.info.min)),1)]),_:2},1032,["content"])):(l(),p("span",De,_(e.info.min),1))]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,_(c.$t("dashboard.maxTime")),1),e.info.max!=="-"?(l(),m(d,{key:0,content:`${e.info.max}`},{default:t(()=>[o("span",null,_(a(se)(e.info.timestampType,e.info.max)),1)]),_:2},1032,["content"])):(l(),p("span",et,_(e.info.max),1))]),_:2},1024),s(k,{class:"refresh-details row-end",type:"text",size:"small",loading:a(L)[e.parentKey],onClick:r=>a(T)(a(C)[e.parentKey])},{icon:t(()=>[tt]),_:2},1032,["loading","onClick"])])):(l(),m(i,{key:1},{default:t(()=>[s(i,{align:"start",class:N({"create-table":e.info.sql!=="-"}),size:4},{default:t(()=>[o("div",st,_(c.$t("dashboard.createTable")),1),e.info.sql==="-"?(l(),p("span",lt,_(e.info.sql),1)):(l(),p("div",ot,[s(re,{class:"code-space"},{default:t(()=>[P(_(e.info.sql),1)]),_:2},1024),s(V,{data:e.info.sql,showData:!1,copyTooltip:c.$t("dashboard.copyToClipboard")},null,8,["data","copyTooltip"])]))]),_:2},1032,["class"])]),_:2},1024))])):(l(),p("div",Re,[s(d,{class:"data-type",mini:"",content:e.title},{default:t(()=>[o("div",Be,_(e.title),1)]),_:2},1032,["content"]),s(i,{size:6},{default:t(()=>[s(d,{mini:"",content:c.$t("dashboard.columns")},{default:t(()=>[s(k,{type:"text",size:"small",onClick:r=>v(r,e,"columns")},{icon:t(()=>{var r;return[(l(),p("svg",{class:N(["icon-18",e.childrenType==="columns"&&((r=a(g))==null?void 0:r.includes(e.key))?"":"icon-color"])},Pe,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(d,{mini:"",content:c.$t("dashboard.details")},{default:t(()=>[s(k,{type:"text",size:"small",onClick:r=>v(r,e,"details")},{icon:t(()=>{var r;return[(l(),p("svg",{class:N(["icon-18",e.childrenType==="details"&&((r=a(g))==null?void 0:r.includes(e.key))?"":"icon-color"])},Oe,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(Z,{class:"quick-select",trigger:"click",position:"right",onClick:r=>O(r,e)},{content:t(()=>[(l(!0),p(W,null,F(A.TABLE,r=>J((l(),m(Y,null,{default:t(()=>[s(M,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(B,{type:r.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:r.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E).name==="query"]])),256))]),default:t(()=>[s(d,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(k,{type:"text",size:"small"},{icon:t(()=>[Ve]),_:1})]),_:1},8,["content"])]),_:2},1032,["onClick"]),s(V,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:n[2]||(n[2]=ee(()=>{},["stop"]))},null,8,["data"])]),_:2},1024)]))]),"switcher-icon":t(e=>[e.isLeaf?q("",!0):(l(),p("svg",nt,ct))]),_:1},8,["expanded-keys","data","load-more","virtual-list-props"])):(l(),m(ue,{key:1,class:"empty"}))]),_:1},8,["loading"])]),_:1})}}});const rt=X(it,[["__scopeId","data-v-a49f48bf"]]),_t=Q({__name:"index",setup(h){ne(c=>({"471e33b0":g,"103bf473":S}));const{s:E,q:x}=ve(),y=Te(),{queryType:I}=le(),{guideModalVisible:L}=K(Ce()),{getTables:w}=ie(),{dataStatusMap:T}=K(Ee()),{logs:z}=K(Ie()),{getResultsByType:$}=le(),S=`${258+16+636}px`,g=`${508+12}px`,v=ae();ge(()=>{v.value=document.getElementsByClassName("table-manager")[0]});const U=()=>{v.value=document.getElementsByClassName("table-manager")[0]},A=["sql","promql"];G(()=>$(A));const O=G(()=>z.value.filter(c=>A.includes(c.type)));return te(E,c=>{var n,i,f,d;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((i=y.value)==null?void 0:i.tagName)!=="TEXTAREA"&&!((d=(f=y.value)==null?void 0:f.classList)!=null&&d.contains("cm-content"))&&(I.value="sql")}),te(x,c=>{var n,i,f,d;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((i=y.value)==null?void 0:i.tagName)!=="TEXTAREA"&&!((d=(f=y.value)==null?void 0:f.classList)!=null&&d.contains("cm-content"))&&(I.value="promql")}),be(()=>{L.value||T.value.tables||w()}),(c,n)=>{const i=rt,f=u("a-layout-sider"),d=$e,k=u("a-layout-content"),B=u("a-layout");return l(),m(B,{class:"layout"},{default:t(()=>[s(f,{class:"tables-sider",style:{width:"66.6%"},"resize-directions":["right"],onMovingEnd:U},{default:t(()=>{var M;return[s(i,{class:N(((M=a(v))==null?void 0:M.offsetWidth)<=650?"small":"big")},null,8,["class"])]}),_:1}),s(k,{class:"logs-content"},{default:t(()=>[s(d,{logs:a(O),types:A},null,8,["logs"])]),_:1})]),_:1})}}});const vt=X(_t,[["__scopeId","data-v-38b0a37e"]]);export{vt as default};
