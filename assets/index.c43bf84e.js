import{_ as oe}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.edca38da.js";import{_ as pe,u as me,a as ye}from"./python-code.816fbf3d.js";import{d as Q,b7 as ne,aI as u,D as l,aF as m,aH as t,aJ as s,aM as O,aN as d,aG as z,F as N,b8 as fe,E as p,aL as V,aK as F,e as ae,c as G,u as a,k as j,H as o,aW as J,aX as D,b0 as ee,b4 as he,aY as ge,aZ as be,o as ve,w as te,b9 as Te}from"./arco.a18c68e0.js";import{q as ke,r as xe,d as se,u as le}from"./query-code.4b28cd1c.js";import{_ as X,b as ce,u as ie,s as Ce,o as Ee}from"./index.067faa06.js";import{_ as Ie}from"./text-copyable.a3e75d52.js";import{s as H,j as we,k as Le}from"./vue.f3f254d8.js";import"./chart.4f759cbb.js";const Ae=Q({__name:"logs-layout",props:{logs:null,types:null},setup(f){const E=f;ne(T=>({"13fe7fa6":I}));const x=16,y=58,I=`calc(100vh - ${x*3+y}px`,{clearLogs:w}=ke(),S=()=>{w(E.types)};return(T,B)=>{const $=u("a-space"),C=u("a-button"),R=u("a-popconfirm"),q=pe,K=oe,h=u("a-list"),k=u("a-card");return l(),m(k,{class:"logs-card",bordered:!1},{title:t(()=>[s($,null,{default:t(()=>[O("Logs")]),_:1})]),extra:t(()=>[s(R,{content:"Clear logs?",type:"warning","ok-text":"Clear","cancel-text":"",onOk:S},{default:t(()=>[f.logs.length?(l(),m(C,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",size:"small"},{default:t(()=>[O(d(T.$t("dashboard.clear")),1)]),_:1})):z("",!0)]),_:1})]),default:t(()=>[s(h,{class:N(["logs-list",{"empty-list":!f.logs.length}]),size:"small",hoverable:!0,bordered:!1},{default:t(()=>[s(fe,{name:"list"},{default:t(()=>[(l(!0),p(V,null,F(f.logs,L=>(l(),m(q,{key:L,log:L},null,8,["log"]))),128)),f.logs.length?z("",!0):(l(),m(K,{key:0,class:"empty-log"}))]),_:1})]),_:1},8,["class"])]),_:1})}}});const Me=X(Ae,[["__scopeId","data-v-ed4de33a"]]),b=f=>(ge("data-v-f5f29bd0"),f=f(),be(),f),Se=b(()=>o("svg",{class:"icon brand-color"},[o("use",{href:"#refresh"})],-1)),$e=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#search"})],-1)),qe={class:"icon"},ze=["href"],Ne={key:0,class:"tree-data"},He={class:"data-title"},Be=b(()=>o("use",{href:"#columns"},null,-1)),Re=[Be],Ke=b(()=>o("use",{href:"#details"},null,-1)),Pe=[Ke],Oe=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#query"})],-1)),Ue={key:1,class:"tree-data"},We={class:"data-title columns"},Ve={class:"tree-data"},Fe={class:"data-type"},Ge=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#query"})],-1)),Qe={key:2,class:"detail-row"},Xe={key:0,class:"count-and-time"},Ye=b(()=>o("span",null,d("TTL"),-1)),Ze=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#refresh"})],-1)),je={key:1},Je={key:1},De=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#refresh"})],-1)),et={class:"left"},tt={key:0,class:"empty-sql"},st={key:1,class:"right"},lt={key:0,class:"icon-16"},ot=b(()=>o("use",{href:"#tables"},null,-1)),nt=[ot],at=Q({__name:"table-manager",setup(f){const{menuSelectedKey:E}=H(ce());me();const{tablesSearchKey:x,tablesTreeData:y,tablesTreeRef:I,isRefreshingDetails:w,refreshTables:S,loadMore:T,loadMoreColumns:B}=xe(),{tablesLoading:$,originTablesTree:C}=H(ie()),R=16,q=58,K=R*3+q,h=ae(),k=(c,n,r)=>{var i;n[r].length&&r!==n.childrenType&&((i=h.value)==null?void 0:i.includes(n.key))&&c.stopPropagation(),n.children=n[r],n.childrenType=r};G(()=>y.value.map(c=>({title:c.title,dataIndex:c.title})));const L={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},A={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]},U=(c,n)=>{c.stopPropagation(),n.columns.length||B(n)};return(c,n)=>{const r=u("a-button"),i=u("a-space"),v=u("a-input"),g=u("a-tooltip"),P=ye,M=u("a-spin"),Y=u("a-doption"),Z=u("a-dropdown"),W=Ie,re=u("a-typography-text"),_e=u("a-tree"),ue=oe,de=u("a-card");return l(),m(de,{class:"table-manager",bordered:!1},{title:t(()=>[s(i,{size:10},{default:t(()=>[O("Tables"),s(r,{type:"outline",size:"small",onClick:a(S)},{icon:t(()=>[Se]),_:1},8,["onClick"])]),_:1}),s(i,null,{default:t(()=>[s(v,{class:"search-table",modelValue:a(x),"onUpdate:modelValue":n[0]||(n[0]=e=>j(x)?x.value=e:null),"allow-clear":!0,placeholder:c.$t("dashboard.input")},{prefix:t(()=>[$e]),_:1},8,["modelValue","placeholder"])]),_:1})]),default:t(()=>[s(M,{style:{width:"100%"},loading:a($)},{default:t(()=>[a(y)&&a(y).length>0?(l(),m(_e,{key:0,class:"table-tree",ref_key:"tablesTreeRef",ref:I,"expanded-keys":a(h),"onUpdate:expandedKeys":n[3]||(n[3]=e=>j(h)?h.value=e:null),size:"small","action-on-node-click":"expand","block-node":!0,data:a(y),"load-more":a(T),animation:!1,"virtual-list-props":{height:`calc(100vh - ${K}px)`}},{icon:t(e=>[e.node.iconType?(l(),m(g,{key:0,content:e.node.iconType},{default:t(()=>[(l(),p("svg",qe,[o("use",{href:L[e.node.iconType]},null,8,ze)]))]),_:2},1032,["content"])):z("",!0)]),title:t(e=>[e.isLeaf?e.dataType?(l(),p("div",Ue,[o("div",We,d(e.title),1),o("div",Ve,[s(he,{name:"slide-fade"},{default:t(()=>[o("div",Fe,d(e.dataType),1)]),_:2},1024),e.dataType?(l(),m(Z,{key:0,class:"quick-select",trigger:"click",position:"right"},{content:t(()=>[(l(!0),p(V,null,F(A[e.iconType||"TABLE"],_=>J((l(),m(Y,null,{default:t(()=>[s(M,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(P,{type:_.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:_.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E)==="query"]])),256))]),default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(r,{type:"text",size:"small"},{icon:t(()=>[Ge]),_:1})]),_:1},8,["content"])]),_:2},1024)):z("",!0),s(W,{class:"title-copy columns",type:"text",data:e.title,"show-data":!1,onClick:n[2]||(n[2]=ee(()=>{},["stop"]))},null,8,["data"])])])):(l(),p("div",Qe,[e.title==="rowAndTime"?(l(),p("div",Xe,[s(i,{size:4},{default:t(()=>[o("span",null,d(c.$t("dashboard.rowCount")),1),o("span",null,d(e.info.rowCount),1)]),_:2},1024),s(i,null,{default:t(()=>[s(i,{size:4},{default:t(()=>[Ye,o("span",null,d(e.info.ttl),1)]),_:2},1024),s(r,{class:"refresh-details row-middle",type:"text",size:"small",loading:a(w)[e.parentKey],onClick:_=>a(T)(a(C)[e.parentKey])},{icon:t(()=>[Ze]),_:2},1032,["loading","onClick"])]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,d(c.$t("dashboard.minTime")),1),e.info.min!=="-"?(l(),m(g,{key:0,content:`${e.info.min}`},{default:t(()=>[o("span",null,d(a(se)(e.info.timestampType,e.info.min)),1)]),_:2},1032,["content"])):(l(),p("span",je,d(e.info.min),1))]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,d(c.$t("dashboard.maxTime")),1),e.info.max!=="-"?(l(),m(g,{key:0,content:`${e.info.max}`},{default:t(()=>[o("span",null,d(a(se)(e.info.timestampType,e.info.max)),1)]),_:2},1032,["content"])):(l(),p("span",Je,d(e.info.max),1))]),_:2},1024),s(r,{class:"refresh-details row-end",type:"text",size:"small",loading:a(w)[e.parentKey],onClick:_=>a(T)(a(C)[e.parentKey])},{icon:t(()=>[De]),_:2},1032,["loading","onClick"])])):(l(),m(i,{key:1},{default:t(()=>[s(i,{align:"start",class:N({"create-table":e.info.sql!=="-"}),size:4},{default:t(()=>[o("div",et,d(c.$t("dashboard.createTable")),1),e.info.sql==="-"?(l(),p("span",tt,d(e.info.sql),1)):(l(),p("div",st,[s(re,{class:"code-space"},{default:t(()=>[O(d(e.info.sql),1)]),_:2},1024),s(W,{class:"title-copy code",data:e.info.sql,showData:!1,copyTooltip:c.$t("dashboard.copyToClipboard")},null,8,["data","copyTooltip"])]))]),_:2},1032,["class"])]),_:2},1024))])):(l(),p("div",Ne,[s(g,{class:"data-type",mini:"",content:e.title},{default:t(()=>[o("div",He,d(e.title),1)]),_:2},1032,["content"]),s(i,{size:6},{default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.columns")},{default:t(()=>[s(r,{type:"text",size:"small",onClick:_=>k(_,e,"columns")},{icon:t(()=>{var _;return[(l(),p("svg",{class:N(["icon-16",e.childrenType==="columns"&&((_=a(h))==null?void 0:_.includes(e.key))?"":"icon-color"])},Re,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(g,{mini:"",content:c.$t("dashboard.details")},{default:t(()=>[s(r,{type:"text",size:"small",onClick:_=>k(_,e,"details")},{icon:t(()=>{var _;return[(l(),p("svg",{class:N(["icon-16",e.childrenType==="details"&&((_=a(h))==null?void 0:_.includes(e.key))?"":"icon-color"])},Pe,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(Z,{class:"quick-select",trigger:"click",position:"right",onClick:_=>U(_,e)},{content:t(()=>[(l(!0),p(V,null,F(A.TABLE,_=>J((l(),m(Y,null,{default:t(()=>[s(M,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(P,{type:_.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:_.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E)==="query"]])),256))]),default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(r,{type:"text",size:"small"},{icon:t(()=>[Oe]),_:1})]),_:1},8,["content"])]),_:2},1032,["onClick"]),s(W,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:n[1]||(n[1]=ee(()=>{},["stop"]))},null,8,["data"])]),_:2},1024)]))]),"switcher-icon":t(e=>[e.isLeaf?z("",!0):(l(),p("svg",lt,nt))]),_:1},8,["expanded-keys","data","load-more","virtual-list-props"])):(l(),m(ue,{key:1,class:"empty"}))]),_:1},8,["loading"])]),_:1})}}});const ct=X(at,[["__scopeId","data-v-f5f29bd0"]]),it=Q({__name:"index",setup(f){ne(c=>({"471e33b0":h,"103bf473":q}));const{s:E,q:x}=we(),y=Le(),{queryType:I}=le(),{guideModalVisible:w}=H(ce()),{getTables:S}=ie(),{dataStatusMap:T}=H(Ce()),{logs:B}=H(Ee()),{getResultsByType:$}=le(),q=`${258+16+636}px`,h=`${508+12}px`,k=ae();ve(()=>{k.value=document.getElementsByClassName("table-manager")[0]});const L=()=>{k.value=document.getElementsByClassName("table-manager")[0]},A=["sql","promql"];G(()=>$(A));const U=G(()=>B.value.filter(c=>A.includes(c.type)));return te(E,c=>{var n,r,i,v;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((r=y.value)==null?void 0:r.tagName)!=="TEXTAREA"&&!((v=(i=y.value)==null?void 0:i.classList)!=null&&v.contains("cm-content"))&&(I.value="sql")}),te(x,c=>{var n,r,i,v;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((r=y.value)==null?void 0:r.tagName)!=="TEXTAREA"&&!((v=(i=y.value)==null?void 0:i.classList)!=null&&v.contains("cm-content"))&&(I.value="promql")}),Te(()=>{w.value||T.value.tables||S()}),(c,n)=>{const r=ct,i=u("a-layout-sider"),v=Me,g=u("a-layout-content"),P=u("a-layout");return l(),m(P,{class:"layout"},{default:t(()=>[s(i,{class:"tables-sider",style:{width:"66.6%"},"resize-directions":["right"],onMovingEnd:L},{default:t(()=>{var M;return[s(r,{class:N(((M=a(k))==null?void 0:M.offsetWidth)<=650?"small":"big")},null,8,["class"])]}),_:1}),s(g,{class:"logs-content"},{default:t(()=>[s(v,{logs:a(U),types:A},null,8,["logs"])]),_:1})]),_:1})}}});const ht=X(it,[["__scopeId","data-v-38b0a37e"]]);export{ht as default};
