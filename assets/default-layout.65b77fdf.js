import{_ as Ee}from"./index.vue_vue_type_style_index_0_lang.39b4f39d.js";import{s as de,P as _e,_ as Re}from"./promql.bfbc6dc1.js";import{d as j,e as B,r as Ve,aQ as pe,c as I,w as Le,aI as s,D as r,aF as f,aH as e,aJ as o,u as t,H as c,aM as C,aN as g,E as T,k as ye,aL as Q,aK as W,aW as ze,aX as Me,aY as De,aZ as Be,a_ as se,a$ as ae,G as Ie,aG as oe,F as he,b0 as te,o as Ae,b1 as Ue,b as He,b2 as me,b3 as Oe,b4 as Pe}from"./arco.643eb8a8.js";import{o as Y,k as Z,a as Fe,T as fe}from"./index.7ec24099.js";import{u as Ne,q as Ge,d as Qe,a as We,t as je,_ as K,b as A,c as Ke,e as Je,f as Xe,l as Ye,r as ve,g as Ze}from"./index.d2991e61.js";import{g as be,s as ee,h as et}from"./vue.44e4333e.js";import{u as ne}from"./query-code.366f449f.js";import"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import"./chart.4225530a.js";const tt=n=>(se("data-v-6db23520"),n=n(),ae(),n),ot={class:"mr-4"},nt={class:"mr-4"},st={key:0},at={key:1},lt={class:"query-select"},rt=tt(()=>c("svg",{class:"icon"},[c("use",{href:"#question"})],-1)),it={class:"ml-4"},ut={class:"ml-2"},ct=j({__name:"editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(n){be();const{codes:a,queryType:l,cursorAt:v,queryOptions:k,primaryCodeRunning:h,secondaryCodeRunning:y,sqlView:w,promqlView:E}=ne(),i=B(),b=B(),m=B();B(!1),B(!1);const p=Ve({time:5,step:"30s",range:[pe().subtract(5,"minute").unix().toString(),pe().unix().toString()]}),{runQuery:z}=ne(),{originTablesTree:$}=ee(Ne()),R=I(()=>{if(a.value[l.value].trim().length===0)return!0;if(l.value==="promql"){const _=p.range?p.range.length>0:!1;if(p.step.trim().length===0||!p.time&&!_)return!0}return!!(h.value||y.value)}),U=_=>{w.value=_.view},H=_=>{E.value=_.view},O={height:"250px"},P=_=>{const u=_==="sql"?w.value:E.value;if(u&&_===l.value){const{state:q}=u,{ranges:V}=q.selection;if(v.value=[V[0].from,V[0].to],i.value=q.doc.lineAt(V[0].from).number,b.value=q.doc.lineAt(V[0].to).number,q.doc.text)m.value=q.doc.text.slice(i.value-1,b.value).join(" ");else{let L=[];q.doc.children.forEach(G=>{L=L.concat(G.text)}),m.value=L.slice(i.value-1,b.value).join(" ")}}},F=async()=>{h.value=!0,await z(a.value[l.value].trim(),l.value,!1,p),h.value=!1},N=I(()=>!m.value||m.value.trim().length===0?!0:R.value),x=async()=>{y.value=!0,await z(m.value.trim(),l.value,!1,p),y.value=!1},S=je.map(_=>({value:_,label:`Last ${_} minutes`})),M=[{key:"alt-Enter",run:()=>{F()}},{key:"ctrl-Enter",run:()=>{x()}}],D=I(()=>{const _={},u=new Set;return $.value.forEach(q=>{const V=q.columns.map(L=>(u.add(L.title),L.title));_[q.title]=V,u.add(q.title)}),{sql:{schema:_},promql:u}}),X={sql:[de(D.value.sql),Y,Z.of(M),Fe({closeOnBlur:!1})],promql:[new _e().asExtension(),Y,Z.of(M)]};return Le(D,()=>{X.sql=[de(D.value.sql),Y,Z.of(M)];const _=new _e().setComplete({remote:{fetchFn:()=>Promise.reject(),cache:{initialMetricList:[...D.value.promql]}}});X.promql=[_.asExtension(),Y,Z.of(M)]}),(_,u)=>{const q=s("icon-loading"),V=s("icon-play-arrow"),L=s("a-button"),G=s("a-space"),ge=s("a-option"),ke=s("a-select"),we=Re,re=s("a-form-item"),ie=s("a-typography-text"),ue=s("a-list-item"),qe=s("a-list"),$e=s("a-popover"),xe=s("a-input"),Se=s("a-form"),ce=s("a-tab-pane"),Ce=s("a-tabs"),Te=s("a-card");return r(),f(Te,{class:"editor-card",bordered:!1},{default:e(()=>[o(G,{class:"space-between pb-16"},{default:e(()=>[o(G,{size:"medium"},{default:e(()=>[o(L,{type:"primary",disabled:t(R),onClick:u[0]||(u[0]=d=>F())},{default:e(()=>[c("div",ot,[t(h)?(r(),f(q,{key:0,spin:""})):(r(),f(V,{key:1}))]),C(g(_.$t("dashboard.runAll")),1)]),_:1},8,["disabled"]),o(L,{disabled:t(N),onClick:u[1]||(u[1]=d=>x())},{default:e(()=>[c("div",nt,[t(y)?(r(),f(q,{key:0,spin:""})):(r(),f(V,{key:1}))]),t(i)===t(b)?(r(),T("div",st,g(_.$t("dashboard.runLine"))+" "+g(t(i)),1)):(r(),T("div",at,g(_.$t("dashboard.runLines"))+" "+g(t(i))+" - "+g(t(b)),1))]),_:1},8,["disabled"])]),_:1}),c("div",lt,[o(ke,{modelValue:t(l),"onUpdate:modelValue":u[2]||(u[2]=d=>ye(l)?l.value=d:null),"trigger-props":{"content-class":"query-select"}},{default:e(()=>[(r(!0),T(Q,null,W(t(k),d=>(r(),f(ge,ze(Me(d)),null,16))),256))]),_:1},8,["modelValue"])])]),_:1}),De(o(Se,{class:"space-between prom-form mb-16",layout:"inline",model:t(p)},{default:e(()=>[o(G,{size:"medium"},{default:e(()=>[o(re,{"hide-label":!0},{default:e(()=>[o(we,{"time-length":t(p).time,"onUpdate:timeLength":u[3]||(u[3]=d=>t(p).time=d),"time-range":t(p).range,"onUpdate:timeRange":u[4]||(u[4]=d=>t(p).range=d),"flex-direction":"row-reverse","button-class":"query-time-button","relative-time-map":t(Ge),"relative-time-options":t(S)},null,8,["time-length","time-range","relative-time-map","relative-time-options"])]),_:1}),o(re,{"hide-label":!0},{default:e(()=>[o(xe,{modelValue:t(p).step,"onUpdate:modelValue":u[5]||(u[5]=d=>t(p).step=d),"hide-button":"",style:{width:"180px"},placeholder:_.$t("dashboard.step")},{prefix:e(()=>[C("Step")]),suffix:e(()=>[o($e,{trigger:"hover"},{content:e(()=>[o(qe,{size:"small",split:!1,bordered:!1},{header:e(()=>[C(g(_.$t("dashboard.supportedDurations")),1)]),default:e(()=>[(r(!0),T(Q,null,W(t(Qe),d=>(r(),f(ue,{key:d},{default:e(()=>[o(ie,{code:""},{default:e(()=>[C(g(d.key),1)]),_:2},1024),c("span",it,g(d.value),1)]),_:2},1024))),128)),o(ue,null,{default:e(()=>[c("span",ut,g(_.$t("dashboard.examples")),1),(r(!0),T(Q,null,W(t(We),d=>(r(),f(ie,{key:d,code:""},{default:e(()=>[C(g(d),1)]),_:2},1024))),128))]),_:1})]),_:1})]),default:e(()=>[rt]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["model"]),[[Be,t(l)==="promql"]]),o(Ce,{class:"query-tabs","default-active-key":"sql","active-key":t(l)},{default:e(()=>[o(ce,{key:"sql"},{default:e(()=>[o(t(fe),{modelValue:t(a).sql,"onUpdate:modelValue":u[6]||(u[6]=d=>t(a).sql=d),style:O,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:X.sql,onReady:U,onUpdate:u[7]||(u[7]=d=>P("sql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1}),o(ce,{key:"promql"},{default:e(()=>[o(t(fe),{modelValue:t(a).promql,"onUpdate:modelValue":u[8]||(u[8]=d=>t(a).promql=d),style:O,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:X.promql,onReady:H,onUpdate:u[9]||(u[9]=d=>P("promql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1})]),_:1},8,["active-key"])]),_:1})}}});const dt=K(ct,[["__scopeId","data-v-6db23520"]]),le=n=>(se("data-v-d23246ab"),n=n(),ae(),n),_t=le(()=>c("svg",{class:"icon-18"},[c("use",{href:"#clear"})],-1)),pt={key:0,class:"icon-18"},mt=le(()=>c("use",{href:"#zoom-out"},null,-1)),ft=[mt],vt={key:1,class:"icon-18"},yt=le(()=>c("use",{href:"#zoom"},null,-1)),ht=[yt],bt=j({__name:"index",setup(n){const{queryModalVisible:a}=ee(A());A();const{getResultsByType:l,sqlView:v,promqlView:k,queryType:h,clearCode:y}=ne(),w=58,E=16,i=258,b=B(!1);B(!1);const m=["sql","promql"],p=I(()=>l(m)),z=()=>{h.value==="sql"?v.value.focus():k.value.focus()};return($,R)=>{const U=s("a-button"),H=s("a-space"),O=dt,P=Ee,F=s("a-scrollbar"),N=s("a-modal");return r(),f(N,{class:he(["query-modal",{"full-screen":t(b)}]),visible:t(a),"onUpdate:visible":R[1]||(R[1]=x=>ye(a)?a.value=x:null),"ok-text":$.$t("guide.confirm"),"hide-cancel":!0,width:t(b)?`calc(100vw - ${i}px - 32px)`:636,mask:!1,"align-center":!1,"mask-style":{"pointer-events":"none"},footer:!1,draggable:!0,onOpen:z},{title:e(()=>[C(g($.$t("menu.dashboard.query")),1),o(H,{fill:"",size:4},{default:e(()=>[o(U,{class:"screen-button",type:"text",size:"small",onClick:t(y)},{icon:e(()=>[_t]),_:1},8,["onClick"]),o(U,{class:"screen-button",type:"text",size:"small",onClick:R[0]||(R[0]=x=>b.value=!t(b))},{icon:e(()=>[t(b)?(r(),T("svg",pt,ft)):(r(),T("svg",vt,ht))]),_:1})]),_:1})]),default:e(()=>[o(H,{class:"editor-space",align:"start",fill:"",size:0},{default:e(()=>[o(F,{style:Ie({height:`calc(100vh - ${E*2+w}px)`,overflow:"auto"})},{default:e(()=>{var x;return[o(O),(x=t(p))!=null&&x.length?(r(),f(P,{key:0,class:"modal-view",results:t(p),types:m},null,8,["results"])):oe("",!0)]}),_:1},8,["style"])]),_:1})]),_:1},8,["visible","class","ok-text","width"])}}});const gt=K(bt,[["__scopeId","data-v-d23246ab"]]),kt="/assets/logo-text.e99088e0.png",wt=[...Ke,...Je],qt=wt.map(n=>{const{name:a,path:l,meta:v,redirect:k,children:h}=n;return{name:a,path:l,meta:v,redirect:k,children:h}});function $t(){const n=Xe(),a=A(),l=I(()=>a.menuFromServer?a.appAsyncMenus:qt);return{menuTree:I(()=>{const k=JSON.parse(JSON.stringify(l.value));k.sort((y,w)=>(y.meta.order||0)-(w.meta.order||0));function h(y,w){return y?y.map(i=>{var m,p;if(!n.accessRouter(i))return null;if(((m=i.meta)==null?void 0:m.hideChildrenInMenu)||!i.children)return i.children=[],i;i.children=i.children.filter(z=>{var $;return(($=z.meta)==null?void 0:$.hideInMenu)!==!0});const b=h(i.children,w+1);return b.length||w>1?(i.children=b,i):((p=i.meta)==null?void 0:p.hideInMenu)===!1?i:null}).filter(Boolean):null}return h(k,0)})}}const J=n=>(se("data-v-04169665"),n=n(),ae(),n),xt=J(()=>c("div",{class:"logo-space"},[c("img",{class:"logo-text-img",alt:"logo",src:kt})],-1)),St={class:"new-query"},Ct=J(()=>c("span",null,"+",-1)),Tt=J(()=>c("span",null,"New Query",-1)),Et={class:"menu"},Rt={class:"icon-18"},Vt=["href"],Lt={class:"footer"},zt=J(()=>c("svg",{class:"icon-20"},[c("use",{href:"#settings"})],-1)),Mt=J(()=>c("svg",{class:"icon-18"},[c("use",{href:"#menu"})],-1)),Dt=j({__name:"index",setup(n){const{updateSettings:a}=A(),{menuSelectedKey:l,globalSettings:v}=ee(A()),{menuTree:k}=$t(),h=k.value[0].children,y=[{link:"https://greptime.com/",label:"Home"},{link:"https://docs.greptime.com/",label:"Docs"},{link:"https://github.com/GreptimeTeam/dashboard",label:"GitHub | Dashboard"},{link:"https://github.com/GreptimeTeam/greptimedb",label:"GitHub | GreptimeDB"}],w=()=>{a({globalSettings:!0})},E=m=>{ve.push({name:m})},i=m=>{const p=ve.resolve({name:m});window.open(p.fullPath,"_blank")};Ye(m=>{l.value=m.name},!0);const b=()=>{a({queryModalVisible:!0})};return(m,p)=>{const z=s("a-layout-header"),$=s("a-button"),R=s("a-menu-item"),U=s("a-menu"),H=s("a-layout-content"),O=s("a-link"),P=s("a-doption"),F=s("a-dropdown"),N=s("a-layout-footer"),x=s("a-layout");return r(),f(x,{class:"navbar"},{default:e(()=>[o(z,null,{default:e(()=>[xt]),_:1}),o(H,null,{default:e(()=>[c("div",St,[o($,{type:"primary",onClick:b},{default:e(()=>[Ct,Tt]),_:1})]),c("div",Et,[o(U,{mode:"vertical","selected-keys":[t(l)]},{default:e(()=>[(r(!0),T(Q,null,W(t(h),(S,M)=>(r(),f(R,{key:S.name,onClick:[te(D=>i(S.name),["meta"]),te(D=>i(S.name),["ctrl"]),te(D=>E(S.name),["exact"])]},{icon:e(()=>[(r(),T("svg",Rt,[c("use",{href:`#${S.meta.icon}`},null,8,Vt)]))]),default:e(()=>[c("span",null,g(m.$t(S.meta.locale)),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["selected-keys"])])]),_:1}),o(N,null,{default:e(()=>[c("ul",Lt,[c("li",null,[o($,{style:{width:"100%"},class:he({hover:t(v)}),onClick:w},{icon:e(()=>[zt]),default:e(()=>[C(g(m.$t("settings.title")),1)]),_:1},8,["class"])]),c("li",null,[o(F,{class:"menu-dropdown",trigger:"hover",position:"right","popup-max-height":!1},{content:e(()=>[(r(),T(Q,null,W(y,({label:S,link:M})=>o(P,null,{default:e(()=>[o(O,{target:"_blank",href:M},{default:e(()=>[C(g(S),1)]),_:2},1032,["href"])]),_:2},1024)),64))]),default:e(()=>[o($,{style:{width:"100%"}},{icon:e(()=>[Mt]),default:e(()=>[C(g(m.$t("navbar.docs")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})}}});const Bt=K(Dt,[["__scopeId","data-v-04169665"]]);const It={};function At(n,a){const l=s("a-layout-footer");return r(),f(l,{class:"footer"},{default:e(()=>[C("\xA9Copyright 2022 Greptime Inc. All Rights Reserved")]),_:1})}const Ut=K(It,[["render",At],["__scopeId","data-v-d90f7d0d"]]);function Ht(n,a,l,v=!1){n.addEventListener&&typeof n.addEventListener=="function"&&n.addEventListener(a,l,v)}function Ot(n,a,l,v=!1){n.removeEventListener&&typeof n.removeEventListener=="function"&&n.removeEventListener(a,l,v)}const Pt=992;function Ft(){return document.body.getBoundingClientRect().width-1<Pt}function Nt(n){const a=A();function l(){if(!document.hidden){const k=Ft();a.toggleDevice(k?"mobile":"desktop"),a.toggleMenu(k)}}const v=et(l,100);Ae(()=>{n&&v()}),Ue(()=>{Ht(window,"resize",v)}),He(()=>{Ot(window,"resize",v)})}const Gt=j({__name:"page-layout",setup(n){const a=be(),l=Ze();return I(()=>l.getCacheList),(v,k)=>{const h=s("router-view");return r(),f(h,null,{default:e(({Component:y})=>[o(Pe,{name:"fade",mode:"out-in",appear:""},{default:e(()=>[t(a).meta.ignoreCache?(r(),f(me(y),{key:t(a).fullPath})):(r(),f(Oe,{key:1},[(r(),f(me(y),{key:t(a).name}))],1024))]),_:2},1024)]),_:1})}}}),Qt=j({__name:"default-layout",setup(n){Nt(!0);const{navbar:a,footer:l}=ee(A());return(v,k)=>{const h=Bt,y=s("a-layout-sider"),w=s("a-layout-content"),E=gt,i=s("a-layout");return r(),f(i,{class:"layout-container"},{default:e(()=>[o(y,{class:"main-sider",width:258},{default:e(()=>[t(a)?(r(),f(h,{key:0})):oe("",!0)]),_:1}),o(w,{class:"layout-content"},{default:e(()=>[o(Gt)]),_:1}),t(l)?(r(),f(Ut,{key:0})):oe("",!0),o(E)]),_:1})}}});const oo=K(Qt,[["__scopeId","data-v-480c2625"]]);export{oo as default};
