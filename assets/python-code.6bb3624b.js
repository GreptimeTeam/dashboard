import{d as P,c as F,aI as x,D as T,aF as R,aH as y,aJ as D,F as N,u as v,b7 as O,aM as B,aN as M,H as E,e as h,aT as H}from"./arco.2be430d2.js";import{u as U,q as V}from"./query-code.7edb7e08.js";import{b as j,h as q,v as J}from"./index.060ea89f.js";const K=E("svg",{class:"icon-18"},[E("use",{href:"#query"})],-1),X=P({__name:"index",props:{label:null,type:null,node:null,parent:null},setup(b){const a=b,{inputFromNewLineToQueryCode:r}=U(),{updateSettings:s}=j(),t=(i,l)=>{r(i,l),s({queryModalVisible:!0})},e=i=>i,n=(i,l,c)=>{const d=c.timeIndexName!=="%TIMESTAMP%"?` ORDER BY ${c.timeIndexName} `:" ";switch(i){case"select*100":return{code:e(`SELECT * FROM "${c.title}"${d}LIMIT 100;`),cursorPosition:0};case"count":return{code:e(`SELECT count(*) FROM "${c.title}" GROUP BY ${l.title};`),cursorPosition:0};case"where=":return{code:e(`SELECT * FROM "${c.title}" WHERE ${l.title} = ${d}DESC;`),cursorPosition:`${d}DESC;`.length};case"select100":return{code:e(`SELECT ${l.title} FROM "${c.title}"${d}DESC LIMIT 100;`),cursorPosition:0};case"max":return{code:e(`SELECT max(${l.title}) FROM "${c.title}";`),cursorPosition:0};case"min":return{code:e(`SELECT min(${l.title}) FROM "${c.title}";`),cursorPosition:0};case"where<":return{code:e(`SELECT * FROM "${c.title}" WHERE ${c.timeIndexName} < ${d}DESC LIMIT 100;`),cursorPosition:`${d}DESC LIMIT 100;`.length};default:return{code:"",cursorPosition:0}}},u=F(()=>n(a.type,a.node,a.parent));return(i,l)=>{const c=x("a-button"),d=x("a-tooltip");return T(),R(d,{content:v(u).code},{default:y(()=>[D(c,{type:"text",class:N({"arco-btn-only-icon":b.label===""}),onClick:l[0]||(l[0]=W=>t(v(u).code,v(u).cursorPosition))},O({default:y(()=>[B(M(b.label),1)]),_:2},[b.label===""?{name:"icon",fn:y(()=>[K]),key:"0"}:void 0]),1032,["class"])]),_:1},8,["content"])}}});class o{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(a,r=!1){return this.onePassHasher.start().appendStr(a).end(r)}static hashAsciiStr(a,r=!1){return this.onePassHasher.start().appendAsciiStr(a).end(r)}static _hex(a){const r=o.hexChars,s=o.hexOut;let t,e,n,u;for(u=0;u<4;u+=1)for(e=u*8,t=a[u],n=0;n<8;n+=2)s[e+1+n]=r.charAt(t&15),t>>>=4,s[e+0+n]=r.charAt(t&15),t>>>=4;return s.join("")}static _md5cycle(a,r){let s=a[0],t=a[1],e=a[2],n=a[3];s+=(t&e|~t&n)+r[0]-680876936|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+r[1]-389564586|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+r[2]+606105819|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+r[3]-1044525330|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+r[4]-176418897|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+r[5]+1200080426|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+r[6]-1473231341|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+r[7]-45705983|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+r[8]+1770035416|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+r[9]-1958414417|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+r[10]-42063|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+r[11]-1990404162|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+r[12]+1804603682|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+r[13]-40341101|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+r[14]-1502002290|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+r[15]+1236535329|0,t=(t<<22|t>>>10)+e|0,s+=(t&n|e&~n)+r[1]-165796510|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+r[6]-1069501632|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+r[11]+643717713|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+r[0]-373897302|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+r[5]-701558691|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+r[10]+38016083|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+r[15]-660478335|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+r[4]-405537848|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+r[9]+568446438|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+r[14]-1019803690|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+r[3]-187363961|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+r[8]+1163531501|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+r[13]-1444681467|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+r[2]-51403784|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+r[7]+1735328473|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+r[12]-1926607734|0,t=(t<<20|t>>>12)+e|0,s+=(t^e^n)+r[5]-378558|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+r[8]-2022574463|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+r[11]+1839030562|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+r[14]-35309556|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+r[1]-1530992060|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+r[4]+1272893353|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+r[7]-155497632|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+r[10]-1094730640|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+r[13]+681279174|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+r[0]-358537222|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+r[3]-722521979|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+r[6]+76029189|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+r[9]-640364487|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+r[12]-421815835|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+r[15]+530742520|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+r[2]-995338651|0,t=(t<<23|t>>>9)+e|0,s+=(e^(t|~n))+r[0]-198630844|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+r[7]+1126891415|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+r[14]-1416354905|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+r[5]-57434055|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+r[12]+1700485571|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+r[3]-1894986606|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+r[10]-1051523|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+r[1]-2054922799|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+r[8]+1873313359|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+r[15]-30611744|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+r[6]-1560198380|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+r[13]+1309151649|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+r[4]-145523070|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+r[11]-1120210379|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+r[2]+718787259|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+r[9]-343485551|0,t=(t<<21|t>>>11)+e|0,a[0]=s+a[0]|0,a[1]=t+a[1]|0,a[2]=e+a[2]|0,a[3]=n+a[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(o.stateIdentity),this}appendStr(a){const r=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n;for(n=0;n<a.length;n+=1){if(e=a.charCodeAt(n),e<128)r[t++]=e;else if(e<2048)r[t++]=(e>>>6)+192,r[t++]=e&63|128;else if(e<55296||e>56319)r[t++]=(e>>>12)+224,r[t++]=e>>>6&63|128,r[t++]=e&63|128;else{if(e=(e-55296)*1024+(a.charCodeAt(++n)-56320)+65536,e>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");r[t++]=(e>>>18)+240,r[t++]=e>>>12&63|128,r[t++]=e>>>6&63|128,r[t++]=e&63|128}t>=64&&(this._dataLength+=64,o._md5cycle(this._state,s),t-=64,s[0]=s[16])}return this._bufferLength=t,this}appendAsciiStr(a){const r=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(a.length-n,64-t);e--;)r[t++]=a.charCodeAt(n++);if(t<64)break;this._dataLength+=64,o._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}appendByteArray(a){const r=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(a.length-n,64-t);e--;)r[t++]=a[n++];if(t<64)break;this._dataLength+=64,o._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}getState(){const a=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[a[0],a[1],a[2],a[3]]}}setState(a){const r=a.buffer,s=a.state,t=this._state;let e;for(this._dataLength=a.length,this._bufferLength=a.buflen,t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e=0;e<r.length;e+=1)this._buffer8[e]=r.charCodeAt(e)}end(a=!1){const r=this._bufferLength,s=this._buffer8,t=this._buffer32,e=(r>>2)+1;this._dataLength+=r;const n=this._dataLength*8;if(s[r]=128,s[r+1]=s[r+2]=s[r+3]=0,t.set(o.buffer32Identity.subarray(e),e),r>55&&(o._md5cycle(this._state,t),t.set(o.buffer32Identity)),n<=4294967295)t[14]=n;else{const u=n.toString(16).match(/(.*?)(.{0,8})$/);if(u===null)return;const i=parseInt(u[2],16),l=parseInt(u[1],16)||0;t[14]=i,t[15]=l}return o._md5cycle(this._state,t),a?this._state:o._hex(this._state)}}o.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);o.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);o.hexChars="0123456789abcdef";o.hexOut=[];o.onePassHasher=new o;if(o.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const{saveScript:Q}=q(),f=h(""),_=h(""),S=h([]),p=h([]),C=h([]),g=h(""),m=h(!0),I=h(!1),L=h(!1),w=h(!1),A=h(!1),$=F(()=>o.hashStr(f.value)!==o.hashStr(_.value));function Z(){const{pushLog:b}=V(),a=i=>{f.value=f.value.substring(0,C.value[0])+i+f.value.substring(C.value[1])},r=i=>{g.value=i.key,m.value=!1,f.value=i.code,p.value=[i.key],_.value=f.value},s=()=>{g.value="",m.value=!0,f.value="",S.value=[],p.value=[],_.value="",L.value=!1},t=()=>{L.value=!0,$.value?I.value=!0:s()},e=i=>{S.value=[i],m.value=!1,_.value=f.value},n=async(i,l)=>{try{const c=await Q(i,l);H.success({content:J.global.t("dashboard.saveSuccess"),duration:2*1e3}),b(c,"python")}catch(c){throw b(JSON.parse(c.message),"python")}},u=F(()=>A.value===!0||w.value===!0||g.value.trim().length===0||f.value.trim().length===0);return{insertNameToPyCode:a,overwriteCode:r,createNewScript:t,selectAfterSave:e,resetScript:s,pythonCode:f,lastSavedCode:_,cursorAt:C,scriptName:g,isNewScript:m,scriptSelectedKeys:S,lastSelectedKey:p,isChanged:$,modelVisible:I,creating:L,isButtonDisabled:u,scriptSaving:w,scriptRunning:A,save:n}}export{X as _,Z as u};
