import{d as j,c as I,aI as m,D as d,aF as v,b6 as z,aH as u,aJ as S,H as p,aN as _,E as C,aL as X,aK as Z,aM as B,u as x,aG as T,F as k,e as g,aT as ee}from"./arco.7245f4cd.js";import{g as te}from"./vue.d9ab8e5d.js";import{u as U,q as se}from"./query-code.3066ea8c.js";import{b as K,_ as oe,m as ne,v as ae}from"./index.a7f2a4c7.js";const ce={class:"code"},re={class:"width-35"},ie={key:2,class:"script"},le={key:0},ue={key:1},fe={class:"start-time"},he={key:0},de={key:1,class:"total-time"},_e=j({__name:"log",props:{log:{type:Object,default:()=>({})},hasAction:{type:Boolean,default:!0}},setup(c){const a=c;te();const{inputFromNewLineToQueryCode:n,replaceCode:s}=U(),{updateSettings:t}=K(),e=I(()=>Reflect.has(a.log,"execution_time_ms")),o=()=>{t({queryModalVisible:!0}),a.log.type==="sql"?n(a.log.codeInfo,0):s(a.log.codeInfo)};return(i,l)=>{const h=m("icon-play-arrow"),f=m("a-button"),b=m("a-tooltip"),w=m("a-typography-text"),$=m("a-list-item"),Q=m("a-list"),O=m("a-popover"),G=m("icon-check-circle"),J=m("icon-close-circle"),A=m("a-space");return d(),v($,{class:"smaller-divider"},z({default:u(()=>[S(A,{direction:"vertical",fill:"",size:0},{default:u(()=>[p("div",ce,[c.log.error?(d(),v(b,{key:0,position:"tl",content:c.log.error},{default:u(()=>[p("div",null,_(c.log.error),1)]),_:1},8,["content"])):c.log.type!=="python"?(d(),v(O,{key:1,"content-class":"code-popup",position:"tl"},{content:u(()=>[S(Q,{size:"small",split:!1,bordered:!1},{default:u(()=>[c.log.type==="promql"?(d(!0),C(X,{key:0},Z(c.log.promInfo,(W,Y)=>(d(),v($,null,{default:u(()=>[p("span",re,_(Y),1),S(w,{class:"ml-4",code:""},{default:u(()=>[B(_(W),1)]),_:2},1024)]),_:2},1024))),256)):(d(),v($,{key:1},{default:u(()=>[S(w,{class:"popup"},{default:u(()=>[B(_(c.log.codeInfo),1)]),_:1})]),_:1}))]),_:1})]),default:u(()=>[p("div",null,_(c.log.codeInfo),1)]),_:1})):(d(),C("div",ie,[x(e)?(d(),C("div",le,_(i.$t("dashboard.runScript",{name:c.log.codeInfo})),1)):(d(),C("div",ue,_(i.$t("dashboard.saveName",{name:c.log.codeInfo})),1))]))]),S(A,{class:"info",fill:""},{default:u(()=>[c.log.error?(d(),v(J,{key:1,class:"danger-color"})):(d(),v(G,{key:0,class:"success-color icon-14"})),p("div",fe,_(c.log.startTime),1),c.log.error?T("",!0):(d(),v(A,{key:2,class:"result",fill:"",size:4},{default:u(()=>[x(e)?(d(),C("span",he,_(c.log.message),1)):T("",!0),x(e)?(d(),C("div",de,[S(O,{"content-class":"total-time-popover"},{content:u(()=>[p("div",null,_(i.$t("dashboard.executeTime",{time:c.log.execution_time_ms})),1),p("div",null,_(i.$t("dashboard.network",{time:c.log.networkTime-c.log.execution_time_ms})),1)]),default:u(()=>[p("div",null,_(`in ${c.log.networkTime} ms`),1)]),_:1})])):T("",!0)]),_:1}))]),_:1})]),_:1})]),_:2},[c.hasAction&&c.log.type!=="python"&&!c.log.error?{name:"actions",fn:u(()=>[S(f,{class:"play",type:"text",size:"small",onClick:o},{icon:u(()=>[S(h,{class:"icon-color"})]),_:1})]),key:"0"}:void 0]),1024)}}});const Se=oe(_e,[["__scopeId","data-v-0e563169"]]),me=p("svg",{class:"icon-18"},[p("use",{href:"#query"})],-1),Ce=j({__name:"index",props:{label:null,type:null,node:null,parent:null},setup(c){const a=c,{inputFromNewLineToQueryCode:n}=U(),{updateSettings:s}=K(),t=(l,h)=>{n(l,h),s({queryModalVisible:!0})},e=l=>l,o=(l,h,f)=>{const b=f.timeIndexName!=="%TIMESTAMP%"?` ORDER BY ${f.timeIndexName} `:" ";switch(l){case"select*100":return{code:e(`SELECT * FROM "${f.title}"${b}DESC LIMIT 100;`),cursorPosition:0};case"count":return{code:e(`SELECT count(*) FROM "${f.title}" GROUP BY ${h.title};`),cursorPosition:0};case"where=":return{code:e(`SELECT * FROM "${f.title}" WHERE ${h.title} = ${b}DESC;`),cursorPosition:`${b}DESC;`.length};case"select100":return{code:e(`SELECT ${h.title} FROM "${f.title}"${b}DESC LIMIT 100;`),cursorPosition:0};case"max":return{code:e(`SELECT max(${h.title}) FROM "${f.title}";`),cursorPosition:0};case"min":return{code:e(`SELECT min(${h.title}) FROM "${f.title}";`),cursorPosition:0};case"where<":return{code:e(`SELECT * FROM "${f.title}" WHERE ${f.timeIndexName} < ${b}DESC LIMIT 100;`),cursorPosition:`${b}DESC LIMIT 100;`.length};default:return{code:"",cursorPosition:0}}},i=I(()=>o(a.type,a.node,a.parent));return(l,h)=>{const f=m("a-button"),b=m("a-tooltip");return d(),v(b,{content:x(i).code},{default:u(()=>[S(f,{type:"text",class:k({"arco-btn-only-icon":c.label===""}),onClick:h[0]||(h[0]=w=>t(x(i).code,x(i).cursorPosition))},z({default:u(()=>[B(_(c.label),1)]),_:2},[c.label===""?{name:"icon",fn:u(()=>[me]),key:"0"}:void 0]),1032,["class"])]),_:1},8,["content"])}}});class r{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(a,n=!1){return this.onePassHasher.start().appendStr(a).end(n)}static hashAsciiStr(a,n=!1){return this.onePassHasher.start().appendAsciiStr(a).end(n)}static _hex(a){const n=r.hexChars,s=r.hexOut;let t,e,o,i;for(i=0;i<4;i+=1)for(e=i*8,t=a[i],o=0;o<8;o+=2)s[e+1+o]=n.charAt(t&15),t>>>=4,s[e+0+o]=n.charAt(t&15),t>>>=4;return s.join("")}static _md5cycle(a,n){let s=a[0],t=a[1],e=a[2],o=a[3];s+=(t&e|~t&o)+n[0]-680876936|0,s=(s<<7|s>>>25)+t|0,o+=(s&t|~s&e)+n[1]-389564586|0,o=(o<<12|o>>>20)+s|0,e+=(o&s|~o&t)+n[2]+606105819|0,e=(e<<17|e>>>15)+o|0,t+=(e&o|~e&s)+n[3]-1044525330|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&o)+n[4]-176418897|0,s=(s<<7|s>>>25)+t|0,o+=(s&t|~s&e)+n[5]+1200080426|0,o=(o<<12|o>>>20)+s|0,e+=(o&s|~o&t)+n[6]-1473231341|0,e=(e<<17|e>>>15)+o|0,t+=(e&o|~e&s)+n[7]-45705983|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&o)+n[8]+1770035416|0,s=(s<<7|s>>>25)+t|0,o+=(s&t|~s&e)+n[9]-1958414417|0,o=(o<<12|o>>>20)+s|0,e+=(o&s|~o&t)+n[10]-42063|0,e=(e<<17|e>>>15)+o|0,t+=(e&o|~e&s)+n[11]-1990404162|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&o)+n[12]+1804603682|0,s=(s<<7|s>>>25)+t|0,o+=(s&t|~s&e)+n[13]-40341101|0,o=(o<<12|o>>>20)+s|0,e+=(o&s|~o&t)+n[14]-1502002290|0,e=(e<<17|e>>>15)+o|0,t+=(e&o|~e&s)+n[15]+1236535329|0,t=(t<<22|t>>>10)+e|0,s+=(t&o|e&~o)+n[1]-165796510|0,s=(s<<5|s>>>27)+t|0,o+=(s&e|t&~e)+n[6]-1069501632|0,o=(o<<9|o>>>23)+s|0,e+=(o&t|s&~t)+n[11]+643717713|0,e=(e<<14|e>>>18)+o|0,t+=(e&s|o&~s)+n[0]-373897302|0,t=(t<<20|t>>>12)+e|0,s+=(t&o|e&~o)+n[5]-701558691|0,s=(s<<5|s>>>27)+t|0,o+=(s&e|t&~e)+n[10]+38016083|0,o=(o<<9|o>>>23)+s|0,e+=(o&t|s&~t)+n[15]-660478335|0,e=(e<<14|e>>>18)+o|0,t+=(e&s|o&~s)+n[4]-405537848|0,t=(t<<20|t>>>12)+e|0,s+=(t&o|e&~o)+n[9]+568446438|0,s=(s<<5|s>>>27)+t|0,o+=(s&e|t&~e)+n[14]-1019803690|0,o=(o<<9|o>>>23)+s|0,e+=(o&t|s&~t)+n[3]-187363961|0,e=(e<<14|e>>>18)+o|0,t+=(e&s|o&~s)+n[8]+1163531501|0,t=(t<<20|t>>>12)+e|0,s+=(t&o|e&~o)+n[13]-1444681467|0,s=(s<<5|s>>>27)+t|0,o+=(s&e|t&~e)+n[2]-51403784|0,o=(o<<9|o>>>23)+s|0,e+=(o&t|s&~t)+n[7]+1735328473|0,e=(e<<14|e>>>18)+o|0,t+=(e&s|o&~s)+n[12]-1926607734|0,t=(t<<20|t>>>12)+e|0,s+=(t^e^o)+n[5]-378558|0,s=(s<<4|s>>>28)+t|0,o+=(s^t^e)+n[8]-2022574463|0,o=(o<<11|o>>>21)+s|0,e+=(o^s^t)+n[11]+1839030562|0,e=(e<<16|e>>>16)+o|0,t+=(e^o^s)+n[14]-35309556|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^o)+n[1]-1530992060|0,s=(s<<4|s>>>28)+t|0,o+=(s^t^e)+n[4]+1272893353|0,o=(o<<11|o>>>21)+s|0,e+=(o^s^t)+n[7]-155497632|0,e=(e<<16|e>>>16)+o|0,t+=(e^o^s)+n[10]-1094730640|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^o)+n[13]+681279174|0,s=(s<<4|s>>>28)+t|0,o+=(s^t^e)+n[0]-358537222|0,o=(o<<11|o>>>21)+s|0,e+=(o^s^t)+n[3]-722521979|0,e=(e<<16|e>>>16)+o|0,t+=(e^o^s)+n[6]+76029189|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^o)+n[9]-640364487|0,s=(s<<4|s>>>28)+t|0,o+=(s^t^e)+n[12]-421815835|0,o=(o<<11|o>>>21)+s|0,e+=(o^s^t)+n[15]+530742520|0,e=(e<<16|e>>>16)+o|0,t+=(e^o^s)+n[2]-995338651|0,t=(t<<23|t>>>9)+e|0,s+=(e^(t|~o))+n[0]-198630844|0,s=(s<<6|s>>>26)+t|0,o+=(t^(s|~e))+n[7]+1126891415|0,o=(o<<10|o>>>22)+s|0,e+=(s^(o|~t))+n[14]-1416354905|0,e=(e<<15|e>>>17)+o|0,t+=(o^(e|~s))+n[5]-57434055|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~o))+n[12]+1700485571|0,s=(s<<6|s>>>26)+t|0,o+=(t^(s|~e))+n[3]-1894986606|0,o=(o<<10|o>>>22)+s|0,e+=(s^(o|~t))+n[10]-1051523|0,e=(e<<15|e>>>17)+o|0,t+=(o^(e|~s))+n[1]-2054922799|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~o))+n[8]+1873313359|0,s=(s<<6|s>>>26)+t|0,o+=(t^(s|~e))+n[15]-30611744|0,o=(o<<10|o>>>22)+s|0,e+=(s^(o|~t))+n[6]-1560198380|0,e=(e<<15|e>>>17)+o|0,t+=(o^(e|~s))+n[13]+1309151649|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~o))+n[4]-145523070|0,s=(s<<6|s>>>26)+t|0,o+=(t^(s|~e))+n[11]-1120210379|0,o=(o<<10|o>>>22)+s|0,e+=(s^(o|~t))+n[2]+718787259|0,e=(e<<15|e>>>17)+o|0,t+=(o^(e|~s))+n[9]-343485551|0,t=(t<<21|t>>>11)+e|0,a[0]=s+a[0]|0,a[1]=t+a[1]|0,a[2]=e+a[2]|0,a[3]=o+a[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(r.stateIdentity),this}appendStr(a){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,o;for(o=0;o<a.length;o+=1){if(e=a.charCodeAt(o),e<128)n[t++]=e;else if(e<2048)n[t++]=(e>>>6)+192,n[t++]=e&63|128;else if(e<55296||e>56319)n[t++]=(e>>>12)+224,n[t++]=e>>>6&63|128,n[t++]=e&63|128;else{if(e=(e-55296)*1024+(a.charCodeAt(++o)-56320)+65536,e>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");n[t++]=(e>>>18)+240,n[t++]=e>>>12&63|128,n[t++]=e>>>6&63|128,n[t++]=e&63|128}t>=64&&(this._dataLength+=64,r._md5cycle(this._state,s),t-=64,s[0]=s[16])}return this._bufferLength=t,this}appendAsciiStr(a){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,o=0;for(;;){for(e=Math.min(a.length-o,64-t);e--;)n[t++]=a.charCodeAt(o++);if(t<64)break;this._dataLength+=64,r._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}appendByteArray(a){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,o=0;for(;;){for(e=Math.min(a.length-o,64-t);e--;)n[t++]=a[o++];if(t<64)break;this._dataLength+=64,r._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}getState(){const a=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[a[0],a[1],a[2],a[3]]}}setState(a){const n=a.buffer,s=a.state,t=this._state;let e;for(this._dataLength=a.length,this._bufferLength=a.buflen,t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e=0;e<n.length;e+=1)this._buffer8[e]=n.charCodeAt(e)}end(a=!1){const n=this._bufferLength,s=this._buffer8,t=this._buffer32,e=(n>>2)+1;this._dataLength+=n;const o=this._dataLength*8;if(s[n]=128,s[n+1]=s[n+2]=s[n+3]=0,t.set(r.buffer32Identity.subarray(e),e),n>55&&(r._md5cycle(this._state,t),t.set(r.buffer32Identity)),o<=4294967295)t[14]=o;else{const i=o.toString(16).match(/(.*?)(.{0,8})$/);if(i===null)return;const l=parseInt(i[2],16),h=parseInt(i[1],16)||0;t[14]=l,t[15]=h}return r._md5cycle(this._state,t),a?this._state:r._hex(this._state)}}r.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);r.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);r.hexChars="0123456789abcdef";r.hexOut=[];r.onePassHasher=new r;if(r.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const{saveScript:ge}=ne(),y=g(""),L=g(""),P=g([]),N=g([]),R=g([]),F=g(""),E=g(!0),M=g(!1),D=g(!1),H=g(!1),V=g(!1),q=I(()=>r.hashStr(y.value)!==r.hashStr(L.value));function xe(){const{pushLog:c}=se(),a=l=>{y.value=y.value.substring(0,R.value[0])+l+y.value.substring(R.value[1])},n=l=>{F.value=l.key,E.value=!1,y.value=l.code,N.value=[l.key],L.value=y.value},s=()=>{F.value="",E.value=!0,y.value="",P.value=[],N.value=[],L.value="",D.value=!1},t=()=>{D.value=!0,q.value?M.value=!0:s()},e=l=>{P.value=[l],E.value=!1,L.value=y.value},o=async(l,h)=>{try{const f=await ge(l,h);ee.success({content:ae.global.t("dashboard.saveSuccess"),duration:2*1e3}),c(f,"python")}catch(f){throw c(JSON.parse(f.message),"python")}},i=I(()=>V.value===!0||H.value===!0||F.value.trim().length===0||y.value.trim().length===0);return{insertNameToPyCode:a,overwriteCode:n,createNewScript:t,selectAfterSave:e,resetScript:s,pythonCode:y,lastSavedCode:L,cursorAt:R,scriptName:F,isNewScript:E,scriptSelectedKeys:P,lastSelectedKey:N,isChanged:q,modelVisible:M,creating:D,isButtonDisabled:i,scriptSaving:H,scriptRunning:V,save:o}}export{Se as _,Ce as a,xe as u};
