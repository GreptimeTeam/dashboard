import{_ as se}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.edca38da.js";import{_ as de,u as pe}from"./python-code.bda30b94.js";import{d as U,b7 as oe,aI as r,D as o,aF as f,aH as t,aJ as s,aM as B,aN as _,aG as O,F as P,b8 as me,E as b,aL as G,aK as Q,c as W,u as l,b5 as ye,H as n,e as ne,k as j,aW as J,b0 as V,aX as D,b4 as fe,aY as he,aZ as ge,o as be,w as ee,b9 as Te}from"./arco.a18c68e0.js";import{p as ve,u as X,q as Ee}from"./query-code.998882bc.js";import{_ as Y,b as Z,u as le,m as te,x as ke,s as Ce}from"./index.6418be78.js";import{_ as xe}from"./text-copyable.ed31dc1d.js";import{s as H,j as $e,k as Ie}from"./vue.f3f254d8.js";import"./chart.4f759cbb.js";const Se=U({__name:"logs-layout",props:{logs:null,types:null},setup(d){const k=d;oe(E=>({"13fe7fa6":L}));const $=16,h=58,L=`calc(100vh - ${$*3+h}px`,{clearLogs:T}=ve(),w=()=>{T(k.types)};return(E,C)=>{const p=r("a-space"),i=r("a-button"),v=r("a-popconfirm"),A=de,F=se,x=r("a-list"),M=r("a-card");return o(),f(M,{class:"logs-card",bordered:!1},{title:t(()=>[s(p,null,{default:t(()=>[B("Logs")]),_:1})]),extra:t(()=>[s(v,{content:"Clear logs?",type:"warning","ok-text":"Clear","cancel-text":"",onOk:w},{default:t(()=>[d.logs.length?(o(),f(i,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",size:"small"},{default:t(()=>[B(_(E.$t("dashboard.clear")),1)]),_:1})):O("",!0)]),_:1})]),default:t(()=>[s(x,{class:P(["logs-list",{"empty-list":!d.logs.length}]),size:"small",hoverable:!0,bordered:!1},{default:t(()=>[s(me,{name:"list"},{default:t(()=>[(o(!0),b(G,null,Q(d.logs,R=>(o(),f(A,{key:R,log:R},null,8,["log"]))),128)),d.logs.length?O("",!0):(o(),f(F,{key:0,class:"empty-log"}))]),_:1})]),_:1},8,["class"])]),_:1})}}});const Le=Y(Se,[["__scopeId","data-v-ed4de33a"]]),Me=n("svg",{class:"icon-16 icon-color"},[n("use",{href:"#query"})],-1),we=U({__name:"index",props:{label:null,type:null,node:null,parent:null},setup(d){const k=d,{inputFromNewLineToQueryCode:$}=X(),{updateSettings:h}=Z(),L=(C,p)=>{$(C,p),h({queryModalVisible:!0})},T=C=>C,w=(C,p,i)=>{const v=i.timeIndexName!=="%TIMESTAMP%"?` ORDER BY ${i.timeIndexName} `:" ";switch(C){case"select*100":return{code:T(`SELECT * FROM "${i.title}"${v}DESC LIMIT 100;`),cursorPosition:0};case"count":return{code:T(`SELECT count(*) FROM "${i.title}" GROUP BY ${p.title};`),cursorPosition:0};case"where=":return{code:T(`SELECT * FROM "${i.title}" WHERE ${p.title} = ${v}DESC;`),cursorPosition:`${v}DESC;`.length};case"select100":return{code:T(`SELECT ${p.title} FROM "${i.title}"${v}DESC LIMIT 100;`),cursorPosition:0};case"max":return{code:T(`SELECT max(${p.title}) FROM "${i.title}";`),cursorPosition:0};case"min":return{code:T(`SELECT min(${p.title}) FROM "${i.title}";`),cursorPosition:0};case"where<":return{code:T(`SELECT * FROM "${i.title}" WHERE ${i.timeIndexName} < ${v}DESC LIMIT 100;`),cursorPosition:`${v}DESC LIMIT 100;`.length};default:return{code:"",cursorPosition:0}}},E=W(()=>w(k.type,k.node,k.parent));return(C,p)=>{const i=r("a-button"),v=r("a-tooltip");return o(),f(v,{content:l(E).code},{default:t(()=>[s(i,{type:"text",size:"small",class:P({"arco-btn-only-icon":d.label===""}),onClick:p[0]||(p[0]=A=>L(l(E).code,l(E).cursorPosition))},ye({default:t(()=>[B(_(d.label),1)]),_:2},[d.label===""?{name:"icon",fn:t(()=>[Me]),key:"0"}:void 0]),1032,["class"])]),_:1},8,["content"])}}}),S=d=>(he("data-v-4af98b65"),d=d(),ge(),d),Ae=S(()=>n("svg",{class:"icon brand-color"},[n("use",{href:"#refresh"})],-1)),Re=S(()=>n("svg",{class:"icon icon-color"},[n("use",{href:"#search"})],-1)),Ne={class:"icon"},Pe=["href"],qe={key:0,class:"tree-data"},ze={class:"data-title"},Oe=S(()=>n("use",{href:"#columns"},null,-1)),He=[Oe],Be=S(()=>n("use",{href:"#details"},null,-1)),Fe=[Be],Ke={key:1,class:"tree-data"},We={class:"data-title columns"},Ue={class:"tree-data"},Ve={class:"data-type"},Ge=S(()=>n("svg",{class:"icon-16 icon-color"},[n("use",{href:"#query"})],-1)),Qe={key:2,class:"detail-row"},Xe={key:0,class:"count-and-time"},Ye=S(()=>n("span",null,_("TTL"),-1)),Ze=S(()=>n("svg",{class:"icon icon-color"},[n("use",{href:"#refresh"})],-1)),je={key:1},Je={key:1},De=S(()=>n("svg",{class:"icon icon-color"},[n("use",{href:"#refresh"})],-1)),et={class:"left"},tt={key:0,class:"empty-sql"},st={key:1,class:"right"},ot={key:0,class:"icon-16"},nt=S(()=>n("use",{href:"#tables"},null,-1)),lt=[nt],at=U({__name:"table-manager",setup(d){const{menuSelectedKey:k}=H(Z());pe();const{tablesSearchKey:$,tablesTreeData:h,tablesTreeRef:L,isRefreshingDetails:T,refreshTables:w,loadMore:E,loadMoreColumns:C}=Ee(),{tablesLoading:p,originTablesTree:i}=H(le()),v=16,A=58,F=v*3+A,x=ne(),M=(m,a,u)=>{var c;a[u].length&&u!==a.childrenType&&((c=x.value)==null?void 0:c.includes(a.key))&&m.stopPropagation(),a.children=a[u],a.childrenType=u};W(()=>h.value.map(m=>({title:m.title,dataIndex:m.title})));const R={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},N={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]};return(m,a)=>{const u=r("a-button"),c=r("a-space"),I=r("a-input"),g=r("a-tooltip"),K=we,q=xe,z=r("a-spin"),ae=r("a-doption"),ce=r("a-dropdown"),ie=r("a-typography-text"),re=r("a-tree"),ue=se,_e=r("a-card");return o(),f(_e,{class:"table-manager",bordered:!1},{title:t(()=>[s(c,{size:10},{default:t(()=>[B("Tables"),s(u,{type:"outline",size:"small",onClick:l(w)},{icon:t(()=>[Ae]),_:1},8,["onClick"])]),_:1}),s(c,null,{default:t(()=>[s(I,{class:"search-table",modelValue:l($),"onUpdate:modelValue":a[0]||(a[0]=e=>j($)?$.value=e:null),"allow-clear":!0,placeholder:m.$t("dashboard.input")},{prefix:t(()=>[Re]),_:1},8,["modelValue","placeholder"])]),_:1})]),default:t(()=>[s(z,{style:{width:"100%"},loading:l(p)},{default:t(()=>[l(h)&&l(h).length>0?(o(),f(re,{key:0,class:"table-tree",ref_key:"tablesTreeRef",ref:L,"expanded-keys":l(x),"onUpdate:expandedKeys":a[4]||(a[4]=e=>j(x)?x.value=e:null),size:"small","action-on-node-click":"expand","block-node":!0,data:l(h),"load-more":l(E),animation:!1,"virtual-list-props":{height:`calc(100vh - ${F}px)`}},{icon:t(e=>[e.node.iconType?(o(),f(g,{key:0,content:e.node.iconType},{default:t(()=>[(o(),b("svg",Ne,[n("use",{href:R[e.node.iconType]},null,8,Pe)]))]),_:2},1032,["content"])):O("",!0)]),title:t(e=>[e.isLeaf?e.dataType?(o(),b("div",Ke,[n("div",We,_(e.title),1),n("div",Ue,[s(fe,{name:"slide-fade"},{default:t(()=>[n("div",Ve,_(e.dataType),1)]),_:2},1024),e.dataType?(o(),f(ce,{key:0,class:"quick-select",trigger:"click",position:"right"},{content:t(()=>[(o(!0),b(G,null,Q(N[e.iconType||"TABLE"],y=>J((o(),f(ae,null,{default:t(()=>[s(z,{style:{width:"100%"},loading:e.columns&&!e.columns.length},{default:t(()=>[s(K,{type:y.value,node:e,parent:e.iconType?l(i)[e.parentKey]:e,label:y.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,l(k)==="query"]])),256))]),default:t(()=>[s(g,{mini:"",content:m.$t("dashboard.quickSelect")},{default:t(()=>[s(u,{type:"text",size:"small"},{icon:t(()=>[Ge]),_:1})]),_:1},8,["content"])]),_:2},1024)):O("",!0),s(q,{class:"title-copy columns",type:"text",data:e.title,"show-data":!1,onClick:a[3]||(a[3]=V(()=>{},["stop"]))},null,8,["data"])])])):(o(),b("div",Qe,[e.title==="rowAndTime"?(o(),b("div",Xe,[s(c,{size:4},{default:t(()=>[n("span",null,_(m.$t("dashboard.rowCount")),1),n("span",null,_(e.info.rowCount),1)]),_:2},1024),s(c,null,{default:t(()=>[s(c,{size:4},{default:t(()=>[Ye,n("span",null,_(e.info.ttl),1)]),_:2},1024),s(u,{class:"refresh-details row-middle",type:"text",size:"small",loading:l(T)[e.parentKey],onClick:y=>l(E)(l(i)[e.parentKey])},{icon:t(()=>[Ze]),_:2},1032,["loading","onClick"])]),_:2},1024),s(c,{size:4},{default:t(()=>[n("span",null,_(m.$t("dashboard.minTime")),1),e.info.min!=="-"?(o(),f(g,{key:0,content:`${e.info.min}`},{default:t(()=>[n("span",null,_(l(te)(e.info.timestampType,e.info.min)),1)]),_:2},1032,["content"])):(o(),b("span",je,_(e.info.min),1))]),_:2},1024),s(c,{size:4},{default:t(()=>[n("span",null,_(m.$t("dashboard.maxTime")),1),e.info.max!=="-"?(o(),f(g,{key:0,content:`${e.info.max}`},{default:t(()=>[n("span",null,_(l(te)(e.info.timestampType,e.info.max)),1)]),_:2},1032,["content"])):(o(),b("span",Je,_(e.info.max),1))]),_:2},1024),s(u,{class:"refresh-details row-end",type:"text",size:"small",loading:l(T)[e.parentKey],onClick:y=>l(E)(l(i)[e.parentKey])},{icon:t(()=>[De]),_:2},1032,["loading","onClick"])])):(o(),f(c,{key:1},{default:t(()=>[s(c,{align:"start",class:P({"create-table":e.info.sql!=="-"}),size:4},{default:t(()=>[n("div",et,_(m.$t("dashboard.createTable")),1),e.info.sql==="-"?(o(),b("span",tt,_(e.info.sql),1)):(o(),b("div",st,[s(ie,{class:"code-space"},{default:t(()=>[B(_(e.info.sql),1)]),_:2},1024),s(q,{class:"title-copy code",data:e.info.sql,showData:!1,copyTooltip:m.$t("dashboard.copyToClipboard")},null,8,["data","copyTooltip"])]))]),_:2},1032,["class"])]),_:2},1024))])):(o(),b("div",qe,[s(g,{class:"data-type",mini:"",content:e.title},{default:t(()=>[n("div",ze,_(e.title),1)]),_:2},1032,["content"]),s(c,{size:6},{default:t(()=>[s(g,{mini:"",content:m.$t("dashboard.columns")},{default:t(()=>[s(u,{type:"text",size:"small",onClick:y=>M(y,e,"columns")},{icon:t(()=>{var y;return[(o(),b("svg",{class:P(["icon-16",e.childrenType==="columns"&&((y=l(x))==null?void 0:y.includes(e.key))?"":"icon-color"])},He,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(g,{mini:"",content:m.$t("dashboard.details")},{default:t(()=>[s(u,{type:"text",size:"small",onClick:y=>M(y,e,"details")},{icon:t(()=>{var y;return[(o(),b("svg",{class:P(["icon-16",e.childrenType==="details"&&((y=l(x))==null?void 0:y.includes(e.key))?"":"icon-color"])},Fe,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),(o(!0),b(G,null,Q(N.TABLE,y=>J((o(),f(c,{onClick:a[1]||(a[1]=V(()=>{},["stop"]))},{default:t(()=>[s(K,{type:y.value,node:e,parent:e.iconType?l(i)[e.parentKey]:e,label:""},null,8,["type","node","parent"])]),_:2},1536)),[[D,l(k)==="query"]])),256)),s(q,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:a[2]||(a[2]=V(()=>{},["stop"]))},null,8,["data"])]),_:2},1024)]))]),"switcher-icon":t(e=>[e.isLeaf?O("",!0):(o(),b("svg",ot,lt))]),_:1},8,["expanded-keys","data","load-more","virtual-list-props"])):(o(),f(ue,{key:1,class:"empty"}))]),_:1},8,["loading"])]),_:1})}}});const ct=Y(at,[["__scopeId","data-v-4af98b65"]]),it=U({__name:"index",setup(d){oe(a=>({"4a5041dc":x,"42e54a27":A}));const{s:k,q:$}=$e(),h=Ie(),{queryType:L}=X(),{guideModalVisible:T}=H(Z()),{getTables:w}=le(),{dataStatusMap:E}=H(ke()),{logs:C}=H(Ce()),{getResultsByType:p}=X(),A=`${242+16+636}px`,x=`${508+12}px`,M=ne();be(()=>{M.value=document.getElementsByClassName("table-manager")[0]});const R=()=>{M.value=document.getElementsByClassName("table-manager")[0]},N=["sql","promql"];W(()=>p(N));const m=W(()=>C.value.filter(a=>N.includes(a.type)));return ee(k,a=>{var u,c,I,g;((u=h.value)==null?void 0:u.tagName)!=="INPUT"&&((c=h.value)==null?void 0:c.tagName)!=="TEXTAREA"&&!((g=(I=h.value)==null?void 0:I.classList)!=null&&g.contains("cm-content"))&&(L.value="sql")}),ee($,a=>{var u,c,I,g;((u=h.value)==null?void 0:u.tagName)!=="INPUT"&&((c=h.value)==null?void 0:c.tagName)!=="TEXTAREA"&&!((g=(I=h.value)==null?void 0:I.classList)!=null&&g.contains("cm-content"))&&(L.value="promql")}),Te(()=>{T.value||E.value.tables||w()}),(a,u)=>{const c=ct,I=r("a-layout-sider"),g=Le,K=r("a-layout-content"),q=r("a-layout");return o(),f(q,{class:"layout"},{default:t(()=>[s(I,{class:"tables-sider",style:{width:"66.6%"},"resize-directions":["right"],onMovingEnd:R},{default:t(()=>{var z;return[s(c,{class:P(((z=l(M))==null?void 0:z.offsetWidth)<=650?"small":"big")},null,8,["class"])]}),_:1}),s(K,{class:"logs-content"},{default:t(()=>[s(g,{logs:l(m),types:N},null,8,["logs"])]),_:1})]),_:1})}}});const ht=Y(it,[["__scopeId","data-v-d344d529"]]);export{ht as default};
