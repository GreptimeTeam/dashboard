import{_ as oe}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import{_ as pe}from"./log.fffebfeb.js";import{d as Q,b7 as ne,aI as d,D as l,aF as m,aH as t,aJ as s,aM as P,aN as u,aG as q,F as z,b8 as me,E as p,aL as W,aK as F,e as ae,c as G,u as a,k as j,H as o,aY as J,aZ as D,b0 as ee,b4 as ye,a_ as fe,a$ as he,o as ge,w as te,b9 as be}from"./arco.643eb8a8.js";import{g as ce,s as K,j as ve,k as Te}from"./vue.44e4333e.js";import{q as ke,r as xe,d as se,u as le}from"./query-code.57b3ee08.js";import{_ as X,u as ie,b as Ce,s as Ee,i as Ie}from"./index.418a17e0.js";import{_ as Le}from"./text-copyable.eef3c097.js";import{u as we,_ as Ae}from"./python-code.bfd4f9ff.js";import"./chart.4225530a.js";const Me=Q({__name:"logs-layout",props:{logs:null,types:null},setup(f){const E=f;ne(k=>({"51d2e0fa":I}));const x=16,y=58,I=`calc(100vh - ${x*3+y}px`;ce();const{clearLogs:L}=ke(),M=()=>{L(E.types)};return(k,N)=>{const $=d("a-space"),C=d("a-button"),H=pe,S=oe,R=d("a-list"),h=d("a-card");return l(),m(h,{class:"logs-card",bordered:!1},{title:t(()=>[s($,null,{default:t(()=>[P("Logs")]),_:1})]),extra:t(()=>[f.logs.length?(l(),m(C,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",size:"small",onClick:M},{default:t(()=>[P(u(k.$t("dashboard.clear")),1)]),_:1})):q("",!0)]),default:t(()=>[s(R,{class:z(["logs-list",{"empty-list":!f.logs.length}]),size:"small",hoverable:!0,bordered:!1},{default:t(()=>[s(me,{name:"list"},{default:t(()=>[(l(!0),p(W,null,F(f.logs,v=>(l(),m(H,{key:v,log:v},null,8,["log"]))),128)),f.logs.length?q("",!0):(l(),m(S,{key:0,class:"empty-log"}))]),_:1})]),_:1},8,["class"])]),_:1})}}});const $e=X(Me,[["__scopeId","data-v-0a10e9ae"]]),b=f=>(fe("data-v-bfdb7972"),f=f(),he(),f),Se=b(()=>o("svg",{class:"icon brand-color"},[o("use",{href:"#refresh"})],-1)),qe=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#search"})],-1)),ze={class:"icon"},Ne=["href"],He={key:0,class:"tree-data"},Re={class:"data-title"},Be=b(()=>o("use",{href:"#columns"},null,-1)),Ke=[Be],Pe=b(()=>o("use",{href:"#details"},null,-1)),Ue=[Pe],Oe=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#query"})],-1)),Ve={key:1,class:"tree-data"},We={class:"data-title columns"},Fe={class:"tree-data"},Ge={class:"data-type"},Qe=b(()=>o("svg",{class:"icon-16 icon-color"},[o("use",{href:"#query"})],-1)),Xe={key:2,class:"detail-row"},Ye={key:0,class:"count-and-time"},Ze=b(()=>o("span",null,u("TTL"),-1)),je=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#refresh"})],-1)),Je={key:1},De={key:1},et=b(()=>o("svg",{class:"icon icon-color"},[o("use",{href:"#refresh"})],-1)),tt={class:"left"},st={key:0,class:"empty-sql"},lt={key:1,class:"right"},ot={key:0,class:"icon-16"},nt=b(()=>o("use",{href:"#tables"},null,-1)),at=[nt],ct=Q({__name:"table-manager",setup(f){const E=ce();we();const{tablesSearchKey:x,tablesTreeData:y,tablesTreeRef:I,isRefreshingDetails:L,refreshTables:M,loadMore:k,loadMoreColumns:N}=xe(),{tablesLoading:$,originTablesTree:C}=K(ie()),H=16,S=58,R=H*3+S,h=ae(),v=(c,n,r)=>{var i;n[r].length&&r!==n.childrenType&&((i=h.value)==null?void 0:i.includes(n.key))&&c.stopPropagation(),n.children=n[r],n.childrenType=r};G(()=>y.value.map(c=>({title:c.title,dataIndex:c.title})));const U={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},w={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]},O=(c,n)=>{c.stopPropagation(),n.columns.length||N(n)};return(c,n)=>{const r=d("a-button"),i=d("a-space"),T=d("a-input"),g=d("a-tooltip"),B=Ae,A=d("a-spin"),Y=d("a-doption"),Z=d("a-dropdown"),V=Le,re=d("a-typography-text"),_e=d("a-tree"),ue=oe,de=d("a-card");return l(),m(de,{class:"table-manager",bordered:!1},{title:t(()=>[s(i,{size:10},{default:t(()=>[P("Tables"),s(r,{type:"outline",size:"small",onClick:a(M)},{icon:t(()=>[Se]),_:1},8,["onClick"])]),_:1}),s(i,null,{default:t(()=>[s(T,{class:"search-table",modelValue:a(x),"onUpdate:modelValue":n[0]||(n[0]=e=>j(x)?x.value=e:null),"allow-clear":!0,placeholder:c.$t("dashboard.input")},{prefix:t(()=>[qe]),_:1},8,["modelValue","placeholder"])]),_:1})]),default:t(()=>[s(A,{style:{width:"100%"},loading:a($)},{default:t(()=>[a(y)&&a(y).length>0?(l(),m(_e,{key:0,class:"table-tree",ref_key:"tablesTreeRef",ref:I,"expanded-keys":a(h),"onUpdate:expandedKeys":n[3]||(n[3]=e=>j(h)?h.value=e:null),size:"small","action-on-node-click":"expand","block-node":!0,data:a(y),"load-more":a(k),animation:!1,"virtual-list-props":{height:`calc(100vh - ${R}px)`}},{icon:t(e=>[e.node.iconType?(l(),m(g,{key:0,content:e.node.iconType},{default:t(()=>[(l(),p("svg",ze,[o("use",{href:U[e.node.iconType]},null,8,Ne)]))]),_:2},1032,["content"])):q("",!0)]),title:t(e=>[e.isLeaf?e.dataType?(l(),p("div",Ve,[o("div",We,u(e.title),1),o("div",Fe,[s(ye,{name:"slide-fade"},{default:t(()=>[o("div",Ge,u(e.dataType),1)]),_:2},1024),e.dataType?(l(),m(Z,{key:0,class:"quick-select",trigger:"click",position:"right"},{content:t(()=>[(l(!0),p(W,null,F(w[e.iconType||"TABLE"],_=>J((l(),m(Y,null,{default:t(()=>[s(A,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(B,{type:_.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:_.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E).name==="query"]])),256))]),default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(r,{type:"text",size:"small"},{icon:t(()=>[Qe]),_:1})]),_:1},8,["content"])]),_:2},1024)):q("",!0),s(V,{class:"title-copy columns",type:"text",data:e.title,"show-data":!1,onClick:n[2]||(n[2]=ee(()=>{},["stop"]))},null,8,["data"])])])):(l(),p("div",Xe,[e.title==="rowAndTime"?(l(),p("div",Ye,[s(i,{size:4},{default:t(()=>[o("span",null,u(c.$t("dashboard.rowCount")),1),o("span",null,u(e.info.rowCount),1)]),_:2},1024),s(i,null,{default:t(()=>[s(i,{size:4},{default:t(()=>[Ze,o("span",null,u(e.info.ttl),1)]),_:2},1024),s(r,{class:"refresh-details row-middle",type:"text",size:"small",loading:a(L)[e.parentKey],onClick:_=>a(k)(a(C)[e.parentKey])},{icon:t(()=>[je]),_:2},1032,["loading","onClick"])]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,u(c.$t("dashboard.minTime")),1),e.info.min!=="-"?(l(),m(g,{key:0,content:`${e.info.min}`},{default:t(()=>[o("span",null,u(a(se)(e.info.timestampType,e.info.min)),1)]),_:2},1032,["content"])):(l(),p("span",Je,u(e.info.min),1))]),_:2},1024),s(i,{size:4},{default:t(()=>[o("span",null,u(c.$t("dashboard.maxTime")),1),e.info.max!=="-"?(l(),m(g,{key:0,content:`${e.info.max}`},{default:t(()=>[o("span",null,u(a(se)(e.info.timestampType,e.info.max)),1)]),_:2},1032,["content"])):(l(),p("span",De,u(e.info.max),1))]),_:2},1024),s(r,{class:"refresh-details row-end",type:"text",size:"small",loading:a(L)[e.parentKey],onClick:_=>a(k)(a(C)[e.parentKey])},{icon:t(()=>[et]),_:2},1032,["loading","onClick"])])):(l(),m(i,{key:1},{default:t(()=>[s(i,{align:"start",class:z({"create-table":e.info.sql!=="-"}),size:4},{default:t(()=>[o("div",tt,u(c.$t("dashboard.createTable")),1),e.info.sql==="-"?(l(),p("span",st,u(e.info.sql),1)):(l(),p("div",lt,[s(re,{class:"code-space"},{default:t(()=>[P(u(e.info.sql),1)]),_:2},1024),s(V,{class:"title-copy code",data:e.info.sql,showData:!1,copyTooltip:c.$t("dashboard.copyToClipboard")},null,8,["data","copyTooltip"])]))]),_:2},1032,["class"])]),_:2},1024))])):(l(),p("div",He,[s(g,{class:"data-type",mini:"",content:e.title},{default:t(()=>[o("div",Re,u(e.title),1)]),_:2},1032,["content"]),s(i,{size:6},{default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.columns")},{default:t(()=>[s(r,{type:"text",size:"small",onClick:_=>v(_,e,"columns")},{icon:t(()=>{var _;return[(l(),p("svg",{class:z(["icon-16",e.childrenType==="columns"&&((_=a(h))==null?void 0:_.includes(e.key))?"":"icon-color"])},Ke,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(g,{mini:"",content:c.$t("dashboard.details")},{default:t(()=>[s(r,{type:"text",size:"small",onClick:_=>v(_,e,"details")},{icon:t(()=>{var _;return[(l(),p("svg",{class:z(["icon-16",e.childrenType==="details"&&((_=a(h))==null?void 0:_.includes(e.key))?"":"icon-color"])},Ue,2))]}),_:2},1032,["onClick"])]),_:2},1032,["content"]),s(Z,{class:"quick-select",trigger:"click",position:"right",onClick:_=>O(_,e)},{content:t(()=>[(l(!0),p(W,null,F(w.TABLE,_=>J((l(),m(Y,null,{default:t(()=>[s(A,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(B,{type:_.value,node:e,parent:e.iconType?a(C)[e.parentKey]:e,label:_.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,a(E).name==="query"]])),256))]),default:t(()=>[s(g,{mini:"",content:c.$t("dashboard.quickSelect")},{default:t(()=>[s(r,{type:"text",size:"small"},{icon:t(()=>[Oe]),_:1})]),_:1},8,["content"])]),_:2},1032,["onClick"]),s(V,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:n[1]||(n[1]=ee(()=>{},["stop"]))},null,8,["data"])]),_:2},1024)]))]),"switcher-icon":t(e=>[e.isLeaf?q("",!0):(l(),p("svg",ot,at))]),_:1},8,["expanded-keys","data","load-more","virtual-list-props"])):(l(),m(ue,{key:1,class:"empty"}))]),_:1},8,["loading"])]),_:1})}}});const it=X(ct,[["__scopeId","data-v-bfdb7972"]]),rt=Q({__name:"index",setup(f){ne(c=>({"471e33b0":h,"103bf473":S}));const{s:E,q:x}=ve(),y=Te(),{queryType:I}=le(),{guideModalVisible:L}=K(Ce()),{getTables:M}=ie(),{dataStatusMap:k}=K(Ee()),{logs:N}=K(Ie()),{getResultsByType:$}=le(),S=`${258+16+636}px`,h=`${508+12}px`,v=ae();ge(()=>{v.value=document.getElementsByClassName("table-manager")[0]});const U=()=>{v.value=document.getElementsByClassName("table-manager")[0]},w=["sql","promql"];G(()=>$(w));const O=G(()=>N.value.filter(c=>w.includes(c.type)));return te(E,c=>{var n,r,i,T;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((r=y.value)==null?void 0:r.tagName)!=="TEXTAREA"&&!((T=(i=y.value)==null?void 0:i.classList)!=null&&T.contains("cm-content"))&&(I.value="sql")}),te(x,c=>{var n,r,i,T;((n=y.value)==null?void 0:n.tagName)!=="INPUT"&&((r=y.value)==null?void 0:r.tagName)!=="TEXTAREA"&&!((T=(i=y.value)==null?void 0:i.classList)!=null&&T.contains("cm-content"))&&(I.value="promql")}),be(()=>{L.value||k.value.tables||M()}),(c,n)=>{const r=it,i=d("a-layout-sider"),T=$e,g=d("a-layout-content"),B=d("a-layout");return l(),m(B,{class:"layout"},{default:t(()=>[s(i,{class:"tables-sider",style:{width:"66.6%"},"resize-directions":["right"],onMovingEnd:U},{default:t(()=>{var A;return[s(r,{class:z(((A=a(v))==null?void 0:A.offsetWidth)<=650?"small":"big")},null,8,["class"])]}),_:1}),s(g,{class:"logs-content"},{default:t(()=>[s(T,{logs:a(O),types:w},null,8,["logs"])]),_:1})]),_:1})}}});const bt=X(rt,[["__scopeId","data-v-38b0a37e"]]);export{bt as default};
