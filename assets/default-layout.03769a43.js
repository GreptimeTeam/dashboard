import{_ as De}from"./index.vue_vue_type_style_index_0_lang.61866801.js";import{s as pe,P as me,_ as Be}from"./promql.bc154655.js";import{d as W,e as B,c as O,w as Ie,aV as Ae,aH as s,C as l,aE as f,aG as e,aI as o,u as t,G as c,aL as V,aM as b,D as E,k as he,aK as N,aJ as Q,aW as Oe,aX as Pe,aY as Fe,aZ as He,a_ as le,a$ as ie,F as Ue,aF as se,E as be,b0 as ne,o as Ge,b1 as Ne,b as Qe,b2 as fe,b3 as We,b4 as Ke}from"./arco.a57ec162.js";import{o as ee,k as te,a as je,T as ve}from"./index.a33cbaa3.js";import{u as ae,a as Je,q as Xe,d as Ye,b as Ze,t as et,_ as K,c as I,e as tt,f as ot,g as nt,l as st,r as ye,h as at}from"./index.61bbd04d.js";import{g as ge,s as oe,h as lt}from"./vue.3c21c30b.js";import"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.47e8f7bf.js";import"./index.40496764.js";import"./chart.9b630f60.js";const it=n=>(le("data-v-86388588"),n=n(),ie(),n),ct={class:"mr-4"},rt={class:"mr-4"},ut={key:0},dt={key:1},_t={class:"query-select"},pt=it(()=>c("svg",{class:"icon"},[c("use",{href:"#question"})],-1)),mt={class:"ml-4"},ft={class:"ml-2"},vt=W({__name:"editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(n){ge();const{codes:a,queryType:i,cursorAt:v,queryOptions:g,promForm:r,isButtonDisabled:k,primaryCodeRunning:q,secondaryCodeRunning:L,sqlView:u,promqlView:h,selectCodeType:p}=ae(),y=B(),$=B(),w=B(),C=B(!1),S=B(!1),{runQuery:D}=ae(),{originTablesTree:P}=oe(Je()),F=d=>{u.value=d.view},H=d=>{h.value=d.view},A={height:"250px"},R=d=>{const _=d==="sql"?u.value:h.value;if(_){const{state:x}=_,{ranges:z}=x.selection;if(v.value=[z[0].from,z[0].to],y.value=x.doc.lineAt(z[0].from).number,$.value=x.doc.lineAt(z[0].to).number,x.doc.text)w.value=x.doc.text.slice(y.value-1,$.value).join(" ");else{let M=[];x.doc.children.forEach(G=>{M=M.concat(G.text)}),w.value=M.slice(y.value-1,$.value).join(" ")}}},T=async()=>{q.value=!0,await D(a.value[i.value].trim(),i.value),q.value=!1},J=O(()=>!w.value||w.value.trim().length===0?!0:k.value),U=async()=>{L.value=!0,await D(w.value.trim(),i.value),L.value=!1},ke=et.map(d=>({value:d,label:`Last ${d} minutes`})),X=[{key:"alt-Enter",run:()=>{T()}},{key:"ctrl-Enter",run:()=>{U()}}],Y=O(()=>{const d={},_=new Set;return P.value.forEach(x=>{const z=x.columns.map(M=>(_.add(M.title),M.title));d[x.title]=z,_.add(x.title)}),{sql:{schema:d},promql:_}}),Z={sql:[pe(Y.value.sql),ee,te.of(X),je({closeOnBlur:!1})],promql:[new me().asExtension(),ee,te.of(X)]};Ie(Y,()=>{Z.sql=[pe(Y.value.sql),ee,te.of(X)];const d=new me().setComplete({remote:{fetchFn:()=>Promise.reject(),cache:{initialMetricList:[...Y.value.promql]}}});Z.promql=[d.asExtension(),ee,te.of(X)]});const we=()=>{S.value=r.value.isRelative!==1,C.value=!0},qe=()=>{S.value=!S.value},$e=d=>{r.value.range=d,r.value.time=-1,r.value.isRelative=0,S.value=!1,C.value=!1},xe=d=>{r.value.time=d,r.value.isRelative=1,S.value=!1,C.value=!1};return Ae(()=>{p()}),(d,_)=>{const x=s("icon-loading"),z=s("icon-play-arrow"),M=s("a-button"),G=s("a-space"),Ce=s("a-option"),Se=s("a-select"),Te=Be,re=s("a-form-item"),ue=s("a-typography-text"),de=s("a-list-item"),Re=s("a-list"),Ve=s("a-popover"),Ee=s("a-input"),Le=s("a-form"),_e=s("a-tab-pane"),ze=s("a-tabs"),Me=s("a-card");return l(),f(Me,{class:"editor-card",bordered:!1},{default:e(()=>[o(G,{class:"space-between pb-16"},{default:e(()=>[o(G,{size:"medium"},{default:e(()=>[o(M,{type:"primary",disabled:t(k),onClick:_[0]||(_[0]=m=>T())},{default:e(()=>[c("div",ct,[t(q)?(l(),f(x,{key:0,spin:""})):(l(),f(z,{key:1}))]),V(b(d.$t("dashboard.runAll")),1)]),_:1},8,["disabled"]),o(M,{disabled:t(J),onClick:_[1]||(_[1]=m=>U())},{default:e(()=>[c("div",rt,[t(L)?(l(),f(x,{key:0,spin:""})):(l(),f(z,{key:1}))]),t(y)===t($)?(l(),E("div",ut,b(d.$t("dashboard.runLine"))+" "+b(t(y)),1)):(l(),E("div",dt,b(d.$t("dashboard.runLines"))+" "+b(t(y))+" - "+b(t($)),1))]),_:1},8,["disabled"])]),_:1}),c("div",_t,[o(Se,{modelValue:t(i),"onUpdate:modelValue":_[2]||(_[2]=m=>he(i)?i.value=m:null),"trigger-props":{"content-class":"query-select"},onChange:t(p)},{default:e(()=>[(l(!0),E(N,null,Q(t(g),m=>(l(),f(Ce,Oe(Pe(m)),null,16))),256))]),_:1},8,["modelValue","onChange"])])]),_:1}),Fe(o(Le,{class:"space-between prom-form mb-16",layout:"inline",model:t(r)},{default:e(()=>[o(G,{size:"medium"},{default:e(()=>[o(re,{"hide-label":!0},{default:e(()=>[o(Te,{"flex-direction":"row-reverse","button-class":"query-time-button","trigger-visible":t(C),"is-relative":t(r).isRelative===1,"range-picker-visible":t(S),"time-length":t(r).time,"time-range":t(r).range,"relative-time-map":t(Xe),"relative-time-options":t(ke),onOpenTimeSelect:we,onSelectTimeRange:$e,onSelectTimeLength:xe,onClickCustom:qe},null,8,["trigger-visible","is-relative","range-picker-visible","time-length","time-range","relative-time-map","relative-time-options"])]),_:1}),o(re,{"hide-label":!0},{default:e(()=>[o(Ee,{modelValue:t(r).step,"onUpdate:modelValue":_[3]||(_[3]=m=>t(r).step=m),"hide-button":"",style:{width:"180px"},placeholder:d.$t("dashboard.step")},{prefix:e(()=>[V("Step")]),suffix:e(()=>[o(Ve,{trigger:"hover"},{content:e(()=>[o(Re,{size:"small",split:!1,bordered:!1},{header:e(()=>[V(b(d.$t("dashboard.supportedDurations")),1)]),default:e(()=>[(l(!0),E(N,null,Q(t(Ye),m=>(l(),f(de,{key:m},{default:e(()=>[o(ue,{code:""},{default:e(()=>[V(b(m.key),1)]),_:2},1024),c("span",mt,b(m.value),1)]),_:2},1024))),128)),o(de,null,{default:e(()=>[c("span",ft,b(d.$t("dashboard.examples")),1),(l(!0),E(N,null,Q(t(Ze),m=>(l(),f(ue,{key:m,code:""},{default:e(()=>[V(b(m),1)]),_:2},1024))),128))]),_:1})]),_:1})]),default:e(()=>[pt]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["model"]),[[He,t(i)==="promql"]]),o(ze,{class:"query-tabs","default-active-key":"sql","active-key":t(i)},{default:e(()=>[o(_e,{key:"sql"},{default:e(()=>[o(t(ve),{modelValue:t(a).sql,"onUpdate:modelValue":_[4]||(_[4]=m=>t(a).sql=m),style:A,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:Z.sql,onReady:F,onUpdate:_[5]||(_[5]=m=>R("sql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1}),o(_e,{key:"promql"},{default:e(()=>[o(t(ve),{modelValue:t(a).promql,"onUpdate:modelValue":_[6]||(_[6]=m=>t(a).promql=m),style:A,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:Z.promql,onReady:H,onUpdate:_[7]||(_[7]=m=>R("promql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1})]),_:1},8,["active-key"])]),_:1})}}});const yt=K(vt,[["__scopeId","data-v-86388588"]]),ce=n=>(le("data-v-a6a1d330"),n=n(),ie(),n),ht=ce(()=>c("svg",{class:"icon-18"},[c("use",{href:"#clear"})],-1)),bt={key:0,class:"icon-18"},gt=ce(()=>c("use",{href:"#zoom-out"},null,-1)),kt=[gt],wt={key:1,class:"icon-18"},qt=ce(()=>c("use",{href:"#zoom"},null,-1)),$t=[qt],xt=W({__name:"index",setup(n){const{queryModalVisible:a}=oe(I());I();const{getResultsByType:i,sqlView:v,promqlView:g,queryType:r,clearCode:k}=ae(),q=58,L=16,u=258,h=B(!1);B(!1);const p=["sql","promql"],y=O(()=>i(p)),$=()=>{r.value==="sql"?v.value.focus():g.value.focus()};return(w,C)=>{const S=s("a-button"),D=s("a-space"),P=yt,F=De,H=s("a-scrollbar"),A=s("a-modal");return l(),f(A,{class:be(["query-modal",{"full-screen":t(h)}]),visible:t(a),"onUpdate:visible":C[1]||(C[1]=R=>he(a)?a.value=R:null),"ok-text":w.$t("guide.confirm"),"hide-cancel":!0,width:t(h)?`calc(100vw - ${u}px - 32px)`:636,mask:!1,"align-center":!1,"mask-style":{"pointer-events":"none"},footer:!1,draggable:!0,onOpen:$},{title:e(()=>[V(b(w.$t("menu.dashboard.query")),1),o(D,{fill:"",size:4},{default:e(()=>[o(S,{class:"screen-button",type:"text",size:"small",onClick:t(k)},{icon:e(()=>[ht]),_:1},8,["onClick"]),o(S,{class:"screen-button",type:"text",size:"small",onClick:C[0]||(C[0]=R=>h.value=!t(h))},{icon:e(()=>[t(h)?(l(),E("svg",bt,kt)):(l(),E("svg",wt,$t))]),_:1})]),_:1})]),default:e(()=>[o(D,{class:"editor-space",align:"start",fill:"",size:0},{default:e(()=>[o(H,{style:Ue({height:`calc(100vh - ${L*2+q}px)`,overflow:"auto"})},{default:e(()=>{var R;return[o(P),(R=t(y))!=null&&R.length?(l(),f(F,{key:0,class:"modal-view",results:t(y),types:p},null,8,["results"])):se("",!0)]}),_:1},8,["style"])]),_:1})]),_:1},8,["visible","class","ok-text","width"])}}});const Ct=K(xt,[["__scopeId","data-v-a6a1d330"]]),St="/assets/logo-text.e99088e0.png",Tt=[...tt,...ot],Rt=Tt.map(n=>{const{name:a,path:i,meta:v,redirect:g,children:r}=n;return{name:a,path:i,meta:v,redirect:g,children:r}});function Vt(){const n=nt(),a=I(),i=O(()=>a.menuFromServer?a.appAsyncMenus:Rt);return{menuTree:O(()=>{const g=JSON.parse(JSON.stringify(i.value));g.sort((k,q)=>(k.meta.order||0)-(q.meta.order||0));function r(k,q){return k?k.map(u=>{var p,y;if(!n.accessRouter(u))return null;if(((p=u.meta)==null?void 0:p.hideChildrenInMenu)||!u.children)return u.children=[],u;u.children=u.children.filter($=>{var w;return((w=$.meta)==null?void 0:w.hideInMenu)!==!0});const h=r(u.children,q+1);return h.length||q>1?(u.children=h,u):((y=u.meta)==null?void 0:y.hideInMenu)===!1?u:null}).filter(Boolean):null}return r(g,0)})}}const j=n=>(le("data-v-04169665"),n=n(),ie(),n),Et=j(()=>c("div",{class:"logo-space"},[c("img",{class:"logo-text-img",alt:"logo",src:St})],-1)),Lt={class:"new-query"},zt=j(()=>c("span",null,"+",-1)),Mt=j(()=>c("span",null,"New Query",-1)),Dt={class:"menu"},Bt={class:"icon-18"},It=["href"],At={class:"footer"},Ot=j(()=>c("svg",{class:"icon-20"},[c("use",{href:"#settings"})],-1)),Pt=j(()=>c("svg",{class:"icon-18"},[c("use",{href:"#menu"})],-1)),Ft=W({__name:"index",setup(n){const{updateSettings:a}=I(),{menuSelectedKey:i,globalSettings:v}=oe(I()),{menuTree:g}=Vt(),r=g.value[0].children,k=[{link:"https://greptime.com/",label:"Home"},{link:"https://docs.greptime.com/",label:"Docs"},{link:"https://github.com/GreptimeTeam/dashboard",label:"GitHub | Dashboard"},{link:"https://github.com/GreptimeTeam/greptimedb",label:"GitHub | GreptimeDB"}],q=()=>{a({globalSettings:!0})},L=p=>{ye.push({name:p})},u=p=>{const y=ye.resolve({name:p});window.open(y.fullPath,"_blank")};st(p=>{i.value=p.name},!0);const h=()=>{a({queryModalVisible:!0})};return(p,y)=>{const $=s("a-layout-header"),w=s("a-button"),C=s("a-menu-item"),S=s("a-menu"),D=s("a-layout-content"),P=s("a-link"),F=s("a-doption"),H=s("a-dropdown"),A=s("a-layout-footer"),R=s("a-layout");return l(),f(R,{class:"navbar"},{default:e(()=>[o($,null,{default:e(()=>[Et]),_:1}),o(D,null,{default:e(()=>[c("div",Lt,[o(w,{type:"primary",onClick:h},{default:e(()=>[zt,Mt]),_:1})]),c("div",Dt,[o(S,{mode:"vertical","selected-keys":[t(i)]},{default:e(()=>[(l(!0),E(N,null,Q(t(r),(T,J)=>(l(),f(C,{key:T.name,onClick:[ne(U=>u(T.name),["meta"]),ne(U=>u(T.name),["ctrl"]),ne(U=>L(T.name),["exact"])]},{icon:e(()=>[(l(),E("svg",Bt,[c("use",{href:`#${T.meta.icon}`},null,8,It)]))]),default:e(()=>[c("span",null,b(p.$t(T.meta.locale)),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["selected-keys"])])]),_:1}),o(A,null,{default:e(()=>[c("ul",At,[c("li",null,[o(w,{style:{width:"100%"},class:be({hover:t(v)}),onClick:q},{icon:e(()=>[Ot]),default:e(()=>[V(b(p.$t("settings.title")),1)]),_:1},8,["class"])]),c("li",null,[o(H,{class:"menu-dropdown",trigger:"hover",position:"right","popup-max-height":!1},{content:e(()=>[(l(),E(N,null,Q(k,({label:T,link:J})=>o(F,null,{default:e(()=>[o(P,{target:"_blank",href:J},{default:e(()=>[V(b(T),1)]),_:2},1032,["href"])]),_:2},1024)),64))]),default:e(()=>[o(w,{style:{width:"100%"}},{icon:e(()=>[Pt]),default:e(()=>[V(b(p.$t("navbar.docs")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})}}});const Ht=K(Ft,[["__scopeId","data-v-04169665"]]);const Ut={};function Gt(n,a){const i=s("a-layout-footer");return l(),f(i,{class:"footer"},{default:e(()=>[V("\xA9Copyright 2022 Greptime Inc. All Rights Reserved")]),_:1})}const Nt=K(Ut,[["render",Gt],["__scopeId","data-v-d90f7d0d"]]);function Qt(n,a,i,v=!1){n.addEventListener&&typeof n.addEventListener=="function"&&n.addEventListener(a,i,v)}function Wt(n,a,i,v=!1){n.removeEventListener&&typeof n.removeEventListener=="function"&&n.removeEventListener(a,i,v)}const Kt=992;function jt(){return document.body.getBoundingClientRect().width-1<Kt}function Jt(n){const a=I();function i(){if(!document.hidden){const g=jt();a.toggleDevice(g?"mobile":"desktop"),a.toggleMenu(g)}}const v=lt(i,100);Ge(()=>{n&&v()}),Ne(()=>{Qt(window,"resize",v)}),Qe(()=>{Wt(window,"resize",v)})}const Xt=W({__name:"page-layout",setup(n){const a=ge(),i=at();return O(()=>i.getCacheList),(v,g)=>{const r=s("router-view");return l(),f(r,null,{default:e(({Component:k})=>[o(Ke,{name:"fade",mode:"out-in",appear:""},{default:e(()=>[t(a).meta.ignoreCache?(l(),f(fe(k),{key:t(a).fullPath})):(l(),f(We,{key:1},[(l(),f(fe(k),{key:t(a).name}))],1024))]),_:2},1024)]),_:1})}}}),Yt=W({__name:"default-layout",setup(n){Jt(!0);const{navbar:a,footer:i,username:v,password:g,database:r,codeType:k}=oe(I());return(q,L)=>{const u=Ht,h=s("a-layout-sider"),p=s("a-layout-content"),y=Ct,$=s("a-layout");return l(),f($,{class:"layout-container"},{default:e(()=>[o(h,{class:"main-sider",width:258},{default:e(()=>[t(a)?(l(),f(u,{key:0})):se("",!0)]),_:1}),o(p,{class:"layout-content"},{default:e(()=>[o(Xt)]),_:1}),t(i)?(l(),f(Nt,{key:0})):se("",!0),o(y)]),_:1})}}});const co=K(Yt,[["__scopeId","data-v-6090adc4"]]);export{co as default};
