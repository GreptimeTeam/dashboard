import{_ as ye,d as me,e as ve}from"./index.c1eed07c.js";import{u as ie,s as Z,j as ge}from"./vue.17a00e68.js";import{f as ue,u as _e,g as fe,i as Ce,h as k,b as xe,_ as Le}from"./index.f7809db0.js";import{d as U,aH as i,C as y,aE as A,aG as l,aL as H,aM as V,aF as se,aI as _,D,aK as G,aJ as ee,r as d,w as Se,u as C,c as O,aS as we,j as P,G as v,aX as Fe,b3 as Te,o as Ae,a_ as $e,E as Ie}from"./arco.1967c6d6.js";const Ze=U({__name:"logs",props:{logs:null,types:null},setup(p){const o=p;ie();const{clearLogs:n}=ue();Z(_e()),ge();const a=()=>{n(o.types)};return(e,t)=>{const s=i("a-button"),c=ye,r=i("a-list"),m=i("a-card"),f=i("a-tab-pane"),h=i("a-tabs");return y(),A(h,{class:"result-tabs logs-tab",type:"rounded"},{extra:l(()=>[p.logs.length?(y(),A(s,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",onClick:a},{default:l(()=>[H(V(e.$t("dashboard.clear")),1)]),_:1})):se("",!0)]),default:l(()=>[_(f,{title:"Logs"},{default:l(()=>[_(m,{bordered:!1},{default:l(()=>[p.logs.length?(y(),A(r,{key:0,class:"log-list",size:"small",hoverable:!0,bordered:!1,split:!1},{default:l(()=>[(y(!0),D(G,null,ee(p.logs,g=>(y(),A(c,{key:g,log:g},null,8,["log"]))),128))]),_:1})):se("",!0)]),_:1})]),_:1})]),_:1})}}}),ke=U({__name:"index",props:{results:null,types:null},setup(p){var m,f;const o=p,{removeResult:n,clear:a}=fe(),e=d((m=o.results[0])==null?void 0:m.key),t=d((f=o.results[0])==null?void 0:f.key),s=async h=>{var $;const g=o.results.findIndex(L=>L.key===h&&o.types.includes(L.type));o.results.length===1&&(t.value=o.results[0].key),await n(h,o.results[g].type),e.value===h&&(e.value=(($=o.results[g])==null?void 0:$.key)||o.results.slice(-1)[0].key)},c=h=>{e.value=h},r=()=>{t.value=o.results[0].key,a(o.types)};return Se(()=>({...o}),(h,g)=>{h.results.length>g.results.length&&(e.value=o.results.slice(-1)[0].key)}),(h,g)=>{const $=i("a-button"),L=me,x=ve,S=i("a-space"),E=i("a-tab-pane"),I=i("a-tabs");return y(),A(I,{class:"result-tabs",type:"rounded","lazy-load":"",editable:"","active-key":C(e),animation:!0,onTabClick:c,onDelete:s},{extra:l(()=>[_($,{status:"danger",onClick:r},{default:l(()=>[H(V(h.$t("dashboard.clear")),1)]),_:1})]),default:l(()=>[(y(!0),D(G,null,ee(p.results,(w,N)=>(y(),A(E,{key:w.key,closable:"",title:`${h.$t("dashboard.result")} ${w.key-C(t)+1}`},{default:l(()=>[_(S,{direction:"vertical",size:"small",fill:""},{default:l(()=>[_(L,{data:w},null,8,["data"]),_(x,{data:w},null,8,["data"])]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active-key"])}}});class u{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(o,n=!1){return this.onePassHasher.start().appendStr(o).end(n)}static hashAsciiStr(o,n=!1){return this.onePassHasher.start().appendAsciiStr(o).end(n)}static _hex(o){const n=u.hexChars,a=u.hexOut;let e,t,s,c;for(c=0;c<4;c+=1)for(t=c*8,e=o[c],s=0;s<8;s+=2)a[t+1+s]=n.charAt(e&15),e>>>=4,a[t+0+s]=n.charAt(e&15),e>>>=4;return a.join("")}static _md5cycle(o,n){let a=o[0],e=o[1],t=o[2],s=o[3];a+=(e&t|~e&s)+n[0]-680876936|0,a=(a<<7|a>>>25)+e|0,s+=(a&e|~a&t)+n[1]-389564586|0,s=(s<<12|s>>>20)+a|0,t+=(s&a|~s&e)+n[2]+606105819|0,t=(t<<17|t>>>15)+s|0,e+=(t&s|~t&a)+n[3]-1044525330|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&s)+n[4]-176418897|0,a=(a<<7|a>>>25)+e|0,s+=(a&e|~a&t)+n[5]+1200080426|0,s=(s<<12|s>>>20)+a|0,t+=(s&a|~s&e)+n[6]-1473231341|0,t=(t<<17|t>>>15)+s|0,e+=(t&s|~t&a)+n[7]-45705983|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&s)+n[8]+1770035416|0,a=(a<<7|a>>>25)+e|0,s+=(a&e|~a&t)+n[9]-1958414417|0,s=(s<<12|s>>>20)+a|0,t+=(s&a|~s&e)+n[10]-42063|0,t=(t<<17|t>>>15)+s|0,e+=(t&s|~t&a)+n[11]-1990404162|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&s)+n[12]+1804603682|0,a=(a<<7|a>>>25)+e|0,s+=(a&e|~a&t)+n[13]-40341101|0,s=(s<<12|s>>>20)+a|0,t+=(s&a|~s&e)+n[14]-1502002290|0,t=(t<<17|t>>>15)+s|0,e+=(t&s|~t&a)+n[15]+1236535329|0,e=(e<<22|e>>>10)+t|0,a+=(e&s|t&~s)+n[1]-165796510|0,a=(a<<5|a>>>27)+e|0,s+=(a&t|e&~t)+n[6]-1069501632|0,s=(s<<9|s>>>23)+a|0,t+=(s&e|a&~e)+n[11]+643717713|0,t=(t<<14|t>>>18)+s|0,e+=(t&a|s&~a)+n[0]-373897302|0,e=(e<<20|e>>>12)+t|0,a+=(e&s|t&~s)+n[5]-701558691|0,a=(a<<5|a>>>27)+e|0,s+=(a&t|e&~t)+n[10]+38016083|0,s=(s<<9|s>>>23)+a|0,t+=(s&e|a&~e)+n[15]-660478335|0,t=(t<<14|t>>>18)+s|0,e+=(t&a|s&~a)+n[4]-405537848|0,e=(e<<20|e>>>12)+t|0,a+=(e&s|t&~s)+n[9]+568446438|0,a=(a<<5|a>>>27)+e|0,s+=(a&t|e&~t)+n[14]-1019803690|0,s=(s<<9|s>>>23)+a|0,t+=(s&e|a&~e)+n[3]-187363961|0,t=(t<<14|t>>>18)+s|0,e+=(t&a|s&~a)+n[8]+1163531501|0,e=(e<<20|e>>>12)+t|0,a+=(e&s|t&~s)+n[13]-1444681467|0,a=(a<<5|a>>>27)+e|0,s+=(a&t|e&~t)+n[2]-51403784|0,s=(s<<9|s>>>23)+a|0,t+=(s&e|a&~e)+n[7]+1735328473|0,t=(t<<14|t>>>18)+s|0,e+=(t&a|s&~a)+n[12]-1926607734|0,e=(e<<20|e>>>12)+t|0,a+=(e^t^s)+n[5]-378558|0,a=(a<<4|a>>>28)+e|0,s+=(a^e^t)+n[8]-2022574463|0,s=(s<<11|s>>>21)+a|0,t+=(s^a^e)+n[11]+1839030562|0,t=(t<<16|t>>>16)+s|0,e+=(t^s^a)+n[14]-35309556|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^s)+n[1]-1530992060|0,a=(a<<4|a>>>28)+e|0,s+=(a^e^t)+n[4]+1272893353|0,s=(s<<11|s>>>21)+a|0,t+=(s^a^e)+n[7]-155497632|0,t=(t<<16|t>>>16)+s|0,e+=(t^s^a)+n[10]-1094730640|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^s)+n[13]+681279174|0,a=(a<<4|a>>>28)+e|0,s+=(a^e^t)+n[0]-358537222|0,s=(s<<11|s>>>21)+a|0,t+=(s^a^e)+n[3]-722521979|0,t=(t<<16|t>>>16)+s|0,e+=(t^s^a)+n[6]+76029189|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^s)+n[9]-640364487|0,a=(a<<4|a>>>28)+e|0,s+=(a^e^t)+n[12]-421815835|0,s=(s<<11|s>>>21)+a|0,t+=(s^a^e)+n[15]+530742520|0,t=(t<<16|t>>>16)+s|0,e+=(t^s^a)+n[2]-995338651|0,e=(e<<23|e>>>9)+t|0,a+=(t^(e|~s))+n[0]-198630844|0,a=(a<<6|a>>>26)+e|0,s+=(e^(a|~t))+n[7]+1126891415|0,s=(s<<10|s>>>22)+a|0,t+=(a^(s|~e))+n[14]-1416354905|0,t=(t<<15|t>>>17)+s|0,e+=(s^(t|~a))+n[5]-57434055|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~s))+n[12]+1700485571|0,a=(a<<6|a>>>26)+e|0,s+=(e^(a|~t))+n[3]-1894986606|0,s=(s<<10|s>>>22)+a|0,t+=(a^(s|~e))+n[10]-1051523|0,t=(t<<15|t>>>17)+s|0,e+=(s^(t|~a))+n[1]-2054922799|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~s))+n[8]+1873313359|0,a=(a<<6|a>>>26)+e|0,s+=(e^(a|~t))+n[15]-30611744|0,s=(s<<10|s>>>22)+a|0,t+=(a^(s|~e))+n[6]-1560198380|0,t=(t<<15|t>>>17)+s|0,e+=(s^(t|~a))+n[13]+1309151649|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~s))+n[4]-145523070|0,a=(a<<6|a>>>26)+e|0,s+=(e^(a|~t))+n[11]-1120210379|0,s=(s<<10|s>>>22)+a|0,t+=(a^(s|~e))+n[2]+718787259|0,t=(t<<15|t>>>17)+s|0,e+=(s^(t|~a))+n[9]-343485551|0,e=(e<<21|e>>>11)+t|0,o[0]=a+o[0]|0,o[1]=e+o[1]|0,o[2]=t+o[2]|0,o[3]=s+o[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(u.stateIdentity),this}appendStr(o){const n=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,s;for(s=0;s<o.length;s+=1){if(t=o.charCodeAt(s),t<128)n[e++]=t;else if(t<2048)n[e++]=(t>>>6)+192,n[e++]=t&63|128;else if(t<55296||t>56319)n[e++]=(t>>>12)+224,n[e++]=t>>>6&63|128,n[e++]=t&63|128;else{if(t=(t-55296)*1024+(o.charCodeAt(++s)-56320)+65536,t>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");n[e++]=(t>>>18)+240,n[e++]=t>>>12&63|128,n[e++]=t>>>6&63|128,n[e++]=t&63|128}e>=64&&(this._dataLength+=64,u._md5cycle(this._state,a),e-=64,a[0]=a[16])}return this._bufferLength=e,this}appendAsciiStr(o){const n=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,s=0;for(;;){for(t=Math.min(o.length-s,64-e);t--;)n[e++]=o.charCodeAt(s++);if(e<64)break;this._dataLength+=64,u._md5cycle(this._state,a),e=0}return this._bufferLength=e,this}appendByteArray(o){const n=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,s=0;for(;;){for(t=Math.min(o.length-s,64-e);t--;)n[e++]=o[s++];if(e<64)break;this._dataLength+=64,u._md5cycle(this._state,a),e=0}return this._bufferLength=e,this}getState(){const o=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[o[0],o[1],o[2],o[3]]}}setState(o){const n=o.buffer,a=o.state,e=this._state;let t;for(this._dataLength=o.length,this._bufferLength=o.buflen,e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)}end(o=!1){const n=this._bufferLength,a=this._buffer8,e=this._buffer32,t=(n>>2)+1;this._dataLength+=n;const s=this._dataLength*8;if(a[n]=128,a[n+1]=a[n+2]=a[n+3]=0,e.set(u.buffer32Identity.subarray(t),t),n>55&&(u._md5cycle(this._state,e),e.set(u.buffer32Identity)),s<=4294967295)e[14]=s;else{const c=s.toString(16).match(/(.*?)(.{0,8})$/);if(c===null)return;const r=parseInt(c[2],16),m=parseInt(c[1],16)||0;e[14]=r,e[15]=m}return u._md5cycle(this._state,e),o?this._state:u._hex(this._state)}}u.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);u.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);u.hexChars="0123456789abcdef";u.hexOut=[];u.onePassHasher=new u;if(u.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const{saveScript:Ne}=fe(),T=d(""),R=d(""),J=d([]),Q=d([]),X=d([]),z=d(""),j=d(!0),ae=d(!1),Y=d(!1),ne=d(!1),oe=d(!1),re=O(()=>u.hashStr(T.value)!==u.hashStr(R.value));function de(){const{pushLog:p}=ue(),o=r=>{T.value=T.value.substring(0,X.value[0])+r+T.value.substring(X.value[1])},n=r=>{z.value=r.key,j.value=!1,T.value=r.code,Q.value=[r.key],R.value=T.value},a=()=>{z.value="",j.value=!0,T.value="",J.value=[],Q.value=[],R.value="",Y.value=!1},e=()=>{Y.value=!0,re.value?ae.value=!0:a()},t=r=>{J.value=[r],j.value=!1,R.value=T.value},s=async(r,m)=>{try{const f=await Ne(r,m);we.success({content:Ce.global.t("dashboard.saveSuccess"),duration:2*1e3}),p(f,"python")}catch(f){throw p(JSON.parse(f.message),"python")}},c=O(()=>oe.value===!0||ne.value===!0||z.value.trim().length===0||T.value.trim().length===0);return{insertNameToPyCode:o,overwriteCode:n,createNewScript:e,selectAfterSave:t,pythonCode:T,lastSavedCode:R,cursorAt:X,scriptName:z,isNewScript:j,scriptSelectedKeys:J,lastSelectedKey:Q,isChanged:re,modelVisible:ae,creating:Y,isButtonDisabled:c,scriptSaving:ne,scriptRunning:oe,save:s}}const M=d(""),W=d(""),{originTablesTree:le,originScriptsList:ce}=Z(k());function he(){const p=e=>{const t=[];return le.value.forEach(s=>{if(s.title.toLowerCase().indexOf(e.toLowerCase())>-1)t.push({...s});else if(s.children){const c=[];s.children.forEach(r=>{r.title.toLowerCase().indexOf(e.toLowerCase())>-1&&c.push({...r})}),c.length&&t.push({...s,children:c})}}),t},o=e=>(s=>{const c=[];return s.forEach(r=>{r.title.toLowerCase().indexOf(e.toLowerCase())>-1&&c.push({...r})}),c})(ce.value),n=O(()=>M.value?p(M.value):le.value),a=O(()=>W.value?o(W.value):ce.value);return{tablesSearchKey:M,scriptsSearchKey:W,tablesTreeData:n,scriptsListData:a}}const Be=v("svg",{class:"icon"},[v("use",{href:"#search"})],-1),Ee=v("svg",{class:"icon"},[v("use",{href:"#refresh"})],-1),Ke=[Ee],De={class:"icon-16"},Re=["href"],Pe={class:"tree-data"},Ve={class:"data-type"},Oe=["onClick"],Ue=v("use",{href:"#copy"},null,-1),ze=[Ue],je=U({__name:"table-list",setup(p){const o=ie(),{insertNameToQueryCode:n}=xe(),{insertNameToPyCode:a}=de(),{tablesSearchKey:e,tablesTreeData:t}=he(),{getTableByName:s,getTables:c,addChildren:r}=k(),m=d(),f=()=>{e.value="",c(),m.value.expandAll(!1)},h=x=>new Promise((S,E)=>{s(x.title).then(I=>{const{output:w}=I,{records:{rows:N}}=w[0],b=[];N.forEach(B=>{b.push({title:B[0],key:`${x.title}.${B[0]}`,isLeaf:!0,dataType:B[1],iconType:B[4]})}),r(x.key,b),S()}).catch(()=>{E()})}),g={query:n,scripts:a},$=x=>{const S=o.name;return g[S](x)},L={FIELD:"#value","PRIMARY KEY":"#primary-key","TIME INDEX":"#time-index"};return(x,S)=>{const E=i("a-input"),I=i("a-space"),w=i("IconDown"),N=i("a-typography-text"),b=i("a-tooltip"),B=i("a-tree"),q=i("a-scrollbar");return y(),A(I,{direction:"vertical",size:"medium",fill:""},{default:l(()=>[_(I,{class:"search-space"},{default:l(()=>[_(E,{modelValue:C(e),"onUpdate:modelValue":S[0]||(S[0]=F=>P(e)?e.value=F:null),"allow-clear":!0},{prefix:l(()=>[Be]),_:1},8,["modelValue"]),v("div",{class:"icon-space pointer",onClick:f},Ke)]),_:1}),_(q,{class:"tree-scrollbar"},{default:l(()=>[_(B,{class:"table-tree",ref_key:"treeRef",ref:m,size:"small",data:C(t),"load-more":h,animation:!1},{title:l(()=>[]),"switcher-icon":l(()=>[_(w)]),extra:l(F=>[Fe((y(),D("svg",De,[v("use",{href:L[F.iconType]},null,8,Re)],512)),[[Te,F.iconType]]),v("div",Pe,[_(N,{class:"data-title",ellipsis:{rows:1,showTooltip:!0}},{default:l(()=>[H(V(F.title),1)]),_:2},1024),v("div",Ve,V(F.dataType),1)]),_(b,{mini:"",content:x.$t("dashboard.insertName")},{default:l(()=>[(y(),D("svg",{class:"icon-15 copy-icon pointer",name:"copy",onClick:te=>$(F.title)},ze,8,Oe))]),_:2},1032,["content"])]),_:1},8,["data"])]),_:1})]),_:1})}}}),He=v("svg",{class:"icon"},[v("use",{href:"#search"})],-1),Ge=v("svg",{class:"icon"},[v("use",{href:"#create"})],-1),qe=[Ge],Je=U({__name:"scripts-list",setup(p){const o=d(),n=d();d("");const a={type:"text"},e={type:"primary"},{pythonCode:t,creating:s,lastSavedCode:c,scriptSelectedKeys:r,lastSelectedKey:m,modelVisible:f,isChanged:h,overwriteCode:g,createNewScript:$}=de(),{scriptsSearchKey:L,scriptsListData:x}=he(),{getScriptsTable:S}=k();Z(_e());const E=(N,b)=>{o.value=b.node,h.value?f.value=!0:g(b.node)},I=()=>{s.value?(t.value="",c.value="",$()):g(o.value)},w=()=>{r.value=m.value};return Ae(()=>{S()}),(N,b)=>{const B=i("a-input"),q=i("a-tooltip"),F=i("a-space"),te=i("a-tree"),pe=i("a-scrollbar"),be=i("a-modal");return y(),D(G,null,[_(F,{direction:"vertical",size:"medium"},{default:l(()=>[_(F,{class:"search-space"},{default:l(()=>[_(B,{modelValue:C(L),"onUpdate:modelValue":b[0]||(b[0]=K=>P(L)?L.value=K:null),"allow-clear":!0},{prefix:l(()=>[He]),_:1},8,["modelValue"]),_(q,{mini:"",content:N.$t("dashboard.create")},{default:l(()=>[v("div",{class:"icon-space pointer",onClick:b[1]||(b[1]=K=>C($)())},qe)]),_:1},8,["content"])]),_:1}),_(pe,{class:"tree-scrollbar"},{default:l(()=>[_(te,{class:"script-tree",ref_key:"scriptsRef",ref:n,"selected-keys":C(r),"onUpdate:selectedKeys":b[2]||(b[2]=K=>P(r)?r.value=K:null),size:"small",blockNode:"",data:C(x),onSelect:E},null,8,["selected-keys","data"])]),_:1})]),_:1}),_(be,{class:"change-modal",visible:C(f),"onUpdate:visible":b[3]||(b[3]=K=>P(f)?f.value=K:null),closable:!1,okButtonProps:a,cancelButtonProps:e,onOk:I,onCancel:w},{title:l(()=>[]),default:l(()=>[H(V(N.$t("dashboard.question")),1)]),_:1},8,["visible"])],64)}}}),Qe=U({__name:"list-tabs",props:{has:null},setup(p){const o=p,n=d(o.has.length-1),a=[{title:"Tables",component:je},{title:"Scripts",component:Je}],e=O(()=>a.filter(t=>o.has.includes(t.title)));return(t,s)=>{const c=i("a-card"),r=i("a-tab-pane"),m=i("a-tabs");return y(),A(m,{class:Ie(["sider-tabs",{"one-tab":C(e).length===1}]),"active-key":C(n),"onUpdate:activeKey":s[0]||(s[0]=f=>P(n)?n.value=f:null),type:"rounded"},{default:l(()=>[(y(!0),D(G,null,ee(C(e),(f,h)=>(y(),A(r,{key:h,title:f.title},{default:l(()=>[_(c,{class:"tree-card",bordered:!1},{default:l(()=>[(y(),A($e(f.component)))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active-key","class"])}}});const et=Le(Qe,[["__scopeId","data-v-e9caefd7"]]);export{et as _,ke as a,Ze as b,de as u};
