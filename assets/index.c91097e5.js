import{_ as le}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import{_ as pe}from"./log.c87ff46c.js";import{d as Q,b7 as ne,aI as r,D as o,aF as p,aH as t,aJ as s,aM as K,aN as _,aG as $,F as U,b8 as de,E as d,aL as F,aK as O,e as ye,c as G,H as l,u as c,k as J,aY as Z,aZ as D,b0 as ee,b4 as me,a_ as fe,a$ as he,w as te,b9 as ge}from"./arco.643eb8a8.js";import{g as ae,s as B,j as ve,k as be}from"./vue.44e4333e.js";import{q as Te,r as ke,d as se,u as oe}from"./query-code.fe045dc7.js";import{_ as W,u as ce,b as xe,s as Ce,i as Le}from"./index.bd3805a4.js";import{_ as we}from"./text-copyable.69172c6b.js";import{u as Ae,_ as Ee}from"./python-code.58beb702.js";import"./chart.4225530a.js";const Ie=Q({__name:"logs-layout",props:{logs:null,types:null},setup(m){const L=m;ne(x=>({ce012f70:w}));const k=16,y=58,w=`calc(100vh - ${k*3+y}px`;ae();const{clearLogs:I}=Te(),A=()=>{I(L.types)};return(x,N)=>{const M=r("a-space"),E=r("a-button"),H=pe,q=le,C=r("a-list"),h=r("a-card");return o(),p(h,{class:"logs-card",bordered:!1},{title:t(()=>[s(M,null,{default:t(()=>[K("Logs")]),_:1})]),extra:t(()=>[m.logs.length?(o(),p(E,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",onClick:A},{default:t(()=>[K(_(x.$t("dashboard.clear")),1)]),_:1})):$("",!0)]),default:t(()=>[s(C,{class:U(["logs-list",{"empty-list":!m.logs.length}]),size:"small",hoverable:!0,bordered:!1},{default:t(()=>[s(de,{name:"list"},{default:t(()=>[(o(!0),d(F,null,O(m.logs,f=>(o(),p(H,{key:f,log:f},null,8,["log"]))),128)),m.logs.length?$("",!0):(o(),p(q,{key:0,class:"empty-log"}))]),_:1})]),_:1},8,["class"])]),_:1})}}});const Me=W(Ie,[["__scopeId","data-v-78fa760b"]]),b=m=>(fe("data-v-2523602a"),m=m(),he(),m),qe=b(()=>l("svg",{class:"icon brand-color"},[l("use",{href:"#refresh"})],-1)),Se=[qe],$e=b(()=>l("svg",{class:"icon"},[l("use",{href:"#search"})],-1)),Ne={class:"icon-18"},He=["href"],Re={key:0,class:"tree-data"},Pe={class:"data-title"},Ue={class:"tree-data"},Be=b(()=>l("use",{href:"#columns"},null,-1)),Ke=[Be],Ve=b(()=>l("use",{href:"#details"},null,-1)),ze=[Ve],Fe=b(()=>l("svg",{class:"icon-20 icon-color"},[l("use",{href:"#query"})],-1)),Oe={key:1,class:"tree-data"},Ge={class:"data-title columns"},Qe={class:"tree-data"},We={class:"data-type"},Ye=b(()=>l("svg",{class:"icon-20 icon-color"},[l("use",{href:"#query"})],-1)),je={key:2,class:"detail-row"},Xe=b(()=>l("span",null,_("TTL"),-1)),Je={key:1},Ze={key:1},De=b(()=>l("svg",{class:"icon-18 icon-color"},[l("use",{href:"#refresh"})],-1)),et={class:"left"},tt={key:0},st={key:1,class:"right"},ot={key:0,class:"icon-18"},lt=b(()=>l("use",{href:"#tables"},null,-1)),nt=[lt],at=Q({__name:"table-manager",setup(m){const L=ae();Ae();const{tablesSearchKey:k,tablesTreeData:y,tablesTreeRef:w,isRefreshingDetails:I,refreshTables:A,loadMore:x,loadMoreColumns:N}=ke(),{tablesLoading:M,originTablesTree:E}=B(ce()),H=16,q=58,C=H*3+q,h=ye(),f=(a,n,u)=>{var R;n[u].length&&u!==n.childrenType&&((R=h.value)==null?void 0:R.includes(n.key))&&a.stopPropagation(),n.children=n[u],n.childrenType=u};G(()=>y.value.map(a=>({title:a.title,dataIndex:a.title})));const T={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},g={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]},v=(a,n)=>{a.stopPropagation(),n.columns.length||N(n)};return(a,n)=>{const u=r("a-space"),R=r("a-input"),P=r("a-tooltip"),S=r("a-button"),Y=Ee,V=r("a-spin"),j=r("a-doption"),X=r("a-dropdown"),z=we,ie=r("a-typography-text"),_e=r("a-tree"),re=le,ue=r("a-card");return o(),p(ue,{class:"table-manager",bordered:!1},{title:t(()=>[s(u,null,{default:t(()=>[K("Tables"),l("div",{class:"icon-space pointer",onClick:n[0]||(n[0]=(...e)=>c(A)&&c(A)(...e))},Se)]),_:1}),s(u,null,{default:t(()=>[s(R,{modelValue:c(k),"onUpdate:modelValue":n[1]||(n[1]=e=>J(k)?k.value=e:null),"allow-clear":!0,placeholder:a.$t("dashboard.input")},{prefix:t(()=>[$e]),_:1},8,["modelValue","placeholder"])]),_:1})]),default:t(()=>[s(V,{style:{width:"100%"},loading:c(M)},{default:t(()=>[c(y)&&c(y).length>0?(o(),p(_e,{key:0,class:"table-tree",ref_key:"tablesTreeRef",ref:w,"expanded-keys":c(h),"onUpdate:expandedKeys":n[4]||(n[4]=e=>J(h)?h.value=e:null),size:"small","action-on-node-click":"expand","block-node":!0,data:c(y),"load-more":c(x),animation:!1,"virtual-list-props":{height:`calc(100vh - ${C}px)`}},{icon:t(e=>[e.node.iconType?(o(),p(P,{key:0,content:e.node.iconType},{default:t(()=>[(o(),d("svg",Ne,[l("use",{href:T[e.node.iconType]},null,8,He)]))]),_:2},1032,["content"])):$("",!0)]),title:t(e=>[e.isLeaf?e.dataType?(o(),d("div",Oe,[l("div",Ge,_(e.title),1),l("div",Qe,[s(me,{name:"slide-fade"},{default:t(()=>[l("div",We,_(e.dataType),1)]),_:2},1024),e.dataType?(o(),p(X,{key:0,class:"quick-select",trigger:"click",position:"right"},{content:t(()=>[(o(!0),d(F,null,O(g[e.iconType||"TABLE"],i=>Z((o(),p(j,null,{default:t(()=>[s(V,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(Y,{type:i.value,node:e,parent:e.iconType?c(E)[e.parentKey]:e,label:i.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,c(L).name==="query"]])),256))]),default:t(()=>[s(S,{type:"text"},{icon:t(()=>[Ye]),_:1})]),_:2},1024)):$("",!0),s(z,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:n[3]||(n[3]=ee(()=>{},["stop"]))},null,8,["data"])])])):(o(),d("div",je,[e.title==="rowAndTime"?(o(),p(u,{key:0,fill:"",style:{"justify-content":"space-between"}},{default:t(()=>[s(u,{size:4},{default:t(()=>[l("span",null,_(a.$t("dashboard.rowCount")),1),l("span",null,_(e.info.rowCount),1)]),_:2},1024),s(u,{size:4},{default:t(()=>[Xe,l("span",null,_(e.info.ttl),1)]),_:2},1024),s(u,{size:4},{default:t(()=>[l("span",null,_(a.$t("dashboard.minTime")),1),e.info.min!=="-"?(o(),p(P,{key:0,content:`${e.info.min}`},{default:t(()=>[l("span",null,_(c(se)(e.info.timestampType,e.info.min)),1)]),_:2},1032,["content"])):(o(),d("span",Je,_(e.info.min),1))]),_:2},1024),s(u,{size:4},{default:t(()=>[l("span",null,_(a.$t("dashboard.maxTime")),1),e.info.max!=="-"?(o(),p(P,{key:0,content:`${e.info.max}`},{default:t(()=>[l("span",null,_(c(se)(e.info.timestampType,e.info.max)),1)]),_:2},1032,["content"])):(o(),d("span",Ze,_(e.info.max),1))]),_:2},1024),s(S,{class:"refresh-details",type:"text",loading:c(I)[e.parentKey],onClick:i=>c(x)(c(E)[e.parentKey])},{icon:t(()=>[De]),_:2},1032,["loading","onClick"])]),_:2},1024)):(o(),p(u,{key:1},{default:t(()=>[s(u,{align:"start",class:U({"create-table":e.info.sql!=="-"})},{default:t(()=>[l("div",et,_(a.$t("dashboard.createTable")),1),e.info.sql==="-"?(o(),d("span",tt,_(e.info.sql),1)):(o(),d("div",st,[s(ie,{class:"code-space"},{default:t(()=>[K(_(e.info.sql),1)]),_:2},1024),s(z,{data:e.info.sql,showData:!1,copyTooltip:a.$t("dashboard.copyToClipboard")},null,8,["data","copyTooltip"])]))]),_:2},1032,["class"])]),_:2},1024))])):(o(),d("div",Re,[s(P,{class:"data-type",mini:"",content:e.title},{default:t(()=>[l("div",Pe,_(e.title),1)]),_:2},1032,["content"]),l("div",Ue,[s(S,{type:"text",onClick:i=>f(i,e,"columns")},{icon:t(()=>{var i;return[(o(),d("svg",{class:U(["icon-20",e.childrenType==="columns"&&((i=c(h))==null?void 0:i.includes(e.key))?"":"icon-color"])},Ke,2))]}),_:2},1032,["onClick"]),s(S,{type:"text",onClick:i=>f(i,e,"details")},{icon:t(()=>{var i;return[(o(),d("svg",{class:U(["icon-20",e.childrenType==="details"&&((i=c(h))==null?void 0:i.includes(e.key))?"":"icon-color"])},ze,2))]}),_:2},1032,["onClick"]),s(X,{class:"quick-select",trigger:"click",position:"right",onClick:i=>v(i,e)},{content:t(()=>[(o(!0),d(F,null,O(g.TABLE,i=>Z((o(),p(j,null,{default:t(()=>[s(V,{style:{width:"100%"},loading:e.children&&!e.children.length},{default:t(()=>[s(Y,{type:i.value,node:e,parent:e.iconType?c(E)[e.parentKey]:e,label:i.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[D,c(L).name==="query"]])),256))]),default:t(()=>[s(S,{type:"text"},{icon:t(()=>[Fe]),_:1})]),_:2},1032,["onClick"]),s(z,{class:"title-copy",type:"text",data:e.title,"show-data":!1,onClick:n[2]||(n[2]=ee(()=>{},["stop"]))},null,8,["data"])])]))]),"switcher-icon":t(e=>[e.isLeaf?$("",!0):(o(),d("svg",ot,nt))]),_:1},8,["expanded-keys","data","load-more","virtual-list-props"])):(o(),p(re,{key:1,class:"empty"}))]),_:1},8,["loading"])]),_:1})}}});const ct=W(at,[["__scopeId","data-v-2523602a"]]),it=Q({__name:"index",setup(m){ne(f=>({"7c48fb15":q}));const{s:L,q:k}=ve(),y=be(),{queryType:w}=oe(),{guideModalVisible:I}=B(xe()),{getTables:A}=ce(),{dataStatusMap:x}=B(Ce()),{logs:N}=B(Le()),{getResultsByType:M}=oe(),q=`${258+16+636}px`,C=["sql","promql"];G(()=>M(C));const h=G(()=>N.value.filter(f=>C.includes(f.type)));return te(L,f=>{var T,g,v,a;((T=y.value)==null?void 0:T.tagName)!=="INPUT"&&((g=y.value)==null?void 0:g.tagName)!=="TEXTAREA"&&!((a=(v=y.value)==null?void 0:v.classList)!=null&&a.contains("cm-content"))&&(w.value="sql")}),te(k,f=>{var T,g,v,a;((T=y.value)==null?void 0:T.tagName)!=="INPUT"&&((g=y.value)==null?void 0:g.tagName)!=="TEXTAREA"&&!((a=(v=y.value)==null?void 0:v.classList)!=null&&a.contains("cm-content"))&&(w.value="promql")}),ge(()=>{I.value||x.value.tables||A()}),(f,T)=>{const g=ct,v=r("a-layout-sider"),a=Me,n=r("a-layout-content"),u=r("a-layout");return o(),p(u,{class:"layout"},{default:t(()=>[s(v,{class:"tables-sider",style:{width:"66.6%"},"resize-directions":["right"]},{default:t(()=>[s(g)]),_:1}),s(n,null,{default:t(()=>[s(a,{logs:c(h),types:C},null,8,["logs"])]),_:1})]),_:1})}}});const gt=W(it,[["__scopeId","data-v-26e22aa6"]]);export{gt as default};
