import{_ as he,a as ke,b as qe}from"./list-tabs.ddc53abb.js";import{s as Z,P as ee,_ as we}from"./promql.512f86f3.js";import{d as ae,e as x,c as K,w as Te,b2 as oe,aH as n,C as i,aE as d,aG as a,aI as o,u as e,G as y,aL as V,aM as u,D as R,k as te,aK as j,aJ as G,b3 as Ce,b4 as Se,aY as xe,b5 as Ve,aF as Re}from"./arco.3a351844.js";import{o as A,k as D,T as Le}from"./index.fad548d4.js";import{u as se,b as W,c as ne,q as $e,d as Ee,e as ze,t as Be,f as Ae,g as De}from"./index.6f4c244c.js";import{g as Pe,s as L}from"./vue.8d0dec31.js";import"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.f26fc937.js";import"./chart.e63b3ede.js";const Me={class:"mr-4"},Ue={class:"mr-4"},Qe={key:0},Fe={key:1},Ne={class:"query-select"},Oe=y("svg",{class:"icon"},[y("use",{href:"#question"})],-1),je={class:"ml-4"},Ge={class:"ml-2"},Ke=ae({__name:"editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(w){Pe(),L(se());const{queryCode:g,queryType:m,cursorAt:P,queryOptions:M,promForm:r,isButtonDisabled:f,primaryCodeRunning:b,secondaryCodeRunning:T,view:h,selectCodeType:U}=W(),p=x(),v=x(),C=x(),k=x(!1),_=x(!1),{runQuery:$}=W(),{originTablesTree:Q}=L(ne()),F=t=>{h.value=t.view},E={height:"250px"},le=()=>{if(h.value){const{state:t}=h.value,{ranges:s}=t.selection;if(P.value=[s[0].from,s[0].to],p.value=t.doc.lineAt(s[0].from).number,v.value=t.doc.lineAt(s[0].to).number,t.doc.text)C.value=t.doc.text.slice(p.value-1,v.value).join(" ");else{let c=[];t.doc.children.forEach(q=>{c=c.concat(q.text)}),C.value=c.slice(p.value-1,v.value).join(" ")}}},H=async()=>{b.value=!0,await $(g.value.trim(),m.value),b.value=!1},I=async()=>{T.value=!0,await $(C.value.trim(),m.value),T.value=!1},ie=Be.map(t=>({value:t,label:`Last ${t} minutes`})),z=[{key:"alt-Enter",run:()=>{H()}},{key:"ctrl-Enter",run:()=>{I()}}],B=K(()=>{const t={},s=new Set;return Q.value.forEach(c=>{const q=c.children.map(S=>(s.add(S.title),S.title));t[c.title]=q,s.add(c.title)}),{sql:{schema:t},promql:s}}),N={sql:[Z(B.value.sql),A,D.of(z)],promql:[new ee().asExtension(),A,D.of(z)]};Te(B,()=>{N.sql=[Z(B.value.sql),A,D.of(z)];const t=new ee().setComplete({remote:{fetchFn:()=>Promise.reject(),cache:{initialMetricList:[...B.value.promql]}}});N.promql=[t.asExtension(),A,D.of(z)]});const re=()=>{_.value=r.value.isRelative!==1,k.value=!0},ue=()=>{_.value=!_.value},ce=t=>{r.value.range=t,r.value.time=-1,r.value.isRelative=0,_.value=!1,k.value=!1},de=t=>{r.value.time=t,r.value.isRelative=1,_.value=!1,k.value=!1};return oe(()=>{U()}),(t,s)=>{const c=n("icon-loading"),q=n("icon-play-arrow"),S=n("a-button"),O=n("a-space"),me=n("a-option"),pe=n("a-select"),_e=we,J=n("a-form-item"),Y=n("a-typography-text"),X=n("a-list-item"),fe=n("a-list"),ve=n("a-popover"),ye=n("a-input"),ge=n("a-form"),be=n("a-card");return i(),d(be,{class:"editor-card padding-16",bordered:!1},{default:a(()=>[o(O,{class:"space-between pb-16"},{default:a(()=>[o(O,{size:"medium"},{default:a(()=>[o(S,{type:"primary",disabled:e(f),onClick:s[0]||(s[0]=l=>H())},{default:a(()=>[y("div",Me,[e(b)?(i(),d(c,{key:0,spin:""})):(i(),d(q,{key:1}))]),V(u(t.$t("dashboard.runAll")),1)]),_:1},8,["disabled"]),o(S,{disabled:e(f),onClick:s[1]||(s[1]=l=>I())},{default:a(()=>[y("div",Ue,[e(T)?(i(),d(c,{key:0,spin:""})):(i(),d(q,{key:1}))]),e(p)===e(v)?(i(),R("div",Qe,u(t.$t("dashboard.runLine"))+" "+u(e(p)),1)):(i(),R("div",Fe,u(t.$t("dashboard.runLines"))+" "+u(e(p))+" - "+u(e(v)),1))]),_:1},8,["disabled"])]),_:1}),y("div",Ne,[o(pe,{modelValue:e(m),"onUpdate:modelValue":s[2]||(s[2]=l=>te(m)?m.value=l:null),"trigger-props":{"content-class":"query-select"},onChange:e(U)},{default:a(()=>[(i(!0),R(j,null,G(e(M),l=>(i(),d(me,Ce(Se(l)),null,16))),256))]),_:1},8,["modelValue","onChange"])])]),_:1}),xe(o(ge,{class:"space-between prom-form mb-16",layout:"inline",model:e(r)},{default:a(()=>[o(O,{size:"medium"},{default:a(()=>[o(J,{"hide-label":!0},{default:a(()=>[o(_e,{"flex-direction":"row-reverse","button-class":"query-time-button","trigger-visible":e(k),"is-relative":e(r).isRelative===1,"range-picker-visible":e(_),"time-length":e(r).time,"time-range":e(r).range,"relative-time-map":e($e),"relative-time-options":e(ie),onOpenTimeSelect:re,onSelectTimeRange:ce,onSelectTimeLength:de,onClickCustom:ue},null,8,["trigger-visible","is-relative","range-picker-visible","time-length","time-range","relative-time-map","relative-time-options"])]),_:1}),o(J,{"hide-label":!0},{default:a(()=>[o(ye,{modelValue:e(r).step,"onUpdate:modelValue":s[3]||(s[3]=l=>e(r).step=l),"hide-button":"",style:{width:"180px"},placeholder:t.$t("dashboard.step")},{prefix:a(()=>[V("Step")]),suffix:a(()=>[o(ve,{trigger:"hover"},{content:a(()=>[o(fe,{size:"small",split:!1,bordered:!1},{header:a(()=>[V(u(t.$t("dashboard.supportedDurations")),1)]),default:a(()=>[(i(!0),R(j,null,G(e(Ee),l=>(i(),d(X,{key:l},{default:a(()=>[o(Y,{code:""},{default:a(()=>[V(u(l.key),1)]),_:2},1024),y("span",je,u(l.value),1)]),_:2},1024))),128)),o(X,null,{default:a(()=>[y("span",Ge,u(t.$t("dashboard.examples")),1),(i(!0),R(j,null,G(e(ze),l=>(i(),d(Y,{key:l,code:""},{default:a(()=>[V(u(l),1)]),_:2},1024))),128))]),_:1})]),_:1})]),default:a(()=>[Oe]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["model"]),[[Ve,e(m)==="promql"]]),o(e(Le),{modelValue:e(g),"onUpdate:modelValue":s[4]||(s[4]=l=>te(g)?g.value=l:null),style:E,spellcheck:w.spellcheck,autofocus:w.autofocus,"indent-with-tab":w.indentWithTab,tabSize:w.tabSize,extensions:N[e(m)],onReady:F,onUpdate:le},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1})}}}),tt=ae({__name:"index",setup(w){const{guideModalVisible:g}=L(se()),{getTables:m}=ne(),{dataStatusMap:P}=L(Ae()),{logs:M}=L(De()),{getResultsByType:r}=W(),f=["sql","promql"],b=K(()=>r(f)),T=K(()=>M.value.filter(h=>f.includes(h.type)));return oe(()=>{g.value||P.value.tables||m()}),(h,U)=>{const p=he,v=n("a-layout-sider"),C=Ke,k=ke,_=qe,$=n("a-space"),Q=n("a-layout-content"),F=n("a-layout");return i(),d(F,{class:"layout"},{default:a(()=>[o(v,{"resize-directions":["right"],width:321},{default:a(()=>[o(p,{has:["Tables"]})]),_:1}),o(Q,null,{default:a(()=>[o($,{class:"content-space",direction:"vertical",fill:"",size:"large"},{default:a(()=>{var E;return[o(C),(E=e(b))!=null&&E.length?(i(),d(k,{key:0,results:e(b),types:f},null,8,["results"])):Re("",!0),o(_,{logs:e(T),types:f},null,8,["logs"])]}),_:1})]),_:1})]),_:1})}}});export{tt as default};
