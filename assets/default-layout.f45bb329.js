import{_ as Ve}from"./index.vue_vue_type_style_index_0_lang.21abec8a.js";import{s as pe,P as me,_ as Le}from"./promql.d6bf7f7c.js";import{d as W,e as D,r as ze,aQ as fe,c as B,w as Me,aW as De,aI as s,D as l,aF as v,aH as e,aJ as o,u as t,H as i,aM as T,aN as g,E,k as be,aL as G,aK as Q,aX as Be,aY as Ie,aZ as Ae,a_ as Ue,a$ as le,b0 as re,G as He,aG as se,F as ge,b1 as ne,o as Oe,b2 as Pe,b as Fe,b3 as ve,b4 as Ne,b5 as Ge}from"./arco.2be430d2.js";import{o as ee,k as te,a as Qe,T as ye}from"./index.ce65588b.js";import{u as We,q as je,d as Ke,a as Je,t as Xe,_ as j,b as I,c as Ye,e as Ze,f as et,l as tt,r as he,g as ot}from"./index.0b8943ec.js";import{g as ke,s as oe,h as nt}from"./vue.8b51e00f.js";import{u as ae}from"./query-code.418681ba.js";import"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.ed16acdb.js";import"./chart.5980d4a9.js";const st=n=>(le("data-v-aa053a06"),n=n(),re(),n),at={class:"mr-4"},lt={class:"mr-4"},rt={key:0},it={key:1},ut={class:"query-select"},ct=st(()=>i("svg",{class:"icon"},[i("use",{href:"#question"})],-1)),dt={class:"ml-4"},_t={class:"ml-2"},pt=W({__name:"editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(n){ke();const{codes:a,queryCode:p,queryType:u,cursorAt:k,queryOptions:q,primaryCodeRunning:y,secondaryCodeRunning:w,sqlView:z,promqlView:c,selectCodeType:h}=ae(),d=D(),b=D(),$=D();D(!1),D(!1);const m=ze({time:5,step:"30s",range:[fe().subtract(5,"minute").unix().toString(),fe().unix().toString()]}),{runQuery:R}=ae(),{originTablesTree:A}=oe(We()),M=B(()=>{if(p.value.trim().length===0)return!0;if(u.value==="promql"){const f=m.range?m.range.length>0:!1;if(m.step.trim().length===0||!m.time&&!f)return!0}return!!(y.value||w.value)}),O=f=>{z.value=f.view},P=f=>{c.value=f.view},U={height:"250px"},H=f=>{const r=f==="sql"?z.value:c.value;if(r){const{state:x}=r,{ranges:V}=x.selection;if(k.value=[V[0].from,V[0].to],d.value=x.doc.lineAt(V[0].from).number,b.value=x.doc.lineAt(V[0].to).number,x.doc.text)$.value=x.doc.text.slice(d.value-1,b.value).join(" ");else{let L=[];x.doc.children.forEach(N=>{L=L.concat(N.text)}),$.value=L.slice(d.value-1,b.value).join(" ")}}},S=async()=>{y.value=!0,await R(p.value.trim(),u.value,!1,m),y.value=!1},C=B(()=>!$.value||$.value.trim().length===0?!0:M.value),F=async()=>{w.value=!0,await R($.value.trim(),u.value,!1,m),w.value=!1},J=Xe.map(f=>({value:f,label:`Last ${f} minutes`})),X=[{key:"alt-Enter",run:()=>{S()}},{key:"ctrl-Enter",run:()=>{F()}}],Y=B(()=>{const f={},r=new Set;return A.value.forEach(x=>{const V=x.columns.map(L=>(r.add(L.title),L.title));f[x.title]=V,r.add(x.title)}),{sql:{schema:f},promql:r}}),Z={sql:[pe(Y.value.sql),ee,te.of(X),Qe({closeOnBlur:!1})],promql:[new me().asExtension(),ee,te.of(X)]};return Me(Y,()=>{Z.sql=[pe(Y.value.sql),ee,te.of(X)];const f=new me().setComplete({remote:{fetchFn:()=>Promise.reject(),cache:{initialMetricList:[...Y.value.promql]}}});Z.promql=[f.asExtension(),ee,te.of(X)]}),De(()=>{h()}),(f,r)=>{const x=s("icon-loading"),V=s("icon-play-arrow"),L=s("a-button"),N=s("a-space"),we=s("a-option"),qe=s("a-select"),$e=Le,ue=s("a-form-item"),ce=s("a-typography-text"),de=s("a-list-item"),xe=s("a-list"),Se=s("a-popover"),Ce=s("a-input"),Te=s("a-form"),_e=s("a-tab-pane"),Ee=s("a-tabs"),Re=s("a-card");return l(),v(Re,{class:"editor-card",bordered:!1},{default:e(()=>[o(N,{class:"space-between pb-16"},{default:e(()=>[o(N,{size:"medium"},{default:e(()=>[o(L,{type:"primary",disabled:t(M),onClick:r[0]||(r[0]=_=>S())},{default:e(()=>[i("div",at,[t(y)?(l(),v(x,{key:0,spin:""})):(l(),v(V,{key:1}))]),T(g(f.$t("dashboard.runAll")),1)]),_:1},8,["disabled"]),o(L,{disabled:t(C),onClick:r[1]||(r[1]=_=>F())},{default:e(()=>[i("div",lt,[t(w)?(l(),v(x,{key:0,spin:""})):(l(),v(V,{key:1}))]),t(d)===t(b)?(l(),E("div",rt,g(f.$t("dashboard.runLine"))+" "+g(t(d)),1)):(l(),E("div",it,g(f.$t("dashboard.runLines"))+" "+g(t(d))+" - "+g(t(b)),1))]),_:1},8,["disabled"])]),_:1}),i("div",ut,[o(qe,{modelValue:t(u),"onUpdate:modelValue":r[2]||(r[2]=_=>be(u)?u.value=_:null),"trigger-props":{"content-class":"query-select"},onChange:t(h)},{default:e(()=>[(l(!0),E(G,null,Q(t(q),_=>(l(),v(we,Be(Ie(_)),null,16))),256))]),_:1},8,["modelValue","onChange"])])]),_:1}),Ae(o(Te,{class:"space-between prom-form mb-16",layout:"inline",model:t(m)},{default:e(()=>[o(N,{size:"medium"},{default:e(()=>[o(ue,{"hide-label":!0},{default:e(()=>[o($e,{"time-length":t(m).time,"onUpdate:timeLength":r[3]||(r[3]=_=>t(m).time=_),"time-range":t(m).range,"onUpdate:timeRange":r[4]||(r[4]=_=>t(m).range=_),"flex-direction":"row-reverse","button-class":"query-time-button","relative-time-map":t(je),"relative-time-options":t(J)},null,8,["time-length","time-range","relative-time-map","relative-time-options"])]),_:1}),o(ue,{"hide-label":!0},{default:e(()=>[o(Ce,{modelValue:t(m).step,"onUpdate:modelValue":r[5]||(r[5]=_=>t(m).step=_),"hide-button":"",style:{width:"180px"},placeholder:f.$t("dashboard.step")},{prefix:e(()=>[T("Step")]),suffix:e(()=>[o(Se,{trigger:"hover"},{content:e(()=>[o(xe,{size:"small",split:!1,bordered:!1},{header:e(()=>[T(g(f.$t("dashboard.supportedDurations")),1)]),default:e(()=>[(l(!0),E(G,null,Q(t(Ke),_=>(l(),v(de,{key:_},{default:e(()=>[o(ce,{code:""},{default:e(()=>[T(g(_.key),1)]),_:2},1024),i("span",dt,g(_.value),1)]),_:2},1024))),128)),o(de,null,{default:e(()=>[i("span",_t,g(f.$t("dashboard.examples")),1),(l(!0),E(G,null,Q(t(Je),_=>(l(),v(ce,{key:_,code:""},{default:e(()=>[T(g(_),1)]),_:2},1024))),128))]),_:1})]),_:1})]),default:e(()=>[ct]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["model"]),[[Ue,t(u)==="promql"]]),o(Ee,{class:"query-tabs","default-active-key":"sql","active-key":t(u)},{default:e(()=>[o(_e,{key:"sql"},{default:e(()=>[o(t(ye),{modelValue:t(a).sql,"onUpdate:modelValue":r[6]||(r[6]=_=>t(a).sql=_),style:U,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:Z.sql,onReady:O,onUpdate:r[7]||(r[7]=_=>H("sql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1}),o(_e,{key:"promql"},{default:e(()=>[o(t(ye),{modelValue:t(a).promql,"onUpdate:modelValue":r[8]||(r[8]=_=>t(a).promql=_),style:U,spellcheck:n.spellcheck,autofocus:n.autofocus,"indent-with-tab":n.indentWithTab,tabSize:n.tabSize,extensions:Z.promql,onReady:P,onUpdate:r[9]||(r[9]=_=>H("promql"))},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize","extensions"])]),_:1})]),_:1},8,["active-key"])]),_:1})}}});const mt=j(pt,[["__scopeId","data-v-aa053a06"]]),ie=n=>(le("data-v-d23246ab"),n=n(),re(),n),ft=ie(()=>i("svg",{class:"icon-18"},[i("use",{href:"#clear"})],-1)),vt={key:0,class:"icon-18"},yt=ie(()=>i("use",{href:"#zoom-out"},null,-1)),ht=[yt],bt={key:1,class:"icon-18"},gt=ie(()=>i("use",{href:"#zoom"},null,-1)),kt=[gt],wt=W({__name:"index",setup(n){const{queryModalVisible:a}=oe(I());I();const{getResultsByType:p,sqlView:u,promqlView:k,queryType:q,clearCode:y}=ae(),w=58,z=16,c=258,h=D(!1);D(!1);const d=["sql","promql"],b=B(()=>p(d)),$=()=>{q.value==="sql"?u.value.focus():k.value.focus()};return(m,R)=>{const A=s("a-button"),M=s("a-space"),O=mt,P=Ve,U=s("a-scrollbar"),H=s("a-modal");return l(),v(H,{class:ge(["query-modal",{"full-screen":t(h)}]),visible:t(a),"onUpdate:visible":R[1]||(R[1]=S=>be(a)?a.value=S:null),"ok-text":m.$t("guide.confirm"),"hide-cancel":!0,width:t(h)?`calc(100vw - ${c}px - 32px)`:636,mask:!1,"align-center":!1,"mask-style":{"pointer-events":"none"},footer:!1,draggable:!0,onOpen:$},{title:e(()=>[T(g(m.$t("menu.dashboard.query")),1),o(M,{fill:"",size:4},{default:e(()=>[o(A,{class:"screen-button",type:"text",size:"small",onClick:t(y)},{icon:e(()=>[ft]),_:1},8,["onClick"]),o(A,{class:"screen-button",type:"text",size:"small",onClick:R[0]||(R[0]=S=>h.value=!t(h))},{icon:e(()=>[t(h)?(l(),E("svg",vt,ht)):(l(),E("svg",bt,kt))]),_:1})]),_:1})]),default:e(()=>[o(M,{class:"editor-space",align:"start",fill:"",size:0},{default:e(()=>[o(U,{style:He({height:`calc(100vh - ${z*2+w}px)`,overflow:"auto"})},{default:e(()=>{var S;return[o(O),(S=t(b))!=null&&S.length?(l(),v(P,{key:0,class:"modal-view",results:t(b),types:d},null,8,["results"])):se("",!0)]}),_:1},8,["style"])]),_:1})]),_:1},8,["visible","class","ok-text","width"])}}});const qt=j(wt,[["__scopeId","data-v-d23246ab"]]),$t="/assets/logo-text.e99088e0.png",xt=[...Ye,...Ze],St=xt.map(n=>{const{name:a,path:p,meta:u,redirect:k,children:q}=n;return{name:a,path:p,meta:u,redirect:k,children:q}});function Ct(){const n=et(),a=I(),p=B(()=>a.menuFromServer?a.appAsyncMenus:St);return{menuTree:B(()=>{const k=JSON.parse(JSON.stringify(p.value));k.sort((y,w)=>(y.meta.order||0)-(w.meta.order||0));function q(y,w){return y?y.map(c=>{var d,b;if(!n.accessRouter(c))return null;if(((d=c.meta)==null?void 0:d.hideChildrenInMenu)||!c.children)return c.children=[],c;c.children=c.children.filter($=>{var m;return((m=$.meta)==null?void 0:m.hideInMenu)!==!0});const h=q(c.children,w+1);return h.length||w>1?(c.children=h,c):((b=c.meta)==null?void 0:b.hideInMenu)===!1?c:null}).filter(Boolean):null}return q(k,0)})}}const K=n=>(le("data-v-04169665"),n=n(),re(),n),Tt=K(()=>i("div",{class:"logo-space"},[i("img",{class:"logo-text-img",alt:"logo",src:$t})],-1)),Et={class:"new-query"},Rt=K(()=>i("span",null,"+",-1)),Vt=K(()=>i("span",null,"New Query",-1)),Lt={class:"menu"},zt={class:"icon-18"},Mt=["href"],Dt={class:"footer"},Bt=K(()=>i("svg",{class:"icon-20"},[i("use",{href:"#settings"})],-1)),It=K(()=>i("svg",{class:"icon-18"},[i("use",{href:"#menu"})],-1)),At=W({__name:"index",setup(n){const{updateSettings:a}=I(),{menuSelectedKey:p,globalSettings:u}=oe(I()),{menuTree:k}=Ct(),q=k.value[0].children,y=[{link:"https://greptime.com/",label:"Home"},{link:"https://docs.greptime.com/",label:"Docs"},{link:"https://github.com/GreptimeTeam/dashboard",label:"GitHub | Dashboard"},{link:"https://github.com/GreptimeTeam/greptimedb",label:"GitHub | GreptimeDB"}],w=()=>{a({globalSettings:!0})},z=d=>{he.push({name:d})},c=d=>{const b=he.resolve({name:d});window.open(b.fullPath,"_blank")};tt(d=>{p.value=d.name},!0);const h=()=>{a({queryModalVisible:!0})};return(d,b)=>{const $=s("a-layout-header"),m=s("a-button"),R=s("a-menu-item"),A=s("a-menu"),M=s("a-layout-content"),O=s("a-link"),P=s("a-doption"),U=s("a-dropdown"),H=s("a-layout-footer"),S=s("a-layout");return l(),v(S,{class:"navbar"},{default:e(()=>[o($,null,{default:e(()=>[Tt]),_:1}),o(M,null,{default:e(()=>[i("div",Et,[o(m,{type:"primary",onClick:h},{default:e(()=>[Rt,Vt]),_:1})]),i("div",Lt,[o(A,{mode:"vertical","selected-keys":[t(p)]},{default:e(()=>[(l(!0),E(G,null,Q(t(q),(C,F)=>(l(),v(R,{key:C.name,onClick:[ne(J=>c(C.name),["meta"]),ne(J=>c(C.name),["ctrl"]),ne(J=>z(C.name),["exact"])]},{icon:e(()=>[(l(),E("svg",zt,[i("use",{href:`#${C.meta.icon}`},null,8,Mt)]))]),default:e(()=>[i("span",null,g(d.$t(C.meta.locale)),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["selected-keys"])])]),_:1}),o(H,null,{default:e(()=>[i("ul",Dt,[i("li",null,[o(m,{style:{width:"100%"},class:ge({hover:t(u)}),onClick:w},{icon:e(()=>[Bt]),default:e(()=>[T(g(d.$t("settings.title")),1)]),_:1},8,["class"])]),i("li",null,[o(U,{class:"menu-dropdown",trigger:"hover",position:"right","popup-max-height":!1},{content:e(()=>[(l(),E(G,null,Q(y,({label:C,link:F})=>o(P,null,{default:e(()=>[o(O,{target:"_blank",href:F},{default:e(()=>[T(g(C),1)]),_:2},1032,["href"])]),_:2},1024)),64))]),default:e(()=>[o(m,{style:{width:"100%"}},{icon:e(()=>[It]),default:e(()=>[T(g(d.$t("navbar.docs")),1)]),_:1})]),_:1})])])]),_:1})]),_:1})}}});const Ut=j(At,[["__scopeId","data-v-04169665"]]);const Ht={};function Ot(n,a){const p=s("a-layout-footer");return l(),v(p,{class:"footer"},{default:e(()=>[T("\xA9Copyright 2022 Greptime Inc. All Rights Reserved")]),_:1})}const Pt=j(Ht,[["render",Ot],["__scopeId","data-v-d90f7d0d"]]);function Ft(n,a,p,u=!1){n.addEventListener&&typeof n.addEventListener=="function"&&n.addEventListener(a,p,u)}function Nt(n,a,p,u=!1){n.removeEventListener&&typeof n.removeEventListener=="function"&&n.removeEventListener(a,p,u)}const Gt=992;function Qt(){return document.body.getBoundingClientRect().width-1<Gt}function Wt(n){const a=I();function p(){if(!document.hidden){const k=Qt();a.toggleDevice(k?"mobile":"desktop"),a.toggleMenu(k)}}const u=nt(p,100);Oe(()=>{n&&u()}),Pe(()=>{Ft(window,"resize",u)}),Fe(()=>{Nt(window,"resize",u)})}const jt=W({__name:"page-layout",setup(n){const a=ke(),p=ot();return B(()=>p.getCacheList),(u,k)=>{const q=s("router-view");return l(),v(q,null,{default:e(({Component:y})=>[o(Ge,{name:"fade",mode:"out-in",appear:""},{default:e(()=>[t(a).meta.ignoreCache?(l(),v(ve(y),{key:t(a).fullPath})):(l(),v(Ne,{key:1},[(l(),v(ve(y),{key:t(a).name}))],1024))]),_:2},1024)]),_:1})}}}),Kt=W({__name:"default-layout",setup(n){Wt(!0);const{navbar:a,footer:p,username:u,password:k,database:q,codeType:y}=oe(I());return(w,z)=>{const c=Ut,h=s("a-layout-sider"),d=s("a-layout-content"),b=qt,$=s("a-layout");return l(),v($,{class:"layout-container"},{default:e(()=>[o(h,{class:"main-sider",width:258},{default:e(()=>[t(a)?(l(),v(c,{key:0})):se("",!0)]),_:1}),o(d,{class:"layout-content"},{default:e(()=>[o(jt)]),_:1}),t(p)?(l(),v(Pt,{key:0})):se("",!0),o(b)]),_:1})}}});const ao=j(Kt,[["__scopeId","data-v-6090adc4"]]);export{ao as default};
