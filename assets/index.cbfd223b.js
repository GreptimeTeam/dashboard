import{_ as me}from"./log.dddf9dc6.js";import{d as Z,aI as a,D as n,aF as l,aH as e,aM as J,aN as F,aG as ee,aJ as t,E as H,aL as oe,aK as le,e as x,s as fe,c as te,u as o,H as p,k as j,b4 as ve,aY as ye,aZ as be,a_ as he,a$ as ge,b2 as ke,F as Se,b9 as Te}from"./arco.643eb8a8.js";import{g as ce,l as Ce,s as D}from"./vue.44e4333e.js";import{q as we,u as re,r as ue}from"./query-code.7be2c04f.js";import{_ as ie,u as Y,i as xe,b as $e,s as Ne}from"./index.48f65fb2.js";import{_ as Ae}from"./index.vue_vue_type_style_index_0_lang.75f5a4b5.js";import{o as Le,T as Be}from"./index.e30bbf0d.js";import{p as Re}from"./index.fd4fd952.js";import{u as ae,_ as Ve}from"./python-code.1f30ec81.js";import{_ as de}from"./empty-status.vue_vue_type_script_setup_true_name_EmptyStatus_lang.bb409e10.js";import"./chart.4225530a.js";const Ie=Z({__name:"logs",props:{logs:null,types:null},setup(_){const b=_;ce();const{clearLogs:T}=we(),m=()=>{T(b.types)};return($,h)=>{const C=a("a-button"),k=me,v=a("a-list"),f=a("a-card"),y=a("a-tab-pane"),c=a("a-tabs");return n(),l(c,{class:"result-tabs logs-tab",type:"rounded"},{extra:e(()=>[_.logs.length?(n(),l(C,{key:0,class:"clear-logs-button",type:"secondary",status:"danger",onClick:m},{default:e(()=>[J(F($.$t("dashboard.clear")),1)]),_:1})):ee("",!0)]),default:e(()=>[t(y,{title:"Logs"},{default:e(()=>[t(f,{bordered:!1},{default:e(()=>[_.logs.length?(n(),l(v,{key:0,size:"small",hoverable:!0,bordered:!1},{default:e(()=>[(n(!0),H(oe,null,le(_.logs,N=>(n(),l(k,{key:N,log:N},null,8,["log"]))),128))]),_:1})):ee("",!0)]),_:1})]),_:1})]),_:1})}}});const ze=ie(Ie,[["__scopeId","data-v-604dd01e"]]),Ee={class:"mr-4"},Ue={class:"mr-4"},Ke={class:"mr-4"},Me=Z({__name:"py-editor",props:{spellcheck:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!0},indentWithTab:{type:Boolean,default:!0},tabSize:{default:2}},setup(_){const b=ce(),T=Y(),{pythonCode:m,cursorAt:$,lastSavedCode:h,isNewScript:C,scriptName:k,isChanged:v,isButtonDisabled:f,scriptSaving:y,scriptRunning:c,selectAfterSave:N,createNewScript:Q}=ae(),{save:I}=ae(),{runQuery:A}=re(),{getScriptsTable:g}=T,L="python",z=x(),B=x(),K=x(),R=fe(),r=x({scriptName:k}),S=te(()=>!!(!v.value&&m.value!==""&&r.value.scriptName)),w=i=>{R.value=i.view},u=()=>{if(R.value){const{state:i}=R.value,{ranges:d}=i.selection;if($.value=[d[0].from,d[0].to],z.value=i.doc.lineAt(d[0].from).number,B.value=i.doc.lineAt(d[0].to).number,i.doc.text)K.value=i.doc.text.slice(z.value-1,B.value).join(" ");else{let E=[];i.doc.children.forEach(G=>{E=E.concat(G.text)}),K.value=E.slice(z.value-1,B.value).join(" ")}}},q={height:"250px"},V=[Re(),Le],O=async()=>{b.name;try{y.value=!0,await I(r.value.scriptName,m.value.trim()),await g(),N(r.value.scriptName)}catch{}y.value=!1},M=async()=>{b.name;try{c.value=!0,await I(r.value.scriptName,m.value.trim()),h.value=m.value,await A(r.value.scriptName,L),await g(),N(r.value.scriptName)}catch{}c.value=!1},P=async()=>{b.name,c.value=!0,await A(r.value.scriptName,L),c.value=!1};return(i,d)=>{const E=a("a-input"),G=a("a-form-item"),X=a("a-form"),s=a("icon-loading"),U=a("icon-play-arrow"),se=a("a-button"),ne=a("a-space"),pe=a("a-card");return n(),l(pe,{class:"editor-card padding-16",bordered:!1},{default:e(()=>[t(ne,{class:"form-space",size:"medium"},{default:e(()=>[t(X,{layout:"inline",model:o(r)},{default:e(()=>[t(G,{label:i.$t("dashboard.scriptName")},{default:e(()=>[t(E,{"model-value":o(r).scriptName,"onUpdate:modelValue":d[0]||(d[0]=W=>o(r).scriptName=W),disabled:!o(C),placeholder:i.$t("dashboard.input")},null,8,["model-value","disabled","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"]),t(ne,null,{default:e(()=>[o(S)?(n(),l(se,{key:0,disabled:o(f),onClick:d[1]||(d[1]=W=>P())},{default:e(()=>[p("div",Ee,[o(c)?(n(),l(s,{key:0,spin:""})):(n(),l(U,{key:1}))]),J(F(i.$t("dashboard.runScriptAction")),1)]),_:1},8,["disabled"])):(n(),l(ne,{key:1},{default:e(()=>[t(se,{disabled:o(f),onClick:d[2]||(d[2]=W=>O())},{default:e(()=>[p("div",Ue,[o(y)?(n(),l(s,{key:0,spin:""})):(n(),l(U,{key:1}))]),J(F(i.$t("dashboard.saveScript")),1)]),_:1},8,["disabled"]),t(se,{disabled:o(f),onClick:d[3]||(d[3]=W=>M())},{default:e(()=>[p("div",Ke,[o(c)?(n(),l(s,{key:0,spin:""})):(n(),l(U,{key:1}))]),J(F(i.$t("dashboard.saveAndRun")),1)]),_:1},8,["disabled"])]),_:1}))]),_:1})]),_:1}),t(o(Be),{modelValue:o(m),"onUpdate:modelValue":d[4]||(d[4]=W=>j(m)?m.value=W:null),style:q,spellcheck:_.spellcheck,autofocus:_.autofocus,"indent-with-tab":_.indentWithTab,tabSize:_.tabSize,extensions:V,onReady:w,onUpdate:u},null,8,["modelValue","spellcheck","autofocus","indent-with-tab","tabSize"])]),_:1})}}}),_e=_=>(he("data-v-7af5aa32"),_=_(),ge(),_),Pe=_e(()=>p("svg",{class:"icon icon-color"},[p("use",{href:"#search"})],-1)),Fe=_e(()=>p("svg",{class:"icon brand-color"},[p("use",{href:"#refresh"})],-1)),Qe={key:0,class:"icon-16"},qe=["href"],Oe={class:"tree-data"},Ge={class:"data-title"},He={key:1,class:"data-title"},je={class:"tree-data"},We={key:0,class:"div"},Je={class:"data-type"},Ye=Z({__name:"table-list",setup(_){const b=x(""),{text:T,copy:m,copied:$,isSupported:h}=Ce({source:b}),C=ce();ae();const{tablesSearchKey:k,tablesTreeData:v}=ue(),{tablesLoading:f,originTablesTree:y}=D(Y()),{getTableByName:c,getTables:N,addChildren:Q,generateTreeChildren:I}=Y(),A=x(),g=x(),L=()=>{k.value="",N(),A.value&&A.value.expandAll(!1)},z=r=>new Promise((S,w)=>{c(r.title).then(u=>{const{output:q}=u,{records:{rows:V,schema:{column_schemas:O}}}=q[0],{treeChildren:M,timeIndexName:P}=I(r,V,O);Q(r.key,M,P,"columns"),S()}).catch(()=>{w()})}),B={FIELD:"#value",TAG:"#primary-key",TIMESTAMP:"#time-index"},K={TABLE:[{value:"select*100",label:"Query table"}],FIELD:[{value:"select100",label:"Query column"},{value:"max",label:"Query max"},{value:"min",label:"Query min"}],TAG:[{value:"count",label:"Count by"},{value:"where=",label:"Filter by"}],TIMESTAMP:[{value:"select*100",label:"Query table"},{value:"where<",label:"Filter by"}]},R=(r,S)=>{var w;S.children&&((w=g.value)==null?void 0:w.includes(S.key))&&r.stopPropagation()};return(r,S)=>{const w=a("a-input"),u=a("a-button"),q=a("a-space"),V=a("a-tooltip"),O=a("icon-more"),M=Ve,P=a("a-spin"),i=a("a-doption"),d=a("a-dropdown"),E=a("IconDown"),G=a("a-tree"),X=de;return n(),l(P,{style:{width:"100%"},loading:o(f)},{default:e(()=>[t(q,{class:"search-space"},{default:e(()=>[t(w,{modelValue:o(k),"onUpdate:modelValue":S[0]||(S[0]=s=>j(k)?k.value=s:null),"allow-clear":!0},{prefix:e(()=>[Pe]),_:1},8,["modelValue"]),t(u,{type:"outline",size:"small",onClick:L},{icon:e(()=>[Fe]),_:1})]),_:1}),o(v)&&o(v).length>0?(n(),l(G,{key:0,class:"table-tree",ref_key:"treeRef",ref:A,"expanded-keys":o(g),"onUpdate:expandedKeys":S[1]||(S[1]=s=>j(g)?g.value=s:null),size:"small","action-on-node-click":"expand","block-node":!0,data:o(v),"load-more":z,animation:!1,"virtual-list-props":{height:"calc(100vh - 160px)"},"field-names":{children:"columns"}},{icon:e(s=>[t(V,{content:s.node.iconType},{default:e(()=>[s.node.iconType?(n(),H("svg",Qe,[p("use",{href:B[s.node.iconType]},null,8,qe)])):ee("",!0)]),_:2},1032,["content"])]),title:e(s=>[p("div",Oe,[s.iconType?(n(),H("div",He,F(s.title),1)):(n(),l(V,{key:0,class:"data-type",mini:"",content:s.title},{default:e(()=>[p("div",Ge,F(s.title),1)]),_:2},1032,["content"])),p("div",je,[s.iconType?(n(),H("div",We,[t(ve,{name:"slide-fade"},{default:e(()=>[p("div",Je,F(s.dataType),1)]),_:2},1024)])):ee("",!0),t(d,{class:"menu-dropdown",trigger:"click",position:"right",onClick:U=>R(U,s)},{content:e(()=>[(n(!0),H(oe,null,le(K[s.iconType||"TABLE"],U=>ye((n(),l(i,null,{default:e(()=>[t(P,{style:{width:"100%"},loading:s.children&&!s.children.length},{default:e(()=>[t(M,{type:U.value,node:s,parent:s.iconType?o(y)[s.parentKey]:s,label:U.label},null,8,["type","node","parent","label"])]),_:2},1032,["loading"])]),_:2},1536)),[[be,o(C).name==="query"]])),256)),t(i,null,{default:e(()=>[t(V,{content:"Copy to Clipboard"},{default:e(()=>[t(u,{type:"text",onClick:U=>o(m)(s.title)},{default:e(()=>[J("Copy name")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:e(()=>[t(u,{class:"menu-button",type:"text"},{icon:e(()=>[t(O,{class:"icon-18"})]),_:1})]),_:2},1032,["onClick"])])])]),"switcher-icon":e(()=>[t(E)]),_:1},8,["expanded-keys","data","virtual-list-props"])):(n(),l(X,{key:1,class:"empty"}))]),_:1},8,["loading"])}}});const Ze=ie(Ye,[["__scopeId","data-v-7af5aa32"]]),Xe=p("svg",{class:"icon"},[p("use",{href:"#search"})],-1),De=p("svg",{class:"icon"},[p("use",{href:"#create"})],-1),et=p("svg",{class:"icon brand-color"},[p("use",{href:"#refresh"})],-1),tt=Z({__name:"scripts-list",setup(_){const b=x(),T=x();x("");const m={type:"outline"},$={type:"primary"},h=x(!1),{pythonCode:C,creating:k,lastSavedCode:v,scriptSelectedKeys:f,lastSelectedKey:y,modelVisible:c,isChanged:N,overwriteCode:Q,createNewScript:I,resetScript:A}=ae(),{scriptsSearchKey:g,scriptsListData:L}=ue(),{scriptsLoading:z}=D(Y()),{getScriptsTable:B}=Y(),K=(w,u)=>{b.value=u.node,N.value?c.value=!0:Q(u.node)},R=()=>{h.value?(g.value="",A(),B()):k.value?(C.value="",v.value="",I()):Q(b.value),h.value=!1},r=()=>{f.value=y.value,h.value=!1},S=()=>{h.value=!0,N.value?c.value=!0:(g.value="",A(),B(),h.value=!1)};return(w,u)=>{const q=a("a-input"),V=a("a-button"),O=a("a-tooltip"),M=a("a-space"),P=a("a-tree"),i=de,d=a("a-scrollbar"),E=a("a-spin"),G=a("icon-exclamation-circle-fill"),X=a("a-modal");return n(),H(oe,null,[t(E,{style:{width:"100%"},loading:o(z)},{default:e(()=>[t(M,{class:"search-space"},{default:e(()=>[t(q,{class:"scripts-search-input",modelValue:o(g),"onUpdate:modelValue":u[0]||(u[0]=s=>j(g)?g.value=s:null),"allow-clear":!0},{prefix:e(()=>[Xe]),_:1},8,["modelValue"]),t(O,{mini:"",content:w.$t("dashboard.create")},{default:e(()=>[t(V,{type:"outline",size:"small",onClick:u[1]||(u[1]=s=>o(I)())},{icon:e(()=>[De]),_:1})]),_:1},8,["content"]),t(V,{type:"outline",size:"small",onClick:S},{icon:e(()=>[et]),_:1})]),_:1}),t(d,{class:"tree-scrollbar"},{default:e(()=>[o(L)&&o(L).length>0?(n(),l(P,{key:0,class:"script-tree",ref_key:"scriptsRef",ref:T,"selected-keys":o(f),"onUpdate:selectedKeys":u[2]||(u[2]=s=>j(f)?f.value=s:null),size:"small",blockNode:"",data:o(L),onSelect:K},null,8,["selected-keys","data"])):(n(),l(i,{key:1}))]),_:1})]),_:1},8,["loading"]),t(X,{class:"change-modal",visible:o(c),"onUpdate:visible":u[3]||(u[3]=s=>j(c)?c.value=s:null),width:"auto",closable:!1,okButtonProps:m,cancelButtonProps:$,onOk:R,onCancel:r},{title:e(()=>[]),default:e(()=>[t(M,null,{default:e(()=>[t(G,{class:"warning-color icon-18"}),J(F(w.$t("dashboard.question")),1)]),_:1})]),_:1},8,["visible"])],64)}}}),at=Z({__name:"list-tabs",props:{has:null},setup(_){const b=_,T=x(b.has.length-1),m=[{title:"Tables",component:Ze},{title:"Scripts",component:tt}],$=te(()=>m.filter(h=>b.has.includes(h.title)));return(h,C)=>{const k=a("a-card"),v=a("a-tab-pane"),f=a("a-tabs");return n(),l(f,{class:Se(["sider-tabs",{"one-tab":o($).length===1}]),"active-key":o(T),"onUpdate:activeKey":C[0]||(C[0]=y=>j(T)?T.value=y:null),type:"rounded"},{default:e(()=>[(n(!0),H(oe,null,le(o($),(y,c)=>(n(),l(v,{key:c,title:y.title},{default:e(()=>[t(k,{class:"tree-card",bordered:!1},{default:e(()=>[(n(),l(ke(y.component)))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active-key","class"])}}});const ot=ie(at,[["__scopeId","data-v-e9caefd7"]]),ft=Z({__name:"index",setup(_){const{getResultsByType:b}=re(),{logs:T}=D(xe()),{codeType:m,guideModalVisible:$}=D($e()),{dataStatusMap:h}=D(Ne()),{getTables:C,getScriptsTable:k}=Y(),v=["python"],f=te(()=>b(v)),y=te(()=>T.value.filter(c=>v.includes(c.type)));return Te(()=>{m.value="python",$.value||(h.value.scripts||k(),h.value.tables||C())}),(c,N)=>{const Q=ot,I=a("a-layout-sider"),A=Me,g=Ae,L=ze,z=a("a-space"),B=a("a-layout-content"),K=a("a-layout");return n(),l(K,{class:"layout"},{default:e(()=>[t(I,{"resize-directions":["right"],width:321},{default:e(()=>[t(Q,{has:["Tables","Scripts"]})]),_:1}),t(B,null,{default:e(()=>[t(z,{class:"content-space",direction:"vertical",fill:"",size:"large"},{default:e(()=>{var R;return[t(A),(R=o(f))!=null&&R.length?(n(),l(g,{key:0,results:o(f),types:v},null,8,["results"])):ee("",!0),t(L,{logs:o(y),types:v},null,8,["logs"])]}),_:1})]),_:1})]),_:1})}}});export{ft as default};
